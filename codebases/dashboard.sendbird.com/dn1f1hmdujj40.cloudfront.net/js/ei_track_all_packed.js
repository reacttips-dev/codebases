window.EI||(EI={}),EI.version=5,EI.define=function(e,t){var o,n,i,a=e.split("."),r=a.length,c=window.EI;for(o=0;o<r;o+=1)(i=c[n=a[o]])||(i=o+1===r?t:{},c[n]=i),c=i},EI.define("extend",function(e,t){var o;for(o in t)e[o]=t[o];return e}),EI.define("api",{_callbacks:{},jsonp:function(e,t,o,n,i){var a,r=document.createElement("script"),c="s"+parseInt(4e7*Math.random(),10);n.method=o,n.callback="EI.api._callbacks."+c,a=e+t+"?"+EI.serializer.qsEncode(n),EI.api._callbacks[c]=function(e){i&&i(e),delete EI.api._callbacks[c],r.parentNode.removeChild(r)},r.src=a,document.getElementsByTagName("head")[0].appendChild(r)},call:function(e,t){var o,n,i;(o={data:t.data||{},method:t.method||"get",success:t.success,error:t.error,domain:t.domain||EI.domain.api,ajax:t.ajax||!1,dataType:t.dataType}).method=o.method.toLowerCase(),i=document.referrer,n="",EI.option&&EI.option.accountId&&!o.data.account_id&&(o.data.account_id=EI.option.accountId),EI.option.internal&&(!(o.ajax=!0)!==EI.option.internal.referrer&&(i=document.location.protocol+"//"+EI.option.domain),o.domain=t.domain||EI.domain.legacy_api),"post"==o.method&&-1==e.search(/method=post/i)&&(n=-1==e.indexOf("?")?"?":"&",n+="method=post"),o.ajax&&$&&$.ajax?$.ajax({url:o.domain+e+n,data:o.data,type:o.method,dataType:o.dataType,cache:!1,beforeSend:function(e){e.setRequestHeader("X-Alt-Referer",i)},success:function(e){o.success&&o.success(e)},error:function(e){o.error&&o.error(e)}}):EI.api.jsonp(o.domain,e,o.method,o.data,o.success,o.error)}}),EI.define("cookie",{get:function(e){return document.cookie!==this._cacheString&&this._populateCache(),this._cache[e]},defaults:{path:"/"},set:function(e,t,o){switch(o={path:o&&o.path||this.defaults.path,domain:o&&o.domain||this.defaults.domain,expires:o&&o.expires||this.defaults.expires,secure:o&&void 0!==o.secure?o.secure:this.defaults.secure},void 0===t&&(o.expires=-1,t=""),typeof o.expires){case"number":o.expires=new Date((new Date).getTime()+1e3*o.expires);break;case"string":o.expires=new Date(o.expires)}var n=encodeURIComponent(e)+"="+(t+"").replace(/[^!#-+\--:<-[\]-~]/g,encodeURIComponent);return n+=o.path?";path="+o.path:"",n+=o.domain?";domain="+o.domain:"",n+=o.expires?";expires="+o.expires.toUTCString():"",n+=o.secure?";secure":"",document.cookie=n,this},expire:function(e,t){return this.set(e,void 0,t)},_populateCache:function(){this._cache={},this._cacheString=document.cookie;var t,o,n,i,a=this._cacheString.split("; ");for(t=0;t<a.length;t+=1){o=a[t].indexOf("="),n=decodeURIComponent(a[t].substr(0,o));try{i=decodeURIComponent(a[t].substr(o+1))}catch(e){i=a[t].substr(o+1),console&&"function"==typeof console.log&&console.log('Could not decode cookie with key "'+n+'"',e)}void 0===this._cache[n]&&(this._cache[n]=i)}}}),EI.define("main",{init:function(e,t,o){EI.define("EAP",{customers:t,base_url:o}),EI.option.init(),EI.domain.init(e),EI.stat.init(),this.process(),_eiq.push(["_track_page_view"])},process:function(){var e=this;_eiq.push=this.processQueueElement,EI.util.each(_eiq,function(){e.processQueueElement(this)}),_eiq.splice(0,_eiq.length)},processQueueElement:function(e){var t={},o=e.shift();if(t.page_url=window.location.href,t.page_title=document.title,"_track_event"===o)t.track_type="event",e[0]&&(t.category=e[0]),e[1]&&(t.action=e[1]),e[2]&&(t.label=e[2]),e[3]&&(t.property=e[3]),e[4]&&(t.value=e[4]);else{if("_track_page_view"!=o)return;t.track_type="page",e[1]&&(t.page_url=e[1]),e[2]&&(t.page_title=e[2]),t.action="ei_view",t.category="ei_page_tracking"}EI.stat.send(t)}}),EI.define("domain",{s_api:"//localhost:3000/api",init:function(e){EI.domain.s_api=e+"api"}}),EI.define("option",{accountId:void 0,domain:window.location.hostname,name:window.location.hostname,init:function(){urlParams=EI.serializer.qsDecode(document.location.search),urlParams.ei_debug&&(EI.option.debug=!0),EI.option.accountId=_engagio_settings.accountId}}),EI.define("serializer",{qsEncode:function(e,t){var o,n="",i="";for(o in t=t||encodeURIComponent,e)void 0!==e[o]&&(i+=n+o+"="+t(e[o])),n="&";return i},qsDecode:function(e,t){var o,n,i,a={};for(t=t||decodeURIComponent,a={},o=e.slice(e.indexOf("?")+1).split("&"),i=0;i<o.length;i+=1)a[(n=o[i].split("="))[0]]=t(n[1]);return a},jsonEncode:function(e){return JSON.stringify(e)},jsonDecode:function(e){return JSON.parse(e)},_b64Str:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",base64Encode:function(e){var t,o,n,i,a,r,c,s,d;for(e=escape(e),t="",d=0;a=(o=e.charCodeAt(d++))>>2,r=(3&o)<<4|(n=e.charCodeAt(d++))>>4,c=(15&n)<<2|(i=e.charCodeAt(d++))>>6,s=63&i,isNaN(n)?c=s=64:isNaN(i)&&(s=64),t=t+this._b64Str.charAt(a)+this._b64Str.charAt(r)+this._b64Str.charAt(c)+this._b64Str.charAt(s),o=n=i="",a=r=c=s="",d<e.length;);return t},sha1Hash:function(e){var t=[1518500249,1859775393,2400959708,3395469782];e+=String.fromCharCode(128);for(var o=Math.ceil(e.length/4)+2,n=Math.ceil(o/16),i=new Array(n),a=0;a<n;a++){i[a]=new Array(16);for(var r=0;r<16;r++)i[a][r]=e.charCodeAt(64*a+4*r)<<24|e.charCodeAt(64*a+4*r+1)<<16|e.charCodeAt(64*a+4*r+2)<<8|e.charCodeAt(64*a+4*r+3)}i[n-1][14]=8*(e.length-1)/Math.pow(2,32),i[n-1][14]=Math.floor(i[n-1][14]),i[n-1][15]=8*(e.length-1)&4294967295;var c,s,d,u,h,l=1732584193,p=4023233417,f=2562383102,m=271733878,E=3285377520,I=new Array(80);for(a=0;a<n;a++){for(var g=0;g<16;g++)I[g]=i[a][g];for(g=16;g<80;g++)I[g]=this._rotl(I[g-3]^I[g-8]^I[g-14]^I[g-16],1);c=l,s=p,d=f,u=m,h=E;for(g=0;g<80;g++){var _=Math.floor(g/20),C=this._rotl(c,5)+this._fSha1(_,s,d,u)+h+t[_]+I[g]&4294967295;h=u,u=d,d=this._rotl(s,30),s=c,c=C}l=l+c&4294967295,p=p+s&4294967295,f=f+d&4294967295,m=m+u&4294967295,E=E+h&4294967295}return this.toHexStr(l)+this.toHexStr(p)+this.toHexStr(f)+this.toHexStr(m)+this.toHexStr(E)},_fSha1:function(e,t,o,n){switch(e){case 0:return t&o^~t&n;case 1:return t^o^n;case 2:return t&o^t&n^o&n;case 3:return t^o^n}},_rotl:function(e,t){return e<<t|e>>>32-t},toHexStr:function(e){for(var t="",o=7;0<=o;o--)t+=(e>>>4*o&15).toString(16);return t},utf8Encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",o=0;o<e.length;o++){var n=e.charCodeAt(o);n<128?t+=String.fromCharCode(n):(127<n&&n<2048?t+=String.fromCharCode(n>>6|192):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128)),t+=String.fromCharCode(63&n|128))}return t},utf8Decode:function(e){for(var t="",o=0,n=c1=c2=0;o<e.length;)(n=e.charCodeAt(o))<128?(t+=String.fromCharCode(n),o++):191<n&&n<224?(c2=e.charCodeAt(o+1),t+=String.fromCharCode((31&n)<<6|63&c2),o+=2):(c2=e.charCodeAt(o+1),c3=e.charCodeAt(o+2),t+=String.fromCharCode((15&n)<<12|(63&c2)<<6|63&c3),o+=3);return t}}),EI.define("stat",{hasRun:!1,COOKIE_NAME:"ei_client_id",EXCLUDES:{},COOKIE_EXPIRY:63072e3,clientId:"",init:function(){this.hasRun||(this.hasRun=!0)},store:function(e){EI.util.isEmpty(e)||EI.cookie.set(EI.stat.COOKIE_NAME,e,{expires:EI.stat.COOKIE_EXPIRY,domain:EI.util.getRootDomain(document.domain)})},getClientId:function(){var e;return e=EI.cookie.get(this.COOKIE_NAME),EI.util.isEmpty(e)&&(e=""),e},callAjax:function(e){var t=new XMLHttpRequest;t.withCredentials=!0,t.onreadystatechange=function(){4==t.readyState&&t.status},t.open("GET",e,!0),t.send()},send:function(e){if(!EI.util.isEmpty(EI.option.accountId))if(EI.EAP.customers[EI.option.accountId]){var t=EI.EAP.base_url+"/api/v2/ip.json?auth="+EI.EAP.customers[EI.option.accountId]+"&page_title="+encodeURIComponent(document.title)+"&page="+encodeURIComponent(window.location.href)+"&referrer="+encodeURIComponent(document.referrer)+"&src=tag";EI.stat.callAjax(t)}else e.client_id=this.getClientId(),EI.api.call("/stat",{method:"post",data:e,success:EI.stat.callback,domain:EI.domain.s_api})},callback:function(e){EI.stat.clientId=e.clientId,EI.stat.store(EI.stat.clientId)}}),EI.define("util",{isEmpty:function(e){return null==e||""===e||(!("number"!=typeof e||!isNaN(e))||(e instanceof Array&&e.length<1||!!(e instanceof Date&&isNaN(Number(e)))))},isArray:function(e){return"[object Array]"===Object.prototype.toString.apply(e)},each:function(e,t){var o;if(this.isArray(e)||void 0!==e&&void 0!==e.length)for(o=0;o<e.length;o+=1)t.apply(e[o],[o]);else for(o in e)t.apply(e[o],[o])},getRootDomain:function(e){if(!e)return e;var t=e.split("."),o=t.length;return o<=2?e:t[o-2]+"."+t[o-1]}});