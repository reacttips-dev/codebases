'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var React = require('react');
var conventionUiReact = require('@pipedrive/convention-ui-react');
var styled = require('styled-components');
var PdWysiwyg = require('@pipedrive/pd-wysiwyg');
var moment = require('moment');
var ReactDOM = require('react-dom');
var PipedriveLogger = require('@pipedrive/logger-fe');

function _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }

var React__default = /*#__PURE__*/_interopDefaultLegacy(React);
var styled__default = /*#__PURE__*/_interopDefaultLegacy(styled);
var PdWysiwyg__default = /*#__PURE__*/_interopDefaultLegacy(PdWysiwyg);
var moment__default = /*#__PURE__*/_interopDefaultLegacy(moment);
var ReactDOM__default = /*#__PURE__*/_interopDefaultLegacy(ReactDOM);
var PipedriveLogger__default = /*#__PURE__*/_interopDefaultLegacy(PipedriveLogger);

function _arrayWithHoles(arr) {
  if (Array.isArray(arr)) return arr;
}

var arrayWithHoles = _arrayWithHoles;

function _iterableToArrayLimit(arr, i) {
  if (typeof Symbol === "undefined" || !(Symbol.iterator in Object(arr))) return;
  var _arr = [];
  var _n = true;
  var _d = false;
  var _e = undefined;

  try {
    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {
      _arr.push(_s.value);

      if (i && _arr.length === i) break;
    }
  } catch (err) {
    _d = true;
    _e = err;
  } finally {
    try {
      if (!_n && _i["return"] != null) _i["return"]();
    } finally {
      if (_d) throw _e;
    }
  }

  return _arr;
}

var iterableToArrayLimit = _iterableToArrayLimit;

function _arrayLikeToArray(arr, len) {
  if (len == null || len > arr.length) len = arr.length;

  for (var i = 0, arr2 = new Array(len); i < len; i++) {
    arr2[i] = arr[i];
  }

  return arr2;
}

var arrayLikeToArray = _arrayLikeToArray;

function _unsupportedIterableToArray(o, minLen) {
  if (!o) return;
  if (typeof o === "string") return arrayLikeToArray(o, minLen);
  var n = Object.prototype.toString.call(o).slice(8, -1);
  if (n === "Object" && o.constructor) n = o.constructor.name;
  if (n === "Map" || n === "Set") return Array.from(o);
  if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return arrayLikeToArray(o, minLen);
}

var unsupportedIterableToArray = _unsupportedIterableToArray;

function _nonIterableRest() {
  throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
}

var nonIterableRest = _nonIterableRest;

function _slicedToArray(arr, i) {
  return arrayWithHoles(arr) || iterableToArrayLimit(arr, i) || unsupportedIterableToArray(arr, i) || nonIterableRest();
}

var slicedToArray = _slicedToArray;

var global$1 = (typeof global !== "undefined" ? global :
            typeof self !== "undefined" ? self :
            typeof window !== "undefined" ? window : {});

var o="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global$1?global$1:"undefined"!=typeof self?self:{},i=function(t){return t&&t.Math==Math&&t},u=i("object"==typeof globalThis&&globalThis)||i("object"==typeof window&&window)||i("object"==typeof self&&self)||i("object"==typeof o&&o)||function(){return this}()||Function("return this")(),c={},a=function(t){try{return !!t()}catch(t){return !0}},f=!a((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),l={},s={}.propertyIsEnumerable,p=Object.getOwnPropertyDescriptor,y=p&&!s.call({1:2},1);l.f=y?function(t){var r=p(this,t);return !!r&&r.enumerable}:s;var v,g,b=function(t,r){return {enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:r}},d={}.toString,h=function(t){return d.call(t).slice(8,-1)},m=h,w="".split,O=a((function(){return !Object("z").propertyIsEnumerable(0)}))?function(t){return "String"==m(t)?w.call(t,""):Object(t)}:Object,j=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t},S=O,P=j,E=function(t){return S(P(t))},x=function(t){return "object"==typeof t?null!==t:"function"==typeof t},T={},k=T,_=u,A=function(t){return "function"==typeof t?t:void 0},C=function(t,r){return arguments.length<2?A(k[t])||A(_[t]):k[t]&&k[t][r]||_[t]&&_[t][r]},M=u,D=C("navigator","userAgent")||"",F=M.process,N=M.Deno,I=F&&F.versions||N&&N.version,R=I&&I.v8;R?g=(v=R.split("."))[0]<4?1:v[0]+v[1]:D&&(!(v=D.match(/Edge\/(\d+)/))||v[1]>=74)&&(v=D.match(/Chrome\/(\d+)/))&&(g=v[1]);var z=g&&+g,W=z,L=a,U=!!Object.getOwnPropertySymbols&&!L((function(){var t=Symbol();return !String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&W&&W<41})),B=U&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,J=C,q=B?function(t){return "symbol"==typeof t}:function(t){var r=J("Symbol");return "function"==typeof r&&Object(t)instanceof r},G=x,K={exports:{}},Q=u,V=function(t,r){try{Object.defineProperty(Q,t,{value:r,configurable:!0,writable:!0});}catch(n){Q[t]=r;}return r},X=u["__core-js_shared__"]||V("__core-js_shared__",{}),Y=X;(K.exports=function(t,r){return Y[t]||(Y[t]=void 0!==r?r:{})})("versions",[]).push({version:"3.16.2",mode:"pure",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"});var H=j,Z=function(t){return Object(H(t))},$=Z,tt={}.hasOwnProperty,rt=Object.hasOwn||function(t,r){return tt.call($(t),r)},nt=0,et=Math.random(),ot=function(t){return "Symbol("+String(void 0===t?"":t)+")_"+(++nt+et).toString(36)},it=u,ut=K.exports,ct=rt,at=ot,ft=U,lt=B,st=ut("wks"),pt=it.Symbol,yt=lt?pt:pt&&pt.withoutSetter||at,vt=function(t){return ct(st,t)&&(ft||"string"==typeof st[t])||(ft&&ct(pt,t)?st[t]=pt[t]:st[t]=yt("Symbol."+t)),st[t]},gt=x,bt=q,dt=function(t,r){var n,e;if("string"===r&&"function"==typeof(n=t.toString)&&!G(e=n.call(t)))return e;if("function"==typeof(n=t.valueOf)&&!G(e=n.call(t)))return e;if("string"!==r&&"function"==typeof(n=t.toString)&&!G(e=n.call(t)))return e;throw TypeError("Can't convert object to primitive value")},ht=vt("toPrimitive"),mt=function(t,r){if(!gt(t)||bt(t))return t;var n,e=t[ht];if(void 0!==e){if(void 0===r&&(r="default"),n=e.call(t,r),!gt(n)||bt(n))return n;throw TypeError("Can't convert object to primitive value")}return void 0===r&&(r="number"),dt(t,r)},wt=q,Ot=function(t){var r=mt(t,"string");return wt(r)?r:String(r)},jt=x,St=u.document,Pt=jt(St)&&jt(St.createElement),Et=function(t){return Pt?St.createElement(t):{}},xt=Et,Tt=!f&&!a((function(){return 7!=Object.defineProperty(xt("div"),"a",{get:function(){return 7}}).a})),kt=f,_t=l,At=b,Ct=E,Mt=Ot,Dt=rt,Ft=Tt,Nt=Object.getOwnPropertyDescriptor;c.f=kt?Nt:function(t,r){if(t=Ct(t),r=Mt(r),Ft)try{return Nt(t,r)}catch(t){}if(Dt(t,r))return At(!_t.f.call(t,r),t[r])};var It=a,Rt=/#|\.prototype\./,zt=function(t,r){var n=Lt[Wt(t)];return n==Bt||n!=Ut&&("function"==typeof r?It(r):!!r)},Wt=zt.normalize=function(t){return String(t).replace(Rt,".").toLowerCase()},Lt=zt.data={},Ut=zt.NATIVE="N",Bt=zt.POLYFILL="P",Jt=zt,qt=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t},Gt=qt,Kt=function(t,r,n){if(Gt(t),void 0===r)return t;switch(n){case 0:return function(){return t.call(r)};case 1:return function(n){return t.call(r,n)};case 2:return function(n,e){return t.call(r,n,e)};case 3:return function(n,e,o){return t.call(r,n,e,o)}}return function(){return t.apply(r,arguments)}},Qt={},Vt=x,Xt=function(t){if(!Vt(t))throw TypeError(String(t)+" is not an object");return t},Yt=f,Ht=Tt,Zt=Xt,$t=Ot,tr=Object.defineProperty;Qt.f=Yt?tr:function(t,r,n){if(Zt(t),r=$t(r),Zt(n),Ht)try{return tr(t,r,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return "value"in n&&(t[r]=n.value),t};var rr=Qt,nr=b,er=f?function(t,r,n){return rr.f(t,r,nr(1,n))}:function(t,r,n){return t[r]=n,t},or=u,ir=c.f,ur=Jt,cr=T,ar=Kt,fr=er,lr=rt,sr=function(t){var r=function(r,n,e){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(r);case 2:return new t(r,n)}return new t(r,n,e)}return t.apply(this,arguments)};return r.prototype=t.prototype,r},pr=function(t,r){var n,e,o,i,u,c,a,f,l=t.target,s=t.global,p=t.stat,y=t.proto,v=s?or:p?or[l]:(or[l]||{}).prototype,g=s?cr:cr[l]||(cr[l]={}),b=g.prototype;for(o in r)n=!ur(s?o:l+(p?".":"#")+o,t.forced)&&v&&lr(v,o),u=g[o],n&&(c=t.noTargetGet?(f=ir(v,o))&&f.value:v[o]),i=n&&c?c:r[o],n&&typeof u==typeof i||(a=t.bind&&n?ar(i,or):t.wrap&&n?sr(i):y&&"function"==typeof i?ar(Function.call,i):i,(t.sham||i&&i.sham||u&&u.sham)&&fr(a,"sham",!0),g[o]=a,y&&(lr(cr,e=l+"Prototype")||fr(cr,e,{}),cr[e][o]=i,t.real&&b&&!b[o]&&fr(b,o,i)));},yr=Math.ceil,vr=Math.floor,gr=function(t){return isNaN(t=+t)?0:(t>0?vr:yr)(t)},br=gr,dr=Math.min,hr=function(t){return t>0?dr(br(t),9007199254740991):0},mr=gr,wr=Math.max,Or=Math.min,jr=E,Sr=hr,Pr=function(t,r){var n=mr(t);return n<0?wr(n+r,0):Or(n,r)},Er=function(t){return function(r,n,e){var o,i=jr(r),u=Sr(i.length),c=Pr(e,u);if(t&&n!=n){for(;u>c;)if((o=i[c++])!=o)return !0}else for(;u>c;c++)if((t||c in i)&&i[c]===n)return t||c||0;return !t&&-1}},xr={includes:Er(!0),indexOf:Er(!1)},Tr={},kr=rt,_r=E,Ar=xr.indexOf,Cr=Tr,Mr=function(t,r){var n,e=_r(t),o=0,i=[];for(n in e)!kr(Cr,n)&&kr(e,n)&&i.push(n);for(;r.length>o;)kr(e,n=r[o++])&&(~Ar(i,n)||i.push(n));return i},Dr=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Fr=Mr,Nr=Dr,Ir=Object.keys||function(t){return Fr(t,Nr)},Rr=Z,zr=Ir;pr({target:"Object",stat:!0,forced:a((function(){zr(1);}))},{keys:function(t){return zr(Rr(t))}});var Wr,Lr=T.Object.keys,Ur=h,Br=Array.isArray||function(t){return "Array"==Ur(t)},Jr=q,qr=Qt,Gr=Xt,Kr=Ir,Qr=f?Object.defineProperties:function(t,r){Gr(t);for(var n,e=Kr(r),o=e.length,i=0;o>i;)qr.f(t,n=e[i++],r[n]);return t},Vr=C("document","documentElement"),Xr=K.exports,Yr=ot,Hr=Xr("keys"),Zr=function(t){return Hr[t]||(Hr[t]=Yr(t))},$r=Xt,tn=Qr,rn=Dr,nn=Tr,en=Vr,on=Et,un=Zr("IE_PROTO"),cn=function(){},an=function(t){return "<script>"+t+"<\/script>"},fn=function(t){t.write(an("")),t.close();var r=t.parentWindow.Object;return t=null,r},ln=function(){try{Wr=new ActiveXObject("htmlfile");}catch(t){}var t,r;ln="undefined"!=typeof document?document.domain&&Wr?fn(Wr):((r=on("iframe")).style.display="none",en.appendChild(r),r.src=String("javascript:"),(t=r.contentWindow.document).open(),t.write(an("document.F=Object")),t.close(),t.F):fn(Wr);for(var n=rn.length;n--;)delete ln.prototype[rn[n]];return ln()};nn[un]=!0;var sn=Object.create||function(t,r){var n;return null!==t?(cn.prototype=$r(t),n=new cn,cn.prototype=null,n[un]=t):n=ln(),void 0===r?n:tn(n,r)},pn={},yn=Mr,vn=Dr.concat("length","prototype");pn.f=Object.getOwnPropertyNames||function(t){return yn(t,vn)};var gn={},bn=E,dn=pn.f,hn={}.toString,mn="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];gn.f=function(t){return mn&&"[object Window]"==hn.call(t)?function(t){try{return dn(t)}catch(t){return mn.slice()}}(t):dn(bn(t))};var wn={};wn.f=Object.getOwnPropertySymbols;var On=er,jn={},Sn=vt;jn.f=Sn;var Pn=T,En=rt,xn=jn,Tn=Qt.f,kn={};kn[vt("toStringTag")]="z";var _n="[object z]"===String(kn),An=_n,Cn=h,Mn=vt("toStringTag"),Dn="Arguments"==Cn(function(){return arguments}()),Fn=An?Cn:function(t){var r,n,e;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,r){try{return t[r]}catch(t){}}(r=Object(t),Mn))?n:Dn?Cn(r):"Object"==(e=Cn(r))&&"function"==typeof r.callee?"Arguments":e},Nn=_n?{}.toString:function(){return "[object "+Fn(this)+"]"},In=_n,Rn=Qt.f,zn=er,Wn=rt,Ln=Nn,Un=vt("toStringTag"),Bn=X,Jn=Function.toString;"function"!=typeof Bn.inspectSource&&(Bn.inspectSource=function(t){return Jn.call(t)});var qn,Gn,Kn,Qn=Bn.inspectSource,Vn=u.WeakMap,Xn="function"==typeof Vn&&/native code/.test(Qn(Vn)),Yn=x,Hn=er,Zn=rt,$n=X,te=Zr,re=Tr,ne=u.WeakMap;if(Xn||$n.state){var ee=$n.state||($n.state=new ne),oe=ee.get,ie=ee.has,ue=ee.set;qn=function(t,r){if(ie.call(ee,t))throw new TypeError("Object already initialized");return r.facade=t,ue.call(ee,t,r),r},Gn=function(t){return oe.call(ee,t)||{}},Kn=function(t){return ie.call(ee,t)};}else {var ce=te("state");re[ce]=!0,qn=function(t,r){if(Zn(t,ce))throw new TypeError("Object already initialized");return r.facade=t,Hn(t,ce,r),r},Gn=function(t){return Zn(t,ce)?t[ce]:{}},Kn=function(t){return Zn(t,ce)};}var ae={set:qn,get:Gn,has:Kn,enforce:function(t){return Kn(t)?Gn(t):qn(t,{})},getterFor:function(t){return function(r){var n;if(!Yn(r)||(n=Gn(r)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return n}}},fe=x,le=Br,se=vt("species"),pe=function(t){var r;return le(t)&&("function"!=typeof(r=t.constructor)||r!==Array&&!le(r.prototype)?fe(r)&&null===(r=r[se])&&(r=void 0):r=void 0),void 0===r?Array:r},ye=Kt,ve=O,ge=Z,be=hr,de=function(t,r){return new(pe(t))(0===r?0:r)},he=[].push,me=function(t){var r=1==t,n=2==t,e=3==t,o=4==t,i=6==t,u=7==t,c=5==t||i;return function(a,f,l,s){for(var p,y,v=ge(a),g=ve(v),b=ye(f,l,3),d=be(g.length),h=0,m=s||de,w=r?m(a,d):n||u?m(a,0):void 0;d>h;h++)if((c||h in g)&&(y=b(p=g[h],h,v),t))if(r)w[h]=y;else if(y)switch(t){case 3:return !0;case 5:return p;case 6:return h;case 2:he.call(w,p);}else switch(t){case 4:return !1;case 7:he.call(w,p);}return i?-1:e||o?o:w}},we={forEach:me(0),map:me(1),filter:me(2),some:me(3),every:me(4),find:me(5),findIndex:me(6),filterReject:me(7)},Oe=pr,je=u,Se=C,Pe=f,Ee=U,xe=a,Te=rt,ke=Br,_e=x,Ae=q,Ce=Xt,Me=Z,De=E,Fe=Ot,Ne=function(t){if(Jr(t))throw TypeError("Cannot convert a Symbol value to a string");return String(t)},Ie=b,Re=sn,ze=Ir,We=pn,Le=gn,Ue=wn,Be=c,Je=Qt,qe=l,Ge=er,Ke=function(t,r,n,e){e&&e.enumerable?t[r]=n:On(t,r,n);},Qe=K.exports,Ve=Tr,Xe=ot,Ye=vt,He=jn,Ze=function(t){var r=Pn.Symbol||(Pn.Symbol={});En(r,t)||Tn(r,t,{value:xn.f(t)});},$e=function(t,r,n,e){if(t){var o=n?t:t.prototype;Wn(o,Un)||Rn(o,Un,{configurable:!0,value:r}),e&&!In&&zn(o,"toString",Ln);}},to=ae,ro=we.forEach,no=Zr("hidden"),eo=Ye("toPrimitive"),oo=to.set,io=to.getterFor("Symbol"),uo=Object.prototype,co=je.Symbol,ao=Se("JSON","stringify"),fo=Be.f,lo=Je.f,so=Le.f,po=qe.f,yo=Qe("symbols"),vo=Qe("op-symbols"),go=Qe("string-to-symbol-registry"),bo=Qe("symbol-to-string-registry"),ho=Qe("wks"),mo=je.QObject,wo=!mo||!mo.prototype||!mo.prototype.findChild,Oo=Pe&&xe((function(){return 7!=Re(lo({},"a",{get:function(){return lo(this,"a",{value:7}).a}})).a}))?function(t,r,n){var e=fo(uo,r);e&&delete uo[r],lo(t,r,n),e&&t!==uo&&lo(uo,r,e);}:lo,jo=function(t,r){var n=yo[t]=Re(co.prototype);return oo(n,{type:"Symbol",tag:t,description:r}),Pe||(n.description=r),n},So=function(t,r,n){t===uo&&So(vo,r,n),Ce(t);var e=Fe(r);return Ce(n),Te(yo,e)?(n.enumerable?(Te(t,no)&&t[no][e]&&(t[no][e]=!1),n=Re(n,{enumerable:Ie(0,!1)})):(Te(t,no)||lo(t,no,Ie(1,{})),t[no][e]=!0),Oo(t,e,n)):lo(t,e,n)},Po=function(t,r){Ce(t);var n=De(r),e=ze(n).concat(ko(n));return ro(e,(function(r){Pe&&!Eo.call(n,r)||So(t,r,n[r]);})),t},Eo=function(t){var r=Fe(t),n=po.call(this,r);return !(this===uo&&Te(yo,r)&&!Te(vo,r))&&(!(n||!Te(this,r)||!Te(yo,r)||Te(this,no)&&this[no][r])||n)},xo=function(t,r){var n=De(t),e=Fe(r);if(n!==uo||!Te(yo,e)||Te(vo,e)){var o=fo(n,e);return !o||!Te(yo,e)||Te(n,no)&&n[no][e]||(o.enumerable=!0),o}},To=function(t){var r=so(De(t)),n=[];return ro(r,(function(t){Te(yo,t)||Te(Ve,t)||n.push(t);})),n},ko=function(t){var r=t===uo,n=so(r?vo:De(t)),e=[];return ro(n,(function(t){!Te(yo,t)||r&&!Te(uo,t)||e.push(yo[t]);})),e};(Ee||(Ke((co=function(){if(this instanceof co)throw TypeError("Symbol is not a constructor");var t=arguments.length&&void 0!==arguments[0]?Ne(arguments[0]):void 0,r=Xe(t),n=function(t){this===uo&&n.call(vo,t),Te(this,no)&&Te(this[no],r)&&(this[no][r]=!1),Oo(this,r,Ie(1,t));};return Pe&&wo&&Oo(uo,r,{configurable:!0,set:n}),jo(r,t)}).prototype,"toString",(function(){return io(this).tag})),Ke(co,"withoutSetter",(function(t){return jo(Xe(t),t)})),qe.f=Eo,Je.f=So,Be.f=xo,We.f=Le.f=To,Ue.f=ko,He.f=function(t){return jo(Ye(t),t)},Pe&&lo(co.prototype,"description",{configurable:!0,get:function(){return io(this).description}})),Oe({global:!0,wrap:!0,forced:!Ee,sham:!Ee},{Symbol:co}),ro(ze(ho),(function(t){Ze(t);})),Oe({target:"Symbol",stat:!0,forced:!Ee},{for:function(t){var r=Ne(t);if(Te(go,r))return go[r];var n=co(r);return go[r]=n,bo[n]=r,n},keyFor:function(t){if(!Ae(t))throw TypeError(t+" is not a symbol");if(Te(bo,t))return bo[t]},useSetter:function(){wo=!0;},useSimple:function(){wo=!1;}}),Oe({target:"Object",stat:!0,forced:!Ee,sham:!Pe},{create:function(t,r){return void 0===r?Re(t):Po(Re(t),r)},defineProperty:So,defineProperties:Po,getOwnPropertyDescriptor:xo}),Oe({target:"Object",stat:!0,forced:!Ee},{getOwnPropertyNames:To,getOwnPropertySymbols:ko}),Oe({target:"Object",stat:!0,forced:xe((function(){Ue.f(1);}))},{getOwnPropertySymbols:function(t){return Ue.f(Me(t))}}),ao)&&Oe({target:"JSON",stat:!0,forced:!Ee||xe((function(){var t=co();return "[null]"!=ao([t])||"{}"!=ao({a:t})||"{}"!=ao(Object(t))}))},{stringify:function(t,r,n){for(var e,o=[t],i=1;arguments.length>i;)o.push(arguments[i++]);if(e=r,(_e(r)||void 0!==t)&&!Ae(t))return ke(r)||(r=function(t,r){if("function"==typeof e&&(r=e.call(this,t,r)),!Ae(r))return r}),o[1]=r,ao.apply(null,o)}});co.prototype[eo]||Ge(co.prototype,eo,co.prototype.valueOf),$e(co,"Symbol"),Ve[no]=!0;var _o=T.Object.getOwnPropertySymbols,Ao=a,Co=z,Mo=vt("species"),Do=we.filter;pr({target:"Array",proto:!0,forced:!function(t){return Co>=51||!Ao((function(){var r=[];return (r.constructor={})[Mo]=function(){return {foo:1}},1!==r[t](Boolean).foo}))}("filter")},{filter:function(t){return Do(this,t,arguments.length>1?arguments[1]:void 0)}});var Fo=T,No=function(t){return Fo[t+"Prototype"]}("Array").filter,zo={exports:{}},Wo=pr,Lo=a,Uo=E,Bo=c.f,Jo=f,qo=Lo((function(){Bo(1);}));Wo({target:"Object",stat:!0,forced:!Jo||qo,sham:!Jo},{getOwnPropertyDescriptor:function(t,r){return Bo(Uo(t),r)}});var Go=T.Object,Ko=zo.exports=function(t,r){return Go.getOwnPropertyDescriptor(t,r)};Go.getOwnPropertyDescriptor.sham&&(Ko.sham=!0);var Vo=pn,Xo=wn,Yo=Xt,Ho=C("Reflect","ownKeys")||function(t){var r=Vo.f(Yo(t)),n=Xo.f;return n?r.concat(n(t)):r},Zo=Ot,$o=Qt,ti=b,ri=Ho,ni=E,ei=c,oi=function(t,r,n){var e=Zo(r);e in t?$o.f(t,e,ti(0,n)):t[e]=n;};pr({target:"Object",stat:!0,sham:!f},{getOwnPropertyDescriptors:function(t){for(var r,n,e=ni(t),o=ei.f,i=ri(e),u={},c=0;i.length>c;)void 0!==(n=o(e,r=i[c++]))&&oi(u,r,n);return u}});var ii,ui=T.Object.getOwnPropertyDescriptors;!function(t){t.Debug="debug",t.Info="info",t.Warn="warn",t.Error="error";}(ii||(ii={}));var gi=qt,bi=x,di=[].slice,hi={},mi=function(t,r,n){if(!(r in hi)){for(var e=[],o=0;o<r;o++)e[o]="a["+o+"]";hi[r]=Function("C,a","return new C("+e.join(",")+")");}return hi[r](t,n)},wi=Function.bind||function(t){var r=gi(this),n=di.call(arguments,1),e=function(){var o=n.concat(di.call(arguments));return this instanceof e?mi(r,o.length,o):r.apply(t,o)};return bi(r.prototype)&&(e.prototype=r.prototype),e},Oi=pr,ji=qt,Si=Xt,Pi=x,Ei=sn,xi=wi,Ti=a,ki=C("Reflect","construct"),_i=Ti((function(){function t(){}return !(ki((function(){}),[],t)instanceof t)})),Ai=!Ti((function(){ki((function(){}));})),Ci=_i||Ai;Oi({target:"Reflect",stat:!0,forced:Ci,sham:Ci},{construct:function(t,r){ji(t),Si(r);var n=arguments.length<3?t:ji(arguments[2]);if(Ai&&!_i)return ki(t,r,n);if(t==n){switch(r.length){case 0:return new t;case 1:return new t(r[0]);case 2:return new t(r[0],r[1]);case 3:return new t(r[0],r[1],r[2]);case 4:return new t(r[0],r[1],r[2],r[3])}var e=[null];return e.push.apply(e,r),new(xi.apply(t,e))}var o=n.prototype,i=Ei(Pi(o)?o:Object.prototype),u=Function.apply.call(t,i,r);return Pi(u)?u:i}});var Mi=T.Reflect.construct;var Li={languageCode:"en",gettext:function(t){return t},dgettext:function(t,r){return r},dcgettext:function(t,r){return r},ngettext:function(t){return t},dngettext:function(t,r){return r},dcngettext:function(t,r){return r},pgettext:function(t,r){return r},dpgettext:function(t,r,n){return n},npgettext:function(t,r){return r},dnpgettext:function(t,r,n){return n},dcnpgettext:function(t,r,n){return n},sprintf:function(){return ""}},Ui=React__default['default'].createContext(null),Bi=function(){var t=React.useContext(Ui);return null===t?(console.error("useTranslator must be used within a TranslatorContext"),Li):t};

function _taggedTemplateLiteral(strings, raw) {
  if (!raw) {
    raw = strings.slice(0);
  }

  return Object.freeze(Object.defineProperties(strings, {
    raw: {
      value: Object.freeze(raw)
    }
  }));
}

var taggedTemplateLiteral = _taggedTemplateLiteral;

function unwrapExports (x) {
	return x && x.__esModule && Object.prototype.hasOwnProperty.call(x, 'default') ? x['default'] : x;
}

function createCommonjsModule(fn, module) {
	return module = { exports: {} }, fn(module, module.exports), module.exports;
}

var variables = createCommonjsModule(function (module, exports) {
exports.__esModule = true;
exports.spacings = exports.elevations = exports.fonts = exports.colors = void 0;
exports.colors = {
    "white": "rgb(255,255,255)",
    "white64": "rgba(255,255,255,.64)",
    "white32": "rgba(255,255,255,.32)",
    "white16": "rgba(255,255,255,.16)",
    "black": "rgb(38,41,44)",
    "blackShade16Opaque": "#202225",
    "blackShade16": "rgb(32,34,37)",
    "black88Opaque": "#404346",
    "black88": "rgba(38,41,44,.88)",
    "black64Opaque": "#747678",
    "black64": "rgba(38,41,44,.64)",
    "black32Opaque": "#b9babb",
    "black32": "rgba(38,41,44,.32)",
    "black24Opaque": "#cbcccd",
    "black24": "rgba(38,41,44,.24)",
    "black16Opaque": "#dcdddd",
    "black16": "rgba(38,41,44,.16)",
    "black12Opaque": "#e5e5e5",
    "black12": "rgba(38,41,44,.12)",
    "black8Opaque": "#eeeeee",
    "black8": "rgba(38,41,44,.08)",
    "black5Opaque": "#f4f4f4",
    "black5": "rgba(38,41,44,.05)",
    "black4Opaque": "#f7f7f7",
    "black4": "rgba(38,41,44,.04)",
    "green": "rgb(8,167,66)",
    "greenShade16Opaque": "#0c923e",
    "greenShade16": "rgb(12,146,62)",
    "green88Opaque": "#26b259",
    "green88": "rgba(8,167,66,.88)",
    "green64Opaque": "#61c786",
    "green64": "rgba(8,167,66,.64)",
    "green32Opaque": "#b0e2c2",
    "green32": "rgba(8,167,66,.32)",
    "green24Opaque": "#c4ead2",
    "green24": "rgba(8,167,66,.24)",
    "green16Opaque": "#d7f1e1",
    "green16": "rgba(8,167,66,.16)",
    "green12Opaque": "#e1f4e8",
    "green12": "rgba(8,167,66,.12)",
    "green8Opaque": "#ecf8f0",
    "green8": "rgba(8,167,66,.08)",
    "blue": "rgb(49,122,226)",
    "blueShade16Opaque": "#2f6cc5",
    "blueShade16": "rgb(47,108,197)",
    "blue88Opaque": "#4a8ae6",
    "blue88": "rgba(49,122,226,.88)",
    "blue64Opaque": "#7baaed",
    "blue64": "rgba(49,122,226,.64)",
    "blue32Opaque": "#bdd4f5",
    "blue32": "rgba(49,122,226,.32)",
    "blue24Opaque": "#cedff8",
    "blue24": "rgba(49,122,226,.24)",
    "blue16Opaque": "#deeafa",
    "blue16": "rgba(49,122,226,.16)",
    "blue12Opaque": "#e6effb",
    "blue12": "rgba(49,122,226,.12)",
    "blue8Opaque": "#eff5fd",
    "blue8": "rgba(49,122,226,.08)",
    "red": "rgb(249,72,57)",
    "redShade16Opaque": "#d64336",
    "redShade16": "rgb(214,67,54)",
    "red88Opaque": "#fa5e51",
    "red88": "rgba(249,72,57,.88)",
    "red64Opaque": "#fb8a80",
    "red64": "rgba(249,72,57,.64)",
    "red32Opaque": "#fdc4bf",
    "red32": "rgba(249,72,57,.32)",
    "red24Opaque": "#fed3d0",
    "red24": "rgba(249,72,57,.24)",
    "red16Opaque": "#fee2df",
    "red16": "rgba(249,72,57,.16)",
    "red12Opaque": "#fee9e7",
    "red12": "rgba(249,72,57,.12)",
    "red8Opaque": "#fff1f0",
    "red8": "rgba(249,72,57,.08)",
    "yellow": "rgb(255,204,0)",
    "yellowShade16Opaque": "#ddb207",
    "yellowShade16": "rgb(221,178,7)",
    "yellow64Opaque": "#ffdf5c",
    "yellow64": "rgba(255,204,0,.64)",
    "yellow16Opaque": "#fff7d6",
    "yellow16": "rgba(255,204,0,.16)",
    "purple": "rgb(114,30,169)",
    "purpleShade16Opaque": "#661f95",
    "purpleShade16": "rgb(102,31,149)",
    "purple64Opaque": "#a56fc8",
    "purple64": "rgba(114,30,169,.64)",
    "purple16Opaque": "#e8dbf1",
    "purple16": "rgba(114,30,169,.16)",
    "highlightYellow": "rgb(255,245,112)",
    "noteYellow": "rgb(255,252,220)",
    "orchid": "#c762ce",
    "steel": "#8ba5af",
    "sky": "#42b7fc",
    "turquoise": "#00d3e4",
    "lime": "#69c97d",
    "kiwi": "#a3d776",
    "lemon": "#ffed27",
    "apricot": "#ffb32b",
    "salmon": "#ff827b",
    "flamingo": "#ff5592"
};
exports.fonts = {
    "fontFamily": "'Source Sans Pro',sans-serif",
    "fontFamilyMonospace": "'Menlo','Consolas','Courier',monospace",
    "fontWeightNormal": "400",
    "fontWeightSemi": "600",
    "fontWeightBold": "600",
    "fontSizeXxl": "27px",
    "fontSizeXl": "23px",
    "fontSizeL": "18px",
    "fontSizeM": "15px",
    "fontSizeS": "13px",
    "fontSizeXs": "11px",
    "lineHeightXxl": "32px",
    "lineHeightXl": "28px",
    "lineHeightL": "24px",
    "lineHeightM": "20px",
    "lineHeightS": "16px",
    "lineHeightXs": "16px",
    "letterSpacingL": ".04em",
    "letterSpacingM": ".03em",
    "fontTitleXxl": "400 27px/32px 'Source Sans Pro',sans-serif",
    "fontTitleXl": "400 23px/28px 'Source Sans Pro',sans-serif",
    "fontTitleL": "600 18px/24px 'Source Sans Pro',sans-serif",
    "fontTitleM": "600 15px/20px 'Source Sans Pro',sans-serif",
    "fontBodyL": "400 18px/24px 'Source Sans Pro',sans-serif",
    "fontBody": "400 15px/20px 'Source Sans Pro',sans-serif",
    "fontBodyS": "400 13px/16px 'Source Sans Pro',sans-serif",
    "fontButton": "600 15px/20px 'Source Sans Pro',sans-serif",
    "fontButtonS": "600 13px/16px 'Source Sans Pro',sans-serif",
    "fontCaption": "600 15px/20px 'Source Sans Pro',sans-serif",
    "fontCaptionS": "600 13px/16px 'Source Sans Pro',sans-serif",
    "fontBadge": "600 11px/16px 'Source Sans Pro',sans-serif",
    "fontMonospace": "400 13px/16px 'Menlo','Consolas','Courier',monospace"
};
exports.elevations = {
    "elevation00": "none",
    "elevation01": "0 0 1px 1px rgba(0,0,0,.05),0 1px 2px -2px rgba(0,0,0,.06),0 1px 3px 0 rgba(0,0,0,.07)",
    "elevation02": "0 0 1px 0 rgba(0,0,0,.16),0 2px 2px 0 rgba(0,0,0,.05),0 3px 1px -2px rgba(0,0,0,.06),0 1px 5px 0 rgba(0,0,0,.1)",
    "elevation03": "0 0 2px 0 rgba(0,0,0,.16),0 3px 4px 0 rgba(0,0,0,.05),0 3px 3px -2px rgba(0,0,0,.06),0 1px 8px 0 rgba(0,0,0,.1)",
    "elevation04": "0 0 1px 1px rgba(0,0,0,.05),0 -1px 2px -2px rgba(0,0,0,.06),0 -1px 3px 0 rgba(0,0,0,.07)",
    "elevation08": "0 0 2px 0 rgba(0,0,0,.24),0 8px 10px 1px rgba(0,0,0,.05),0 3px 14px 2px rgba(0,0,0,.06),0 5px 5px -3px rgba(0,0,0,.1)",
    "elevation16": "0 0 2px 0 rgba(0,0,0,.24),0 16px 24px 2px rgba(0,0,0,.05),0 6px 30px 5px rgba(0,0,0,.06),0 8px 10px -5px rgba(0,0,0,.1)",
    "elevation24": "0 0 2px 0 rgba(0,0,0,.24),0 24px 38px 3px rgba(0,0,0,.05),0 9px 46px 8px rgba(0,0,0,.06),0 11px 15px -7px rgba(0,0,0,.1)"
};
exports.spacings = {
    "spacingXs": "4px",
    "spacingS": "8px",
    "spacingM": "16px",
    "spacingL": "24px",
    "spacingXl": "32px",
    "spacingXxl": "40px"
};
});

unwrapExports(variables);
var variables_1 = variables.spacings;
var variables_2 = variables.elevations;
var variables_3 = variables.fonts;
var variables_4 = variables.colors;

function _templateObject7() {
  var data = taggedTemplateLiteral(["\n\t\t\t&:before {\n\t\t\t\tposition: absolute;\n\t\t\t\tdisplay: block;\n\t\t\t\tcontent: '';\n\t\t\t\ttop: 16px;\n\t\t\t\tleft: -6px;\n\t\t\t\twidth: 10px;\n\t\t\t\theight: 10px;\n\t\t\t\tborder-top: 1px solid ", ";\n\t\t\t\tborder-left: 1px solid ", ";\n\t\t\t\tbackground: ", ";\n\t\t\t\ttransform: rotate(-45deg);\n\t\t\t}\n\t\t"]);

  _templateObject7 = function _templateObject7() {
    return data;
  };

  return data;
}

function _templateObject6() {
  var data = taggedTemplateLiteral(["\n\tmax-width: 100%;\n\tbox-sizing: border-box;\n\tborder-radius: 2px;\n\tposition: relative;\n\tmargin-bottom: 16px;\n\n\t", "\n\t", "\n\t", "\n\t", "\n"]);

  _templateObject6 = function _templateObject6() {
    return data;
  };

  return data;
}

function _templateObject5() {
  var data = taggedTemplateLiteral(["\n\tborder: 1px solid ", ";\n\tpadding: 12px;\n"]);

  _templateObject5 = function _templateObject5() {
    return data;
  };

  return data;
}

function _templateObject4() {
  var data = taggedTemplateLiteral(["\n\t&:hover {\n\t\tbackground: ", ";\n\t\tcursor: pointer;\n\t}\n"]);

  _templateObject4 = function _templateObject4() {
    return data;
  };

  return data;
}

function _templateObject3() {
  var data = taggedTemplateLiteral(["\n\tbackground: ", ";\n"]);

  _templateObject3 = function _templateObject3() {
    return data;
  };

  return data;
}

function _templateObject2() {
  var data = taggedTemplateLiteral(["\n\tz-index: 2;\n\tposition: relative;\n"]);

  _templateObject2 = function _templateObject2() {
    return data;
  };

  return data;
}

function _templateObject() {
  var data = taggedTemplateLiteral(["\n\tposition: absolute;\n\tleft: -28px;\n\ttop: 14px;\n\t&:before {\n\t\tz-index: 1;\n\t\tdisplay: block;\n\t\tcontent: '';\n\t\twidth: 24px;\n\t\theight: 26px;\n\t\tbackground: ", ";\n\t\tposition: absolute;\n\t\ttop: 50%;\n\t\tleft: 50%;\n\t\ttransform: translate3d(-50%, -60%, 0);\n\t}\n"]);

  _templateObject = function _templateObject() {
    return data;
  };

  return data;
}
var IconContainer = styled__default['default'].div(_templateObject(), variables_4.white);
var ItemIcon = styled__default['default'](conventionUiReact.Icon)(_templateObject2());
var noteBackground = styled.css(_templateObject3(), variables_4.noteYellow);
var hoverCSS = styled.css(_templateObject4(), variables_4.black4);
var boxWithBorder = styled.css(_templateObject5(), variables_4.black16);
var ItemBoxWrapper = styled__default['default'].div(_templateObject6(), function (_ref) {
  var background = _ref.background;
  return background === 'note' && noteBackground;
}, function (_ref2) {
  var displayHover = _ref2.displayHover;
  return displayHover && hoverCSS;
}, function (_ref3) {
  var displayBorder = _ref3.displayBorder;
  return displayBorder && boxWithBorder;
}, function (_ref4) {
  var displayIcon = _ref4.displayIcon,
      background = _ref4.background;
  return displayIcon && styled.css(_templateObject7(), variables_4.black16, variables_4.black16, background === 'note' ? variables_4.noteYellow : variables_4.white);
});

var ItemBox = function ItemBox(_ref) {
  var _ref$background = _ref.background,
      background = _ref$background === void 0 ? 'none' : _ref$background,
      children = _ref.children,
      iconType = _ref.iconType,
      isDone = _ref.isDone,
      _ref$displayIcon = _ref.displayIcon,
      displayIcon = _ref$displayIcon === void 0 ? true : _ref$displayIcon,
      _ref$displayHover = _ref.displayHover,
      displayHover = _ref$displayHover === void 0 ? false : _ref$displayHover,
      _ref$displayBorder = _ref.displayBorder,
      displayBorder = _ref$displayBorder === void 0 ? true : _ref$displayBorder;
  var iconColor = isDone ? 'black-32' : 'black-64';
  return /*#__PURE__*/React__default['default'].createElement(ItemBoxWrapper, {
    background: background,
    displayIcon: displayIcon,
    displayHover: displayHover,
    displayBorder: displayBorder
  }, iconType && /*#__PURE__*/React__default['default'].createElement(IconContainer, null, /*#__PURE__*/React__default['default'].createElement(ItemIcon, {
    icon: iconType,
    size: "s",
    color: iconColor
  })), children);
};
ItemBox.displayName = "ItemBox";

function _defineProperty(obj, key, value) {
  if (key in obj) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
  } else {
    obj[key] = value;
  }

  return obj;
}

var defineProperty = _defineProperty;

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

function _createForOfIteratorHelper(o, allowArrayLike) { var it; if (typeof Symbol === "undefined" || o[Symbol.iterator] == null) { if (Array.isArray(o) || (it = _unsupportedIterableToArray$1(o)) || allowArrayLike && o && typeof o.length === "number") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method."); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = o[Symbol.iterator](); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it["return"] != null) it["return"](); } finally { if (didErr) throw err; } } }; }

function _unsupportedIterableToArray$1(o, minLen) { if (!o) return; if (typeof o === "string") return _arrayLikeToArray$1(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === "Object" && o.constructor) n = o.constructor.name; if (n === "Map" || n === "Set") return Array.from(o); if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray$1(o, minLen); }

function _arrayLikeToArray$1(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) { arr2[i] = arr[i]; } return arr2; }

function findChildrenByName(children, names) {
  var _iterator = _createForOfIteratorHelper(names),
      _step;

  try {
    for (_iterator.s(); !(_step = _iterator.n()).done;) {
      var name = _step.value;
      // eslint-disable-next-line @typescript-eslint/no-explicit-any
      var displayName = (children.type || {}).displayName;

      if (displayName === name) {
        return defineProperty({}, name, children);
      }
    }
  } catch (err) {
    _iterator.e(err);
  } finally {
    _iterator.f();
  }

  return {};
}
function useComponentChildren(children, names) {
  function transformChildren() {
    var flattenChildren = React__default['default'].Children.toArray(children);
    return flattenChildren.reduce(function (acc, children) {
      if (! /*#__PURE__*/React__default['default'].isValidElement(children)) {
        return acc;
      }

      return _objectSpread(_objectSpread({}, acc), findChildrenByName(children, names));
    }, {});
  }

  return React.useMemo(transformChildren, [children]);
}

var ConditionalWrapper = function ConditionalWrapper(_ref) {
  var condition = _ref.condition,
      wrapper = _ref.wrapper,
      children = _ref.children;
  return condition ? wrapper(children) : children;
};

function _templateObject3$1() {
  var data = taggedTemplateLiteral(["\n\tposition: absolute;\n\ttop: 50%;\n\tleft: 50%;\n\ttransform: translate(-50%, -50%);\n"]);

  _templateObject3$1 = function _templateObject3() {
    return data;
  };

  return data;
}

function _templateObject2$1() {
  var data = taggedTemplateLiteral(["\n\tposition: relative;\n"]);

  _templateObject2$1 = function _templateObject2() {
    return data;
  };

  return data;
}

function _templateObject$1() {
  var data = taggedTemplateLiteral(["\n\topacity: 40%;\n"]);

  _templateObject$1 = function _templateObject() {
    return data;
  };

  return data;
}
var FadedWrapper = styled__default['default'].div(_templateObject$1());
var Wrapper = styled__default['default'].div(_templateObject2$1());
var Loader = styled__default['default'](conventionUiReact.Spinner)(_templateObject3$1());
var OverlayWrapper = function OverlayWrapper(_ref) {
  var children = _ref.children;
  return /*#__PURE__*/React__default['default'].createElement(Wrapper, null, /*#__PURE__*/React__default['default'].createElement(Loader, {
    size: "s"
  }), /*#__PURE__*/React__default['default'].createElement(FadedWrapper, null, children));
};
OverlayWrapper.displayName = "OverlayWrapper";

function _templateObject8() {
  var data = taggedTemplateLiteral(["\n\tmargin: 8px -12px -12px -12px;\n\tpadding: 12px;\n\tborder-top: 1px solid ", ";\n\tbackground: ", ";\n"]);

  _templateObject8 = function _templateObject8() {
    return data;
  };

  return data;
}

function _templateObject7$1() {
  var data = taggedTemplateLiteral([""]);

  _templateObject7$1 = function _templateObject7() {
    return data;
  };

  return data;
}

function _templateObject6$1() {
  var data = taggedTemplateLiteral(["\n\tdisplay: inline-block;\n\tpadding-left: 4px;\n\tpadding-right: 4px;\n\tcolor: ", ";\n"]);

  _templateObject6$1 = function _templateObject6() {
    return data;
  };

  return data;
}

function _templateObject5$1() {
  var data = taggedTemplateLiteral(["\n\tword-break: break-all;\n\tfont-size: 15px;\n\tline-height: 1.33;\n\twidth: 100%;\n\tcolor: ", ";\n\tfont-weight: ", ";\n\t/* cui tooltip element wrapping div */\n\t& > div {\n\t\tdisplay: inline-block;\n\t\tposition: relative;\n\t}\n"]);

  _templateObject5$1 = function _templateObject5() {
    return data;
  };

  return data;
}

function _templateObject4$1() {
  var data = taggedTemplateLiteral(["\n\tdisplay: flex;\n\talign-items: flex-start;\n\tpadding-right: 40px;\n\tposition: relative;\n\ttop: -3px;\n"]);

  _templateObject4$1 = function _templateObject4() {
    return data;
  };

  return data;
}

function _templateObject3$2() {
  var data = taggedTemplateLiteral(["\n\tfont-size: 13px;\n\tline-height: 1.23;\n\tletter-spacing: normal;\n\tcolor: ", ";\n"]);

  _templateObject3$2 = function _templateObject3() {
    return data;
  };

  return data;
}

function _templateObject2$2() {
  var data = taggedTemplateLiteral(["\n\tdisplay: flex;\n\tflex-direction: column;\n"]);

  _templateObject2$2 = function _templateObject2() {
    return data;
  };

  return data;
}

function _templateObject$2() {
  var data = taggedTemplateLiteral(["\n\twidth: 16px;\n\theight: 16px;\n\tbackground: ", ";\n\tborder: none;\n\tposition: relative;\n\tcursor: pointer;\n\tpadding: 4px;\n\tbox-sizing: content-box;\n\toutline: none;\n\ttop: 0;\n\tleft: -2px;\n\tmargin-right: 2px;\n\tvertical-align: middle;\n\n\t&:before {\n\t\tdisplay: block;\n\t\tcontent: '';\n\t\tbackground: ", ";\n\t\tbox-sizing: border-box;\n\t\tborder: 2px solid transparent;\n\t\tborder-radius: 50%;\n\t\tposition: absolute;\n\t\tleft: 4px;\n\t\ttop: 4px;\n\t\twidth: 16px;\n\t\theight: 16px;\n\t\ttransition: border-color 150ms;\n\t\tborder-color: ", ";\n\t}\n\t&:hover:before {\n\t\tborder: 2px solid ", ";\n\t}\n\n\t.cui4-icon {\n\t\tposition: relative;\n\t\tz-index: 1;\n\t}\n"]);

  _templateObject$2 = function _templateObject() {
    return data;
  };

  return data;
}
var MarkAsDoneButton = styled__default['default'].button(_templateObject$2(), variables_4.white, function (_ref) {
  var isDone = _ref.isDone;
  return isDone ? variables_4.green : variables_4.white;
}, function (_ref2) {
  var isDone = _ref2.isDone;
  return isDone ? variables_4.green : variables_4.black32;
}, variables_4.green);
var CardContent = styled__default['default'].div(_templateObject2$2());
var SubText = styled__default['default'].span(_templateObject3$2(), variables_4.black64);
var CardTitle = styled__default['default'].div(_templateObject4$1());
var Title = styled__default['default'].div(_templateObject5$1(), variables_4.black, function (props) {
  return props.isDone ? variables_3.fontWeightNormal : variables_3.fontWeightBold;
});
var Separator = styled__default['default'].span(_templateObject6$1(), variables_4.black64);
var Row = styled__default['default'].div(_templateObject7$1());
var ActivityNote = styled__default['default'].div(_templateObject8(), variables_4.black16, variables_4.noteYellow);

function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {
  try {
    var info = gen[key](arg);
    var value = info.value;
  } catch (error) {
    reject(error);
    return;
  }

  if (info.done) {
    resolve(value);
  } else {
    Promise.resolve(value).then(_next, _throw);
  }
}

function _asyncToGenerator(fn) {
  return function () {
    var self = this,
        args = arguments;
    return new Promise(function (resolve, reject) {
      var gen = fn.apply(self, args);

      function _next(value) {
        asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value);
      }

      function _throw(err) {
        asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err);
      }

      _next(undefined);
    });
  };
}

var asyncToGenerator = _asyncToGenerator;

function unwrapExports$1 (x) {
	return x && x.__esModule && Object.prototype.hasOwnProperty.call(x, 'default') ? x['default'] : x;
}

function createCommonjsModule$1(fn, module) {
	return module = { exports: {} }, fn(module, module.exports), module.exports;
}

/**
 * cssfilter
 *
 * @author 老雷<leizongmin@gmail.com>
 */

function getDefaultWhiteList () {
  // 白名单值说明：
  // true: 允许该属性
  // Function: function (val) { } 返回true表示允许该属性，其他值均表示不允许
  // RegExp: regexp.test(val) 返回true表示允许该属性，其他值均表示不允许
  // 除上面列出的值外均表示不允许
  var whiteList = {};

  whiteList['align-content'] = false; // default: auto
  whiteList['align-items'] = false; // default: auto
  whiteList['align-self'] = false; // default: auto
  whiteList['alignment-adjust'] = false; // default: auto
  whiteList['alignment-baseline'] = false; // default: baseline
  whiteList['all'] = false; // default: depending on individual properties
  whiteList['anchor-point'] = false; // default: none
  whiteList['animation'] = false; // default: depending on individual properties
  whiteList['animation-delay'] = false; // default: 0
  whiteList['animation-direction'] = false; // default: normal
  whiteList['animation-duration'] = false; // default: 0
  whiteList['animation-fill-mode'] = false; // default: none
  whiteList['animation-iteration-count'] = false; // default: 1
  whiteList['animation-name'] = false; // default: none
  whiteList['animation-play-state'] = false; // default: running
  whiteList['animation-timing-function'] = false; // default: ease
  whiteList['azimuth'] = false; // default: center
  whiteList['backface-visibility'] = false; // default: visible
  whiteList['background'] = true; // default: depending on individual properties
  whiteList['background-attachment'] = true; // default: scroll
  whiteList['background-clip'] = true; // default: border-box
  whiteList['background-color'] = true; // default: transparent
  whiteList['background-image'] = true; // default: none
  whiteList['background-origin'] = true; // default: padding-box
  whiteList['background-position'] = true; // default: 0% 0%
  whiteList['background-repeat'] = true; // default: repeat
  whiteList['background-size'] = true; // default: auto
  whiteList['baseline-shift'] = false; // default: baseline
  whiteList['binding'] = false; // default: none
  whiteList['bleed'] = false; // default: 6pt
  whiteList['bookmark-label'] = false; // default: content()
  whiteList['bookmark-level'] = false; // default: none
  whiteList['bookmark-state'] = false; // default: open
  whiteList['border'] = true; // default: depending on individual properties
  whiteList['border-bottom'] = true; // default: depending on individual properties
  whiteList['border-bottom-color'] = true; // default: current color
  whiteList['border-bottom-left-radius'] = true; // default: 0
  whiteList['border-bottom-right-radius'] = true; // default: 0
  whiteList['border-bottom-style'] = true; // default: none
  whiteList['border-bottom-width'] = true; // default: medium
  whiteList['border-collapse'] = true; // default: separate
  whiteList['border-color'] = true; // default: depending on individual properties
  whiteList['border-image'] = true; // default: none
  whiteList['border-image-outset'] = true; // default: 0
  whiteList['border-image-repeat'] = true; // default: stretch
  whiteList['border-image-slice'] = true; // default: 100%
  whiteList['border-image-source'] = true; // default: none
  whiteList['border-image-width'] = true; // default: 1
  whiteList['border-left'] = true; // default: depending on individual properties
  whiteList['border-left-color'] = true; // default: current color
  whiteList['border-left-style'] = true; // default: none
  whiteList['border-left-width'] = true; // default: medium
  whiteList['border-radius'] = true; // default: 0
  whiteList['border-right'] = true; // default: depending on individual properties
  whiteList['border-right-color'] = true; // default: current color
  whiteList['border-right-style'] = true; // default: none
  whiteList['border-right-width'] = true; // default: medium
  whiteList['border-spacing'] = true; // default: 0
  whiteList['border-style'] = true; // default: depending on individual properties
  whiteList['border-top'] = true; // default: depending on individual properties
  whiteList['border-top-color'] = true; // default: current color
  whiteList['border-top-left-radius'] = true; // default: 0
  whiteList['border-top-right-radius'] = true; // default: 0
  whiteList['border-top-style'] = true; // default: none
  whiteList['border-top-width'] = true; // default: medium
  whiteList['border-width'] = true; // default: depending on individual properties
  whiteList['bottom'] = false; // default: auto
  whiteList['box-decoration-break'] = true; // default: slice
  whiteList['box-shadow'] = true; // default: none
  whiteList['box-sizing'] = true; // default: content-box
  whiteList['box-snap'] = true; // default: none
  whiteList['box-suppress'] = true; // default: show
  whiteList['break-after'] = true; // default: auto
  whiteList['break-before'] = true; // default: auto
  whiteList['break-inside'] = true; // default: auto
  whiteList['caption-side'] = false; // default: top
  whiteList['chains'] = false; // default: none
  whiteList['clear'] = true; // default: none
  whiteList['clip'] = false; // default: auto
  whiteList['clip-path'] = false; // default: none
  whiteList['clip-rule'] = false; // default: nonzero
  whiteList['color'] = true; // default: implementation dependent
  whiteList['color-interpolation-filters'] = true; // default: auto
  whiteList['column-count'] = false; // default: auto
  whiteList['column-fill'] = false; // default: balance
  whiteList['column-gap'] = false; // default: normal
  whiteList['column-rule'] = false; // default: depending on individual properties
  whiteList['column-rule-color'] = false; // default: current color
  whiteList['column-rule-style'] = false; // default: medium
  whiteList['column-rule-width'] = false; // default: medium
  whiteList['column-span'] = false; // default: none
  whiteList['column-width'] = false; // default: auto
  whiteList['columns'] = false; // default: depending on individual properties
  whiteList['contain'] = false; // default: none
  whiteList['content'] = false; // default: normal
  whiteList['counter-increment'] = false; // default: none
  whiteList['counter-reset'] = false; // default: none
  whiteList['counter-set'] = false; // default: none
  whiteList['crop'] = false; // default: auto
  whiteList['cue'] = false; // default: depending on individual properties
  whiteList['cue-after'] = false; // default: none
  whiteList['cue-before'] = false; // default: none
  whiteList['cursor'] = false; // default: auto
  whiteList['direction'] = false; // default: ltr
  whiteList['display'] = true; // default: depending on individual properties
  whiteList['display-inside'] = true; // default: auto
  whiteList['display-list'] = true; // default: none
  whiteList['display-outside'] = true; // default: inline-level
  whiteList['dominant-baseline'] = false; // default: auto
  whiteList['elevation'] = false; // default: level
  whiteList['empty-cells'] = false; // default: show
  whiteList['filter'] = false; // default: none
  whiteList['flex'] = false; // default: depending on individual properties
  whiteList['flex-basis'] = false; // default: auto
  whiteList['flex-direction'] = false; // default: row
  whiteList['flex-flow'] = false; // default: depending on individual properties
  whiteList['flex-grow'] = false; // default: 0
  whiteList['flex-shrink'] = false; // default: 1
  whiteList['flex-wrap'] = false; // default: nowrap
  whiteList['float'] = false; // default: none
  whiteList['float-offset'] = false; // default: 0 0
  whiteList['flood-color'] = false; // default: black
  whiteList['flood-opacity'] = false; // default: 1
  whiteList['flow-from'] = false; // default: none
  whiteList['flow-into'] = false; // default: none
  whiteList['font'] = true; // default: depending on individual properties
  whiteList['font-family'] = true; // default: implementation dependent
  whiteList['font-feature-settings'] = true; // default: normal
  whiteList['font-kerning'] = true; // default: auto
  whiteList['font-language-override'] = true; // default: normal
  whiteList['font-size'] = true; // default: medium
  whiteList['font-size-adjust'] = true; // default: none
  whiteList['font-stretch'] = true; // default: normal
  whiteList['font-style'] = true; // default: normal
  whiteList['font-synthesis'] = true; // default: weight style
  whiteList['font-variant'] = true; // default: normal
  whiteList['font-variant-alternates'] = true; // default: normal
  whiteList['font-variant-caps'] = true; // default: normal
  whiteList['font-variant-east-asian'] = true; // default: normal
  whiteList['font-variant-ligatures'] = true; // default: normal
  whiteList['font-variant-numeric'] = true; // default: normal
  whiteList['font-variant-position'] = true; // default: normal
  whiteList['font-weight'] = true; // default: normal
  whiteList['grid'] = false; // default: depending on individual properties
  whiteList['grid-area'] = false; // default: depending on individual properties
  whiteList['grid-auto-columns'] = false; // default: auto
  whiteList['grid-auto-flow'] = false; // default: none
  whiteList['grid-auto-rows'] = false; // default: auto
  whiteList['grid-column'] = false; // default: depending on individual properties
  whiteList['grid-column-end'] = false; // default: auto
  whiteList['grid-column-start'] = false; // default: auto
  whiteList['grid-row'] = false; // default: depending on individual properties
  whiteList['grid-row-end'] = false; // default: auto
  whiteList['grid-row-start'] = false; // default: auto
  whiteList['grid-template'] = false; // default: depending on individual properties
  whiteList['grid-template-areas'] = false; // default: none
  whiteList['grid-template-columns'] = false; // default: none
  whiteList['grid-template-rows'] = false; // default: none
  whiteList['hanging-punctuation'] = false; // default: none
  whiteList['height'] = true; // default: auto
  whiteList['hyphens'] = false; // default: manual
  whiteList['icon'] = false; // default: auto
  whiteList['image-orientation'] = false; // default: auto
  whiteList['image-resolution'] = false; // default: normal
  whiteList['ime-mode'] = false; // default: auto
  whiteList['initial-letters'] = false; // default: normal
  whiteList['inline-box-align'] = false; // default: last
  whiteList['justify-content'] = false; // default: auto
  whiteList['justify-items'] = false; // default: auto
  whiteList['justify-self'] = false; // default: auto
  whiteList['left'] = false; // default: auto
  whiteList['letter-spacing'] = true; // default: normal
  whiteList['lighting-color'] = true; // default: white
  whiteList['line-box-contain'] = false; // default: block inline replaced
  whiteList['line-break'] = false; // default: auto
  whiteList['line-grid'] = false; // default: match-parent
  whiteList['line-height'] = false; // default: normal
  whiteList['line-snap'] = false; // default: none
  whiteList['line-stacking'] = false; // default: depending on individual properties
  whiteList['line-stacking-ruby'] = false; // default: exclude-ruby
  whiteList['line-stacking-shift'] = false; // default: consider-shifts
  whiteList['line-stacking-strategy'] = false; // default: inline-line-height
  whiteList['list-style'] = true; // default: depending on individual properties
  whiteList['list-style-image'] = true; // default: none
  whiteList['list-style-position'] = true; // default: outside
  whiteList['list-style-type'] = true; // default: disc
  whiteList['margin'] = true; // default: depending on individual properties
  whiteList['margin-bottom'] = true; // default: 0
  whiteList['margin-left'] = true; // default: 0
  whiteList['margin-right'] = true; // default: 0
  whiteList['margin-top'] = true; // default: 0
  whiteList['marker-offset'] = false; // default: auto
  whiteList['marker-side'] = false; // default: list-item
  whiteList['marks'] = false; // default: none
  whiteList['mask'] = false; // default: border-box
  whiteList['mask-box'] = false; // default: see individual properties
  whiteList['mask-box-outset'] = false; // default: 0
  whiteList['mask-box-repeat'] = false; // default: stretch
  whiteList['mask-box-slice'] = false; // default: 0 fill
  whiteList['mask-box-source'] = false; // default: none
  whiteList['mask-box-width'] = false; // default: auto
  whiteList['mask-clip'] = false; // default: border-box
  whiteList['mask-image'] = false; // default: none
  whiteList['mask-origin'] = false; // default: border-box
  whiteList['mask-position'] = false; // default: center
  whiteList['mask-repeat'] = false; // default: no-repeat
  whiteList['mask-size'] = false; // default: border-box
  whiteList['mask-source-type'] = false; // default: auto
  whiteList['mask-type'] = false; // default: luminance
  whiteList['max-height'] = true; // default: none
  whiteList['max-lines'] = false; // default: none
  whiteList['max-width'] = true; // default: none
  whiteList['min-height'] = true; // default: 0
  whiteList['min-width'] = true; // default: 0
  whiteList['move-to'] = false; // default: normal
  whiteList['nav-down'] = false; // default: auto
  whiteList['nav-index'] = false; // default: auto
  whiteList['nav-left'] = false; // default: auto
  whiteList['nav-right'] = false; // default: auto
  whiteList['nav-up'] = false; // default: auto
  whiteList['object-fit'] = false; // default: fill
  whiteList['object-position'] = false; // default: 50% 50%
  whiteList['opacity'] = false; // default: 1
  whiteList['order'] = false; // default: 0
  whiteList['orphans'] = false; // default: 2
  whiteList['outline'] = false; // default: depending on individual properties
  whiteList['outline-color'] = false; // default: invert
  whiteList['outline-offset'] = false; // default: 0
  whiteList['outline-style'] = false; // default: none
  whiteList['outline-width'] = false; // default: medium
  whiteList['overflow'] = false; // default: depending on individual properties
  whiteList['overflow-wrap'] = false; // default: normal
  whiteList['overflow-x'] = false; // default: visible
  whiteList['overflow-y'] = false; // default: visible
  whiteList['padding'] = true; // default: depending on individual properties
  whiteList['padding-bottom'] = true; // default: 0
  whiteList['padding-left'] = true; // default: 0
  whiteList['padding-right'] = true; // default: 0
  whiteList['padding-top'] = true; // default: 0
  whiteList['page'] = false; // default: auto
  whiteList['page-break-after'] = false; // default: auto
  whiteList['page-break-before'] = false; // default: auto
  whiteList['page-break-inside'] = false; // default: auto
  whiteList['page-policy'] = false; // default: start
  whiteList['pause'] = false; // default: implementation dependent
  whiteList['pause-after'] = false; // default: implementation dependent
  whiteList['pause-before'] = false; // default: implementation dependent
  whiteList['perspective'] = false; // default: none
  whiteList['perspective-origin'] = false; // default: 50% 50%
  whiteList['pitch'] = false; // default: medium
  whiteList['pitch-range'] = false; // default: 50
  whiteList['play-during'] = false; // default: auto
  whiteList['position'] = false; // default: static
  whiteList['presentation-level'] = false; // default: 0
  whiteList['quotes'] = false; // default: text
  whiteList['region-fragment'] = false; // default: auto
  whiteList['resize'] = false; // default: none
  whiteList['rest'] = false; // default: depending on individual properties
  whiteList['rest-after'] = false; // default: none
  whiteList['rest-before'] = false; // default: none
  whiteList['richness'] = false; // default: 50
  whiteList['right'] = false; // default: auto
  whiteList['rotation'] = false; // default: 0
  whiteList['rotation-point'] = false; // default: 50% 50%
  whiteList['ruby-align'] = false; // default: auto
  whiteList['ruby-merge'] = false; // default: separate
  whiteList['ruby-position'] = false; // default: before
  whiteList['shape-image-threshold'] = false; // default: 0.0
  whiteList['shape-outside'] = false; // default: none
  whiteList['shape-margin'] = false; // default: 0
  whiteList['size'] = false; // default: auto
  whiteList['speak'] = false; // default: auto
  whiteList['speak-as'] = false; // default: normal
  whiteList['speak-header'] = false; // default: once
  whiteList['speak-numeral'] = false; // default: continuous
  whiteList['speak-punctuation'] = false; // default: none
  whiteList['speech-rate'] = false; // default: medium
  whiteList['stress'] = false; // default: 50
  whiteList['string-set'] = false; // default: none
  whiteList['tab-size'] = false; // default: 8
  whiteList['table-layout'] = false; // default: auto
  whiteList['text-align'] = true; // default: start
  whiteList['text-align-last'] = true; // default: auto
  whiteList['text-combine-upright'] = true; // default: none
  whiteList['text-decoration'] = true; // default: none
  whiteList['text-decoration-color'] = true; // default: currentColor
  whiteList['text-decoration-line'] = true; // default: none
  whiteList['text-decoration-skip'] = true; // default: objects
  whiteList['text-decoration-style'] = true; // default: solid
  whiteList['text-emphasis'] = true; // default: depending on individual properties
  whiteList['text-emphasis-color'] = true; // default: currentColor
  whiteList['text-emphasis-position'] = true; // default: over right
  whiteList['text-emphasis-style'] = true; // default: none
  whiteList['text-height'] = true; // default: auto
  whiteList['text-indent'] = true; // default: 0
  whiteList['text-justify'] = true; // default: auto
  whiteList['text-orientation'] = true; // default: mixed
  whiteList['text-overflow'] = true; // default: clip
  whiteList['text-shadow'] = true; // default: none
  whiteList['text-space-collapse'] = true; // default: collapse
  whiteList['text-transform'] = true; // default: none
  whiteList['text-underline-position'] = true; // default: auto
  whiteList['text-wrap'] = true; // default: normal
  whiteList['top'] = false; // default: auto
  whiteList['transform'] = false; // default: none
  whiteList['transform-origin'] = false; // default: 50% 50% 0
  whiteList['transform-style'] = false; // default: flat
  whiteList['transition'] = false; // default: depending on individual properties
  whiteList['transition-delay'] = false; // default: 0s
  whiteList['transition-duration'] = false; // default: 0s
  whiteList['transition-property'] = false; // default: all
  whiteList['transition-timing-function'] = false; // default: ease
  whiteList['unicode-bidi'] = false; // default: normal
  whiteList['vertical-align'] = false; // default: baseline
  whiteList['visibility'] = false; // default: visible
  whiteList['voice-balance'] = false; // default: center
  whiteList['voice-duration'] = false; // default: auto
  whiteList['voice-family'] = false; // default: implementation dependent
  whiteList['voice-pitch'] = false; // default: medium
  whiteList['voice-range'] = false; // default: medium
  whiteList['voice-rate'] = false; // default: normal
  whiteList['voice-stress'] = false; // default: normal
  whiteList['voice-volume'] = false; // default: medium
  whiteList['volume'] = false; // default: medium
  whiteList['white-space'] = false; // default: normal
  whiteList['widows'] = false; // default: 2
  whiteList['width'] = true; // default: auto
  whiteList['will-change'] = false; // default: auto
  whiteList['word-break'] = true; // default: normal
  whiteList['word-spacing'] = true; // default: normal
  whiteList['word-wrap'] = true; // default: normal
  whiteList['wrap-flow'] = false; // default: auto
  whiteList['wrap-through'] = false; // default: wrap
  whiteList['writing-mode'] = false; // default: horizontal-tb
  whiteList['z-index'] = false; // default: auto

  return whiteList;
}


/**
 * 匹配到白名单上的一个属性时
 *
 * @param {String} name
 * @param {String} value
 * @param {Object} options
 * @return {String}
 */
function onAttr (name, value, options) {
  // do nothing
}

/**
 * 匹配到不在白名单上的一个属性时
 *
 * @param {String} name
 * @param {String} value
 * @param {Object} options
 * @return {String}
 */
function onIgnoreAttr (name, value, options) {
  // do nothing
}

var REGEXP_URL_JAVASCRIPT = /javascript\s*\:/img;

/**
 * 过滤属性值
 *
 * @param {String} name
 * @param {String} value
 * @return {String}
 */
function safeAttrValue(name, value) {
  if (REGEXP_URL_JAVASCRIPT.test(value)) return '';
  return value;
}


var whiteList = getDefaultWhiteList();
var getDefaultWhiteList_1 = getDefaultWhiteList;
var onAttr_1 = onAttr;
var onIgnoreAttr_1 = onIgnoreAttr;
var safeAttrValue_1 = safeAttrValue;

var _default = {
	whiteList: whiteList,
	getDefaultWhiteList: getDefaultWhiteList_1,
	onAttr: onAttr_1,
	onIgnoreAttr: onIgnoreAttr_1,
	safeAttrValue: safeAttrValue_1
};

var util = {
  indexOf: function (arr, item) {
    var i, j;
    if (Array.prototype.indexOf) {
      return arr.indexOf(item);
    }
    for (i = 0, j = arr.length; i < j; i++) {
      if (arr[i] === item) {
        return i;
      }
    }
    return -1;
  },
  forEach: function (arr, fn, scope) {
    var i, j;
    if (Array.prototype.forEach) {
      return arr.forEach(fn, scope);
    }
    for (i = 0, j = arr.length; i < j; i++) {
      fn.call(scope, arr[i], i, arr);
    }
  },
  trim: function (str) {
    if (String.prototype.trim) {
      return str.trim();
    }
    return str.replace(/(^\s*)|(\s*$)/g, '');
  },
  trimRight: function (str) {
    if (String.prototype.trimRight) {
      return str.trimRight();
    }
    return str.replace(/(\s*$)/g, '');
  }
};

/**
 * cssfilter
 *
 * @author 老雷<leizongmin@gmail.com>
 */




/**
 * 解析style
 *
 * @param {String} css
 * @param {Function} onAttr 处理属性的函数
 *   参数格式： function (sourcePosition, position, name, value, source)
 * @return {String}
 */
function parseStyle (css, onAttr) {
  css = util.trimRight(css);
  if (css[css.length - 1] !== ';') css += ';';
  var cssLength = css.length;
  var isParenthesisOpen = false;
  var lastPos = 0;
  var i = 0;
  var retCSS = '';

  function addNewAttr () {
    // 如果没有正常的闭合圆括号，则直接忽略当前属性
    if (!isParenthesisOpen) {
      var source = util.trim(css.slice(lastPos, i));
      var j = source.indexOf(':');
      if (j !== -1) {
        var name = util.trim(source.slice(0, j));
        var value = util.trim(source.slice(j + 1));
        // 必须有属性名称
        if (name) {
          var ret = onAttr(lastPos, retCSS.length, name, value, source);
          if (ret) retCSS += ret + '; ';
        }
      }
    }
    lastPos = i + 1;
  }

  for (; i < cssLength; i++) {
    var c = css[i];
    if (c === '/' && css[i + 1] === '*') {
      // 备注开始
      var j = css.indexOf('*/', i + 2);
      // 如果没有正常的备注结束，则后面的部分全部跳过
      if (j === -1) break;
      // 直接将当前位置调到备注结尾，并且初始化状态
      i = j + 1;
      lastPos = i + 1;
      isParenthesisOpen = false;
    } else if (c === '(') {
      isParenthesisOpen = true;
    } else if (c === ')') {
      isParenthesisOpen = false;
    } else if (c === ';') {
      if (isParenthesisOpen) ; else {
        addNewAttr();
      }
    } else if (c === '\n') {
      addNewAttr();
    }
  }

  return util.trim(retCSS);
}

var parser = parseStyle;

/**
 * cssfilter
 *
 * @author 老雷<leizongmin@gmail.com>
 */






/**
 * 返回值是否为空
 *
 * @param {Object} obj
 * @return {Boolean}
 */
function isNull (obj) {
  return (obj === undefined || obj === null);
}

/**
 * 浅拷贝对象
 *
 * @param {Object} obj
 * @return {Object}
 */
function shallowCopyObject (obj) {
  var ret = {};
  for (var i in obj) {
    ret[i] = obj[i];
  }
  return ret;
}

/**
 * 创建CSS过滤器
 *
 * @param {Object} options
 *   - {Object} whiteList
 *   - {Function} onAttr
 *   - {Function} onIgnoreAttr
 *   - {Function} safeAttrValue
 */
function FilterCSS (options) {
  options = shallowCopyObject(options || {});
  options.whiteList = options.whiteList || _default.whiteList;
  options.onAttr = options.onAttr || _default.onAttr;
  options.onIgnoreAttr = options.onIgnoreAttr || _default.onIgnoreAttr;
  options.safeAttrValue = options.safeAttrValue || _default.safeAttrValue;
  this.options = options;
}

FilterCSS.prototype.process = function (css) {
  // 兼容各种奇葩输入
  css = css || '';
  css = css.toString();
  if (!css) return '';

  var me = this;
  var options = me.options;
  var whiteList = options.whiteList;
  var onAttr = options.onAttr;
  var onIgnoreAttr = options.onIgnoreAttr;
  var safeAttrValue = options.safeAttrValue;

  var retCSS = parser(css, function (sourcePosition, position, name, value, source) {

    var check = whiteList[name];
    var isWhite = false;
    if (check === true) isWhite = check;
    else if (typeof check === 'function') isWhite = check(value);
    else if (check instanceof RegExp) isWhite = check.test(value);
    if (isWhite !== true) isWhite = false;

    // 如果过滤后 value 为空则直接忽略
    value = safeAttrValue(name, value);
    if (!value) return;

    var opts = {
      position: position,
      sourcePosition: sourcePosition,
      source: source,
      isWhite: isWhite
    };

    if (isWhite) {

      var ret = onAttr(name, value, opts);
      if (isNull(ret)) {
        return name + ':' + value;
      } else {
        return ret;
      }

    } else {

      var ret = onIgnoreAttr(name, value, opts);
      if (!isNull(ret)) {
        return ret;
      }

    }
  });

  return retCSS;
};


var css = FilterCSS;

var lib = createCommonjsModule$1(function (module, exports) {
/**
 * cssfilter
 *
 * @author 老雷<leizongmin@gmail.com>
 */





/**
 * XSS过滤
 *
 * @param {String} css 要过滤的CSS代码
 * @param {Object} options 选项：whiteList, onAttr, onIgnoreAttr
 * @return {String}
 */
function filterCSS (html, options) {
  var xss = new css(options);
  return xss.process(html);
}


// 输出
exports = module.exports = filterCSS;
exports.FilterCSS = css;
for (var i in _default) exports[i] = _default[i];

// 在浏览器端使用
if (typeof window !== 'undefined') {
  window.filterCSS = module.exports;
}
});
var lib_1 = lib.FilterCSS;

var util$1 = {
  indexOf: function(arr, item) {
    var i, j;
    if (Array.prototype.indexOf) {
      return arr.indexOf(item);
    }
    for (i = 0, j = arr.length; i < j; i++) {
      if (arr[i] === item) {
        return i;
      }
    }
    return -1;
  },
  forEach: function(arr, fn, scope) {
    var i, j;
    if (Array.prototype.forEach) {
      return arr.forEach(fn, scope);
    }
    for (i = 0, j = arr.length; i < j; i++) {
      fn.call(scope, arr[i], i, arr);
    }
  },
  trim: function(str) {
    if (String.prototype.trim) {
      return str.trim();
    }
    return str.replace(/(^\s*)|(\s*$)/g, "");
  },
  spaceIndex: function(str) {
    var reg = /\s|\n|\t/;
    var match = reg.exec(str);
    return match ? match.index : -1;
  }
};

/**
 * default settings
 *
 * @author Zongmin Lei<leizongmin@gmail.com>
 */

var FilterCSS$1 = lib.FilterCSS;
var getDefaultCSSWhiteList = lib.getDefaultWhiteList;


function getDefaultWhiteList$1() {
  return {
    a: ["target", "href", "title"],
    abbr: ["title"],
    address: [],
    area: ["shape", "coords", "href", "alt"],
    article: [],
    aside: [],
    audio: ["autoplay", "controls", "loop", "preload", "src"],
    b: [],
    bdi: ["dir"],
    bdo: ["dir"],
    big: [],
    blockquote: ["cite"],
    br: [],
    caption: [],
    center: [],
    cite: [],
    code: [],
    col: ["align", "valign", "span", "width"],
    colgroup: ["align", "valign", "span", "width"],
    dd: [],
    del: ["datetime"],
    details: ["open"],
    div: [],
    dl: [],
    dt: [],
    em: [],
    font: ["color", "size", "face"],
    footer: [],
    h1: [],
    h2: [],
    h3: [],
    h4: [],
    h5: [],
    h6: [],
    header: [],
    hr: [],
    i: [],
    img: ["src", "alt", "title", "width", "height"],
    ins: ["datetime"],
    li: [],
    mark: [],
    nav: [],
    ol: [],
    p: [],
    pre: [],
    s: [],
    section: [],
    small: [],
    span: [],
    sub: [],
    sup: [],
    strong: [],
    table: ["width", "border", "align", "valign"],
    tbody: ["align", "valign"],
    td: ["width", "rowspan", "colspan", "align", "valign"],
    tfoot: ["align", "valign"],
    th: ["width", "rowspan", "colspan", "align", "valign"],
    thead: ["align", "valign"],
    tr: ["rowspan", "align", "valign"],
    tt: [],
    u: [],
    ul: [],
    video: ["autoplay", "controls", "loop", "preload", "src", "height", "width"]
  };
}

var defaultCSSFilter = new FilterCSS$1();

/**
 * default onTag function
 *
 * @param {String} tag
 * @param {String} html
 * @param {Object} options
 * @return {String}
 */
function onTag(tag, html, options) {
  // do nothing
}

/**
 * default onIgnoreTag function
 *
 * @param {String} tag
 * @param {String} html
 * @param {Object} options
 * @return {String}
 */
function onIgnoreTag(tag, html, options) {
  // do nothing
}

/**
 * default onTagAttr function
 *
 * @param {String} tag
 * @param {String} name
 * @param {String} value
 * @return {String}
 */
function onTagAttr(tag, name, value) {
  // do nothing
}

/**
 * default onIgnoreTagAttr function
 *
 * @param {String} tag
 * @param {String} name
 * @param {String} value
 * @return {String}
 */
function onIgnoreTagAttr(tag, name, value) {
  // do nothing
}

/**
 * default escapeHtml function
 *
 * @param {String} html
 */
function escapeHtml(html) {
  return html.replace(REGEXP_LT, "&lt;").replace(REGEXP_GT, "&gt;");
}

/**
 * default safeAttrValue function
 *
 * @param {String} tag
 * @param {String} name
 * @param {String} value
 * @param {Object} cssFilter
 * @return {String}
 */
function safeAttrValue$1(tag, name, value, cssFilter) {
  // unescape attribute value firstly
  value = friendlyAttrValue(value);

  if (name === "href" || name === "src") {
    // filter `href` and `src` attribute
    // only allow the value that starts with `http://` | `https://` | `mailto:` | `/` | `#`
    value = util$1.trim(value);
    if (value === "#") return "#";
    if (
      !(
        value.substr(0, 7) === "http://" ||
        value.substr(0, 8) === "https://" ||
        value.substr(0, 7) === "mailto:" ||
        value.substr(0, 4) === "tel:" ||
        value[0] === "#" ||
        value[0] === "/"
      )
    ) {
      return "";
    }
  } else if (name === "background") {
    // filter `background` attribute (maybe no use)
    // `javascript:`
    REGEXP_DEFAULT_ON_TAG_ATTR_4.lastIndex = 0;
    if (REGEXP_DEFAULT_ON_TAG_ATTR_4.test(value)) {
      return "";
    }
  } else if (name === "style") {
    // `expression()`
    REGEXP_DEFAULT_ON_TAG_ATTR_7.lastIndex = 0;
    if (REGEXP_DEFAULT_ON_TAG_ATTR_7.test(value)) {
      return "";
    }
    // `url()`
    REGEXP_DEFAULT_ON_TAG_ATTR_8.lastIndex = 0;
    if (REGEXP_DEFAULT_ON_TAG_ATTR_8.test(value)) {
      REGEXP_DEFAULT_ON_TAG_ATTR_4.lastIndex = 0;
      if (REGEXP_DEFAULT_ON_TAG_ATTR_4.test(value)) {
        return "";
      }
    }
    if (cssFilter !== false) {
      cssFilter = cssFilter || defaultCSSFilter;
      value = cssFilter.process(value);
    }
  }

  // escape `<>"` before returns
  value = escapeAttrValue(value);
  return value;
}

// RegExp list
var REGEXP_LT = /</g;
var REGEXP_GT = />/g;
var REGEXP_QUOTE = /"/g;
var REGEXP_QUOTE_2 = /&quot;/g;
var REGEXP_ATTR_VALUE_1 = /&#([a-zA-Z0-9]*);?/gim;
var REGEXP_ATTR_VALUE_COLON = /&colon;?/gim;
var REGEXP_ATTR_VALUE_NEWLINE = /&newline;?/gim;
var REGEXP_DEFAULT_ON_TAG_ATTR_4 = /((j\s*a\s*v\s*a|v\s*b|l\s*i\s*v\s*e)\s*s\s*c\s*r\s*i\s*p\s*t\s*|m\s*o\s*c\s*h\s*a)\:/gi;
var REGEXP_DEFAULT_ON_TAG_ATTR_7 = /e\s*x\s*p\s*r\s*e\s*s\s*s\s*i\s*o\s*n\s*\(.*/gi;
var REGEXP_DEFAULT_ON_TAG_ATTR_8 = /u\s*r\s*l\s*\(.*/gi;

/**
 * escape doube quote
 *
 * @param {String} str
 * @return {String} str
 */
function escapeQuote(str) {
  return str.replace(REGEXP_QUOTE, "&quot;");
}

/**
 * unescape double quote
 *
 * @param {String} str
 * @return {String} str
 */
function unescapeQuote(str) {
  return str.replace(REGEXP_QUOTE_2, '"');
}

/**
 * escape html entities
 *
 * @param {String} str
 * @return {String}
 */
function escapeHtmlEntities(str) {
  return str.replace(REGEXP_ATTR_VALUE_1, function replaceUnicode(str, code) {
    return code[0] === "x" || code[0] === "X"
      ? String.fromCharCode(parseInt(code.substr(1), 16))
      : String.fromCharCode(parseInt(code, 10));
  });
}

/**
 * escape html5 new danger entities
 *
 * @param {String} str
 * @return {String}
 */
function escapeDangerHtml5Entities(str) {
  return str
    .replace(REGEXP_ATTR_VALUE_COLON, ":")
    .replace(REGEXP_ATTR_VALUE_NEWLINE, " ");
}

/**
 * clear nonprintable characters
 *
 * @param {String} str
 * @return {String}
 */
function clearNonPrintableCharacter(str) {
  var str2 = "";
  for (var i = 0, len = str.length; i < len; i++) {
    str2 += str.charCodeAt(i) < 32 ? " " : str.charAt(i);
  }
  return util$1.trim(str2);
}

/**
 * get friendly attribute value
 *
 * @param {String} str
 * @return {String}
 */
function friendlyAttrValue(str) {
  str = unescapeQuote(str);
  str = escapeHtmlEntities(str);
  str = escapeDangerHtml5Entities(str);
  str = clearNonPrintableCharacter(str);
  return str;
}

/**
 * unescape attribute value
 *
 * @param {String} str
 * @return {String}
 */
function escapeAttrValue(str) {
  str = escapeQuote(str);
  str = escapeHtml(str);
  return str;
}

/**
 * `onIgnoreTag` function for removing all the tags that are not in whitelist
 */
function onIgnoreTagStripAll() {
  return "";
}

/**
 * remove tag body
 * specify a `tags` list, if the tag is not in the `tags` list then process by the specify function (optional)
 *
 * @param {array} tags
 * @param {function} next
 */
function StripTagBody(tags, next) {
  if (typeof next !== "function") {
    next = function() {};
  }

  var isRemoveAllTag = !Array.isArray(tags);
  function isRemoveTag(tag) {
    if (isRemoveAllTag) return true;
    return util$1.indexOf(tags, tag) !== -1;
  }

  var removeList = [];
  var posStart = false;

  return {
    onIgnoreTag: function(tag, html, options) {
      if (isRemoveTag(tag)) {
        if (options.isClosing) {
          var ret = "[/removed]";
          var end = options.position + ret.length;
          removeList.push([
            posStart !== false ? posStart : options.position,
            end
          ]);
          posStart = false;
          return ret;
        } else {
          if (!posStart) {
            posStart = options.position;
          }
          return "[removed]";
        }
      } else {
        return next(tag, html, options);
      }
    },
    remove: function(html) {
      var rethtml = "";
      var lastPos = 0;
      util$1.forEach(removeList, function(pos) {
        rethtml += html.slice(lastPos, pos[0]);
        lastPos = pos[1];
      });
      rethtml += html.slice(lastPos);
      return rethtml;
    }
  };
}

/**
 * remove html comments
 *
 * @param {String} html
 * @return {String}
 */
function stripCommentTag(html) {
  return html.replace(STRIP_COMMENT_TAG_REGEXP, "");
}
var STRIP_COMMENT_TAG_REGEXP = /<!--[\s\S]*?-->/g;

/**
 * remove invisible characters
 *
 * @param {String} html
 * @return {String}
 */
function stripBlankChar(html) {
  var chars = html.split("");
  chars = chars.filter(function(char) {
    var c = char.charCodeAt(0);
    if (c === 127) return false;
    if (c <= 31) {
      if (c === 10 || c === 13) return true;
      return false;
    }
    return true;
  });
  return chars.join("");
}

var whiteList$1 = getDefaultWhiteList$1();
var getDefaultWhiteList_1$1 = getDefaultWhiteList$1;
var onTag_1 = onTag;
var onIgnoreTag_1 = onIgnoreTag;
var onTagAttr_1 = onTagAttr;
var onIgnoreTagAttr_1 = onIgnoreTagAttr;
var safeAttrValue_1$1 = safeAttrValue$1;
var escapeHtml_1 = escapeHtml;
var escapeQuote_1 = escapeQuote;
var unescapeQuote_1 = unescapeQuote;
var escapeHtmlEntities_1 = escapeHtmlEntities;
var escapeDangerHtml5Entities_1 = escapeDangerHtml5Entities;
var clearNonPrintableCharacter_1 = clearNonPrintableCharacter;
var friendlyAttrValue_1 = friendlyAttrValue;
var escapeAttrValue_1 = escapeAttrValue;
var onIgnoreTagStripAll_1 = onIgnoreTagStripAll;
var StripTagBody_1 = StripTagBody;
var stripCommentTag_1 = stripCommentTag;
var stripBlankChar_1 = stripBlankChar;
var cssFilter = defaultCSSFilter;
var getDefaultCSSWhiteList_1 = getDefaultCSSWhiteList;

var _default$1 = {
	whiteList: whiteList$1,
	getDefaultWhiteList: getDefaultWhiteList_1$1,
	onTag: onTag_1,
	onIgnoreTag: onIgnoreTag_1,
	onTagAttr: onTagAttr_1,
	onIgnoreTagAttr: onIgnoreTagAttr_1,
	safeAttrValue: safeAttrValue_1$1,
	escapeHtml: escapeHtml_1,
	escapeQuote: escapeQuote_1,
	unescapeQuote: unescapeQuote_1,
	escapeHtmlEntities: escapeHtmlEntities_1,
	escapeDangerHtml5Entities: escapeDangerHtml5Entities_1,
	clearNonPrintableCharacter: clearNonPrintableCharacter_1,
	friendlyAttrValue: friendlyAttrValue_1,
	escapeAttrValue: escapeAttrValue_1,
	onIgnoreTagStripAll: onIgnoreTagStripAll_1,
	StripTagBody: StripTagBody_1,
	stripCommentTag: stripCommentTag_1,
	stripBlankChar: stripBlankChar_1,
	cssFilter: cssFilter,
	getDefaultCSSWhiteList: getDefaultCSSWhiteList_1
};

/**
 * Simple HTML Parser
 *
 * @author Zongmin Lei<leizongmin@gmail.com>
 */



/**
 * get tag name
 *
 * @param {String} html e.g. '<a hef="#">'
 * @return {String}
 */
function getTagName(html) {
  var i = util$1.spaceIndex(html);
  if (i === -1) {
    var tagName = html.slice(1, -1);
  } else {
    var tagName = html.slice(1, i + 1);
  }
  tagName = util$1.trim(tagName).toLowerCase();
  if (tagName.slice(0, 1) === "/") tagName = tagName.slice(1);
  if (tagName.slice(-1) === "/") tagName = tagName.slice(0, -1);
  return tagName;
}

/**
 * is close tag?
 *
 * @param {String} html 如：'<a hef="#">'
 * @return {Boolean}
 */
function isClosing(html) {
  return html.slice(0, 2) === "</";
}

/**
 * parse input html and returns processed html
 *
 * @param {String} html
 * @param {Function} onTag e.g. function (sourcePosition, position, tag, html, isClosing)
 * @param {Function} escapeHtml
 * @return {String}
 */
function parseTag(html, onTag, escapeHtml) {
  "user strict";

  var rethtml = "";
  var lastPos = 0;
  var tagStart = false;
  var quoteStart = false;
  var currentPos = 0;
  var len = html.length;
  var currentTagName = "";
  var currentHtml = "";

  for (currentPos = 0; currentPos < len; currentPos++) {
    var c = html.charAt(currentPos);
    if (tagStart === false) {
      if (c === "<") {
        tagStart = currentPos;
        continue;
      }
    } else {
      if (quoteStart === false) {
        if (c === "<") {
          rethtml += escapeHtml(html.slice(lastPos, currentPos));
          tagStart = currentPos;
          lastPos = currentPos;
          continue;
        }
        if (c === ">") {
          rethtml += escapeHtml(html.slice(lastPos, tagStart));
          currentHtml = html.slice(tagStart, currentPos + 1);
          currentTagName = getTagName(currentHtml);
          rethtml += onTag(
            tagStart,
            rethtml.length,
            currentTagName,
            currentHtml,
            isClosing(currentHtml)
          );
          lastPos = currentPos + 1;
          tagStart = false;
          continue;
        }
        if ((c === '"' || c === "'") && html.charAt(currentPos - 1) === "=") {
          quoteStart = c;
          continue;
        }
      } else {
        if (c === quoteStart) {
          quoteStart = false;
          continue;
        }
      }
    }
  }
  if (lastPos < html.length) {
    rethtml += escapeHtml(html.substr(lastPos));
  }

  return rethtml;
}

var REGEXP_ILLEGAL_ATTR_NAME = /[^a-zA-Z0-9_:\.\-]/gim;

/**
 * parse input attributes and returns processed attributes
 *
 * @param {String} html e.g. `href="#" target="_blank"`
 * @param {Function} onAttr e.g. `function (name, value)`
 * @return {String}
 */
function parseAttr(html, onAttr) {
  "user strict";

  var lastPos = 0;
  var retAttrs = [];
  var tmpName = false;
  var len = html.length;

  function addAttr(name, value) {
    name = util$1.trim(name);
    name = name.replace(REGEXP_ILLEGAL_ATTR_NAME, "").toLowerCase();
    if (name.length < 1) return;
    var ret = onAttr(name, value || "");
    if (ret) retAttrs.push(ret);
  }

  // 逐个分析字符
  for (var i = 0; i < len; i++) {
    var c = html.charAt(i);
    var v, j;
    if (tmpName === false && c === "=") {
      tmpName = html.slice(lastPos, i);
      lastPos = i + 1;
      continue;
    }
    if (tmpName !== false) {
      if (
        i === lastPos &&
        (c === '"' || c === "'") &&
        html.charAt(i - 1) === "="
      ) {
        j = html.indexOf(c, i + 1);
        if (j === -1) {
          break;
        } else {
          v = util$1.trim(html.slice(lastPos + 1, j));
          addAttr(tmpName, v);
          tmpName = false;
          i = j;
          lastPos = i + 1;
          continue;
        }
      }
    }
    if (/\s|\n|\t/.test(c)) {
      html = html.replace(/\s|\n|\t/g, " ");
      if (tmpName === false) {
        j = findNextEqual(html, i);
        if (j === -1) {
          v = util$1.trim(html.slice(lastPos, i));
          addAttr(v);
          tmpName = false;
          lastPos = i + 1;
          continue;
        } else {
          i = j - 1;
          continue;
        }
      } else {
        j = findBeforeEqual(html, i - 1);
        if (j === -1) {
          v = util$1.trim(html.slice(lastPos, i));
          v = stripQuoteWrap(v);
          addAttr(tmpName, v);
          tmpName = false;
          lastPos = i + 1;
          continue;
        } else {
          continue;
        }
      }
    }
  }

  if (lastPos < html.length) {
    if (tmpName === false) {
      addAttr(html.slice(lastPos));
    } else {
      addAttr(tmpName, stripQuoteWrap(util$1.trim(html.slice(lastPos))));
    }
  }

  return util$1.trim(retAttrs.join(" "));
}

function findNextEqual(str, i) {
  for (; i < str.length; i++) {
    var c = str[i];
    if (c === " ") continue;
    if (c === "=") return i;
    return -1;
  }
}

function findBeforeEqual(str, i) {
  for (; i > 0; i--) {
    var c = str[i];
    if (c === " ") continue;
    if (c === "=") return i;
    return -1;
  }
}

function isQuoteWrapString(text) {
  if (
    (text[0] === '"' && text[text.length - 1] === '"') ||
    (text[0] === "'" && text[text.length - 1] === "'")
  ) {
    return true;
  } else {
    return false;
  }
}

function stripQuoteWrap(text) {
  if (isQuoteWrapString(text)) {
    return text.substr(1, text.length - 2);
  } else {
    return text;
  }
}

var parseTag_1 = parseTag;
var parseAttr_1 = parseAttr;

var parser$1 = {
	parseTag: parseTag_1,
	parseAttr: parseAttr_1
};

/**
 * filter xss
 *
 * @author Zongmin Lei<leizongmin@gmail.com>
 */

var FilterCSS$2 = lib.FilterCSS;


var parseTag$1 = parser$1.parseTag;
var parseAttr$1 = parser$1.parseAttr;


/**
 * returns `true` if the input value is `undefined` or `null`
 *
 * @param {Object} obj
 * @return {Boolean}
 */
function isNull$1(obj) {
  return obj === undefined || obj === null;
}

/**
 * get attributes for a tag
 *
 * @param {String} html
 * @return {Object}
 *   - {String} html
 *   - {Boolean} closing
 */
function getAttrs(html) {
  var i = util$1.spaceIndex(html);
  if (i === -1) {
    return {
      html: "",
      closing: html[html.length - 2] === "/"
    };
  }
  html = util$1.trim(html.slice(i + 1, -1));
  var isClosing = html[html.length - 1] === "/";
  if (isClosing) html = util$1.trim(html.slice(0, -1));
  return {
    html: html,
    closing: isClosing
  };
}

/**
 * shallow copy
 *
 * @param {Object} obj
 * @return {Object}
 */
function shallowCopyObject$1(obj) {
  var ret = {};
  for (var i in obj) {
    ret[i] = obj[i];
  }
  return ret;
}

/**
 * FilterXSS class
 *
 * @param {Object} options
 *        whiteList, onTag, onTagAttr, onIgnoreTag,
 *        onIgnoreTagAttr, safeAttrValue, escapeHtml
 *        stripIgnoreTagBody, allowCommentTag, stripBlankChar
 *        css{whiteList, onAttr, onIgnoreAttr} `css=false` means don't use `cssfilter`
 */
function FilterXSS(options) {
  options = shallowCopyObject$1(options || {});

  if (options.stripIgnoreTag) {
    if (options.onIgnoreTag) {
      console.error(
        'Notes: cannot use these two options "stripIgnoreTag" and "onIgnoreTag" at the same time'
      );
    }
    options.onIgnoreTag = _default$1.onIgnoreTagStripAll;
  }

  options.whiteList = options.whiteList || _default$1.whiteList;
  options.onTag = options.onTag || _default$1.onTag;
  options.onTagAttr = options.onTagAttr || _default$1.onTagAttr;
  options.onIgnoreTag = options.onIgnoreTag || _default$1.onIgnoreTag;
  options.onIgnoreTagAttr = options.onIgnoreTagAttr || _default$1.onIgnoreTagAttr;
  options.safeAttrValue = options.safeAttrValue || _default$1.safeAttrValue;
  options.escapeHtml = options.escapeHtml || _default$1.escapeHtml;
  this.options = options;

  if (options.css === false) {
    this.cssFilter = false;
  } else {
    options.css = options.css || {};
    this.cssFilter = new FilterCSS$2(options.css);
  }
}

/**
 * start process and returns result
 *
 * @param {String} html
 * @return {String}
 */
FilterXSS.prototype.process = function(html) {
  // compatible with the input
  html = html || "";
  html = html.toString();
  if (!html) return "";

  var me = this;
  var options = me.options;
  var whiteList = options.whiteList;
  var onTag = options.onTag;
  var onIgnoreTag = options.onIgnoreTag;
  var onTagAttr = options.onTagAttr;
  var onIgnoreTagAttr = options.onIgnoreTagAttr;
  var safeAttrValue = options.safeAttrValue;
  var escapeHtml = options.escapeHtml;
  var cssFilter = me.cssFilter;

  // remove invisible characters
  if (options.stripBlankChar) {
    html = _default$1.stripBlankChar(html);
  }

  // remove html comments
  if (!options.allowCommentTag) {
    html = _default$1.stripCommentTag(html);
  }

  // if enable stripIgnoreTagBody
  var stripIgnoreTagBody = false;
  if (options.stripIgnoreTagBody) {
    var stripIgnoreTagBody = _default$1.StripTagBody(
      options.stripIgnoreTagBody,
      onIgnoreTag
    );
    onIgnoreTag = stripIgnoreTagBody.onIgnoreTag;
  }

  var retHtml = parseTag$1(
    html,
    function(sourcePosition, position, tag, html, isClosing) {
      var info = {
        sourcePosition: sourcePosition,
        position: position,
        isClosing: isClosing,
        isWhite: whiteList.hasOwnProperty(tag)
      };

      // call `onTag()`
      var ret = onTag(tag, html, info);
      if (!isNull$1(ret)) return ret;

      if (info.isWhite) {
        if (info.isClosing) {
          return "</" + tag + ">";
        }

        var attrs = getAttrs(html);
        var whiteAttrList = whiteList[tag];
        var attrsHtml = parseAttr$1(attrs.html, function(name, value) {
          // call `onTagAttr()`
          var isWhiteAttr = util$1.indexOf(whiteAttrList, name) !== -1;
          var ret = onTagAttr(tag, name, value, isWhiteAttr);
          if (!isNull$1(ret)) return ret;

          if (isWhiteAttr) {
            // call `safeAttrValue()`
            value = safeAttrValue(tag, name, value, cssFilter);
            if (value) {
              return name + '="' + value + '"';
            } else {
              return name;
            }
          } else {
            // call `onIgnoreTagAttr()`
            var ret = onIgnoreTagAttr(tag, name, value, isWhiteAttr);
            if (!isNull$1(ret)) return ret;
            return;
          }
        });

        // build new tag html
        var html = "<" + tag;
        if (attrsHtml) html += " " + attrsHtml;
        if (attrs.closing) html += " /";
        html += ">";
        return html;
      } else {
        // call `onIgnoreTag()`
        var ret = onIgnoreTag(tag, html, info);
        if (!isNull$1(ret)) return ret;
        return escapeHtml(html);
      }
    },
    escapeHtml
  );

  // if enable stripIgnoreTagBody
  if (stripIgnoreTagBody) {
    retHtml = stripIgnoreTagBody.remove(retHtml);
  }

  return retHtml;
};

var xss = FilterXSS;

var lib$1 = createCommonjsModule$1(function (module, exports) {
/**
 * xss
 *
 * @author Zongmin Lei<leizongmin@gmail.com>
 */





/**
 * filter xss function
 *
 * @param {String} html
 * @param {Object} options { whiteList, onTag, onTagAttr, onIgnoreTag, onIgnoreTagAttr, safeAttrValue, escapeHtml }
 * @return {String}
 */
function filterXSS(html, options) {
  var xss$$1 = new xss(options);
  return xss$$1.process(html);
}

exports = module.exports = filterXSS;
exports.FilterXSS = xss;
for (var i in _default$1) exports[i] = _default$1[i];
for (var i in parser$1) exports[i] = parser$1[i];

// using `xss` on the browser, output `filterXSS` to the globals
if (typeof window !== "undefined") {
  window.filterXSS = module.exports;
}
});
var lib_1$1 = lib$1.FilterXSS;

/**
 * lodash 4.0.1 (Custom Build) <https://lodash.com/>
 * Build: `lodash modularize exports="npm" -o ./`
 * Copyright 2012-2016 The Dojo Foundation <http://dojofoundation.org/>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright 2009-2016 Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 * Available under MIT license <https://lodash.com/license>
 */

/** `Object#toString` result references. */
var stringTag = '[object String]';

/** Used for built-in method references. */
var objectProto = Object.prototype;

/**
 * Used to resolve the [`toStringTag`](http://ecma-international.org/ecma-262/6.0/#sec-object.prototype.tostring)
 * of values.
 */
var objectToString = objectProto.toString;

/**
 * Checks if `value` is classified as an `Array` object.
 *
 * @static
 * @memberOf _
 * @type Function
 * @category Lang
 * @param {*} value The value to check.
 * @returns {boolean} Returns `true` if `value` is correctly classified, else `false`.
 * @example
 *
 * _.isArray([1, 2, 3]);
 * // => true
 *
 * _.isArray(document.body.children);
 * // => false
 *
 * _.isArray('abc');
 * // => false
 *
 * _.isArray(_.noop);
 * // => false
 */
var isArray = Array.isArray;

/**
 * Checks if `value` is object-like. A value is object-like if it's not `null`
 * and has a `typeof` result of "object".
 *
 * @static
 * @memberOf _
 * @category Lang
 * @param {*} value The value to check.
 * @returns {boolean} Returns `true` if `value` is object-like, else `false`.
 * @example
 *
 * _.isObjectLike({});
 * // => true
 *
 * _.isObjectLike([1, 2, 3]);
 * // => true
 *
 * _.isObjectLike(_.noop);
 * // => false
 *
 * _.isObjectLike(null);
 * // => false
 */
function isObjectLike(value) {
  return !!value && typeof value == 'object';
}

/**
 * Checks if `value` is classified as a `String` primitive or object.
 *
 * @static
 * @memberOf _
 * @category Lang
 * @param {*} value The value to check.
 * @returns {boolean} Returns `true` if `value` is correctly classified, else `false`.
 * @example
 *
 * _.isString('abc');
 * // => true
 *
 * _.isString(1);
 * // => false
 */
function isString(value) {
  return typeof value == 'string' ||
    (!isArray(value) && isObjectLike(value) && objectToString.call(value) == stringTag);
}

var lodash_isstring = isString;

var html5NamedCharRefs = createCommonjsModule$1(function (module, exports) {

exports.__esModule = true;
var HTML5NamedCharRefs = {
    // We don't need the complete named character reference because linkifyHtml
    // does not modify the escape sequences. We do need &nbsp; so that
    // whitespace is parsed properly. Other types of whitespace should already
    // be accounted for
    nbsp: "\xA0"
};
exports.default = HTML5NamedCharRefs;
});

unwrapExports$1(html5NamedCharRefs);

var entityParser = createCommonjsModule$1(function (module, exports) {

exports.__esModule = true;
function EntityParser(named) {
  this.named = named;
}

var HEXCHARCODE = /^#[xX]([A-Fa-f0-9]+)$/;
var CHARCODE = /^#([0-9]+)$/;
var NAMED = /^([A-Za-z0-9]+)$/;

EntityParser.prototype.parse = function (entity) {
  if (!entity) {
    return;
  }
  var matches = entity.match(HEXCHARCODE);
  if (matches) {
    return "&#x" + matches[1] + ";";
  }
  matches = entity.match(CHARCODE);
  if (matches) {
    return "&#" + matches[1] + ";";
  }
  matches = entity.match(NAMED);
  if (matches) {
    return this.named[matches[1]] || "&" + matches[1] + ";";
  }
};

exports.default = EntityParser;
});

unwrapExports$1(entityParser);

var utils = createCommonjsModule$1(function (module, exports) {

exports.__esModule = true;
exports.isSpace = isSpace;
exports.isAlpha = isAlpha;
exports.preprocessInput = preprocessInput;
var WSP = /[\t\n\f ]/;
var ALPHA = /[A-Za-z]/;
var CRLF = /\r\n?/g;

function isSpace(char) {
  return WSP.test(char);
}

function isAlpha(char) {
  return ALPHA.test(char);
}

function preprocessInput(input) {
  return input.replace(CRLF, "\n");
}
});

unwrapExports$1(utils);
var utils_1 = utils.isSpace;
var utils_2 = utils.isAlpha;
var utils_3 = utils.preprocessInput;

var eventedTokenizer = createCommonjsModule$1(function (module, exports) {

exports.__esModule = true;



function EventedTokenizer(delegate, entityParser) {
  this.delegate = delegate;
  this.entityParser = entityParser;

  this.state = null;
  this.input = null;

  this.index = -1;
  this.line = -1;
  this.column = -1;
  this.tagLine = -1;
  this.tagColumn = -1;

  this.reset();
}

EventedTokenizer.prototype = {
  reset: function reset() {
    this.state = 'beforeData';
    this.input = '';

    this.index = 0;
    this.line = 1;
    this.column = 0;

    this.tagLine = -1;
    this.tagColumn = -1;

    this.delegate.reset();
  },

  tokenize: function tokenize(input) {
    this.reset();
    this.tokenizePart(input);
    this.tokenizeEOF();
  },

  tokenizePart: function tokenizePart(input) {
    this.input += (0, utils.preprocessInput)(input);

    while (this.index < this.input.length) {
      this.states[this.state].call(this);
    }
  },

  tokenizeEOF: function tokenizeEOF() {
    this.flushData();
  },

  flushData: function flushData() {
    if (this.state === 'data') {
      this.delegate.finishData();
      this.state = 'beforeData';
    }
  },

  peek: function peek() {
    return this.input.charAt(this.index);
  },

  consume: function consume() {
    var char = this.peek();

    this.index++;

    if (char === "\n") {
      this.line++;
      this.column = 0;
    } else {
      this.column++;
    }

    return char;
  },

  consumeCharRef: function consumeCharRef() {
    var endIndex = this.input.indexOf(';', this.index);
    if (endIndex === -1) {
      return;
    }
    var entity = this.input.slice(this.index, endIndex);
    var chars = this.entityParser.parse(entity);
    if (chars) {
      var count = entity.length;
      // consume the entity chars
      while (count) {
        this.consume();
        count--;
      }
      // consume the `;`
      this.consume();

      return chars;
    }
  },

  markTagStart: function markTagStart() {
    // these properties to be removed in next major bump
    this.tagLine = this.line;
    this.tagColumn = this.column;

    if (this.delegate.tagOpen) {
      this.delegate.tagOpen();
    }
  },

  states: {
    beforeData: function beforeData() {
      var char = this.peek();

      if (char === "<") {
        this.state = 'tagOpen';
        this.markTagStart();
        this.consume();
      } else {
        this.state = 'data';
        this.delegate.beginData();
      }
    },

    data: function data() {
      var char = this.peek();

      if (char === "<") {
        this.delegate.finishData();
        this.state = 'tagOpen';
        this.markTagStart();
        this.consume();
      } else if (char === "&") {
        this.consume();
        this.delegate.appendToData(this.consumeCharRef() || "&");
      } else {
        this.consume();
        this.delegate.appendToData(char);
      }
    },

    tagOpen: function tagOpen() {
      var char = this.consume();

      if (char === "!") {
        this.state = 'markupDeclaration';
      } else if (char === "/") {
        this.state = 'endTagOpen';
      } else if ((0, utils.isAlpha)(char)) {
        this.state = 'tagName';
        this.delegate.beginStartTag();
        this.delegate.appendToTagName(char.toLowerCase());
      }
    },

    markupDeclaration: function markupDeclaration() {
      var char = this.consume();

      if (char === "-" && this.input.charAt(this.index) === "-") {
        this.consume();
        this.state = 'commentStart';
        this.delegate.beginComment();
      }
    },

    commentStart: function commentStart() {
      var char = this.consume();

      if (char === "-") {
        this.state = 'commentStartDash';
      } else if (char === ">") {
        this.delegate.finishComment();
        this.state = 'beforeData';
      } else {
        this.delegate.appendToCommentData(char);
        this.state = 'comment';
      }
    },

    commentStartDash: function commentStartDash() {
      var char = this.consume();

      if (char === "-") {
        this.state = 'commentEnd';
      } else if (char === ">") {
        this.delegate.finishComment();
        this.state = 'beforeData';
      } else {
        this.delegate.appendToCommentData("-");
        this.state = 'comment';
      }
    },

    comment: function comment() {
      var char = this.consume();

      if (char === "-") {
        this.state = 'commentEndDash';
      } else {
        this.delegate.appendToCommentData(char);
      }
    },

    commentEndDash: function commentEndDash() {
      var char = this.consume();

      if (char === "-") {
        this.state = 'commentEnd';
      } else {
        this.delegate.appendToCommentData("-" + char);
        this.state = 'comment';
      }
    },

    commentEnd: function commentEnd() {
      var char = this.consume();

      if (char === ">") {
        this.delegate.finishComment();
        this.state = 'beforeData';
      } else {
        this.delegate.appendToCommentData("--" + char);
        this.state = 'comment';
      }
    },

    tagName: function tagName() {
      var char = this.consume();

      if ((0, utils.isSpace)(char)) {
        this.state = 'beforeAttributeName';
      } else if (char === "/") {
        this.state = 'selfClosingStartTag';
      } else if (char === ">") {
        this.delegate.finishTag();
        this.state = 'beforeData';
      } else {
        this.delegate.appendToTagName(char);
      }
    },

    beforeAttributeName: function beforeAttributeName() {
      var char = this.peek();

      if ((0, utils.isSpace)(char)) {
        this.consume();
        return;
      } else if (char === "/") {
        this.state = 'selfClosingStartTag';
        this.consume();
      } else if (char === ">") {
        this.consume();
        this.delegate.finishTag();
        this.state = 'beforeData';
      } else {
        this.state = 'attributeName';
        this.delegate.beginAttribute();
        this.consume();
        this.delegate.appendToAttributeName(char);
      }
    },

    attributeName: function attributeName() {
      var char = this.peek();

      if ((0, utils.isSpace)(char)) {
        this.state = 'afterAttributeName';
        this.consume();
      } else if (char === "/") {
        this.delegate.beginAttributeValue(false);
        this.delegate.finishAttributeValue();
        this.consume();
        this.state = 'selfClosingStartTag';
      } else if (char === "=") {
        this.state = 'beforeAttributeValue';
        this.consume();
      } else if (char === ">") {
        this.delegate.beginAttributeValue(false);
        this.delegate.finishAttributeValue();
        this.consume();
        this.delegate.finishTag();
        this.state = 'beforeData';
      } else {
        this.consume();
        this.delegate.appendToAttributeName(char);
      }
    },

    afterAttributeName: function afterAttributeName() {
      var char = this.peek();

      if ((0, utils.isSpace)(char)) {
        this.consume();
        return;
      } else if (char === "/") {
        this.delegate.beginAttributeValue(false);
        this.delegate.finishAttributeValue();
        this.consume();
        this.state = 'selfClosingStartTag';
      } else if (char === "=") {
        this.consume();
        this.state = 'beforeAttributeValue';
      } else if (char === ">") {
        this.delegate.beginAttributeValue(false);
        this.delegate.finishAttributeValue();
        this.consume();
        this.delegate.finishTag();
        this.state = 'beforeData';
      } else {
        this.delegate.beginAttributeValue(false);
        this.delegate.finishAttributeValue();
        this.consume();
        this.state = 'attributeName';
        this.delegate.beginAttribute();
        this.delegate.appendToAttributeName(char);
      }
    },

    beforeAttributeValue: function beforeAttributeValue() {
      var char = this.peek();

      if ((0, utils.isSpace)(char)) {
        this.consume();
      } else if (char === '"') {
        this.state = 'attributeValueDoubleQuoted';
        this.delegate.beginAttributeValue(true);
        this.consume();
      } else if (char === "'") {
        this.state = 'attributeValueSingleQuoted';
        this.delegate.beginAttributeValue(true);
        this.consume();
      } else if (char === ">") {
        this.delegate.beginAttributeValue(false);
        this.delegate.finishAttributeValue();
        this.consume();
        this.delegate.finishTag();
        this.state = 'beforeData';
      } else {
        this.state = 'attributeValueUnquoted';
        this.delegate.beginAttributeValue(false);
        this.consume();
        this.delegate.appendToAttributeValue(char);
      }
    },

    attributeValueDoubleQuoted: function attributeValueDoubleQuoted() {
      var char = this.consume();

      if (char === '"') {
        this.delegate.finishAttributeValue();
        this.state = 'afterAttributeValueQuoted';
      } else if (char === "&") {
        this.delegate.appendToAttributeValue(this.consumeCharRef('"') || "&");
      } else {
        this.delegate.appendToAttributeValue(char);
      }
    },

    attributeValueSingleQuoted: function attributeValueSingleQuoted() {
      var char = this.consume();

      if (char === "'") {
        this.delegate.finishAttributeValue();
        this.state = 'afterAttributeValueQuoted';
      } else if (char === "&") {
        this.delegate.appendToAttributeValue(this.consumeCharRef("'") || "&");
      } else {
        this.delegate.appendToAttributeValue(char);
      }
    },

    attributeValueUnquoted: function attributeValueUnquoted() {
      var char = this.peek();

      if ((0, utils.isSpace)(char)) {
        this.delegate.finishAttributeValue();
        this.consume();
        this.state = 'beforeAttributeName';
      } else if (char === "&") {
        this.consume();
        this.delegate.appendToAttributeValue(this.consumeCharRef(">") || "&");
      } else if (char === ">") {
        this.delegate.finishAttributeValue();
        this.consume();
        this.delegate.finishTag();
        this.state = 'beforeData';
      } else {
        this.consume();
        this.delegate.appendToAttributeValue(char);
      }
    },

    afterAttributeValueQuoted: function afterAttributeValueQuoted() {
      var char = this.peek();

      if ((0, utils.isSpace)(char)) {
        this.consume();
        this.state = 'beforeAttributeName';
      } else if (char === "/") {
        this.consume();
        this.state = 'selfClosingStartTag';
      } else if (char === ">") {
        this.consume();
        this.delegate.finishTag();
        this.state = 'beforeData';
      } else {
        this.state = 'beforeAttributeName';
      }
    },

    selfClosingStartTag: function selfClosingStartTag() {
      var char = this.peek();

      if (char === ">") {
        this.consume();
        this.delegate.markTagAsSelfClosing();
        this.delegate.finishTag();
        this.state = 'beforeData';
      } else {
        this.state = 'beforeAttributeName';
      }
    },

    endTagOpen: function endTagOpen() {
      var char = this.consume();

      if ((0, utils.isAlpha)(char)) {
        this.state = 'tagName';
        this.delegate.beginEndTag();
        this.delegate.appendToTagName(char.toLowerCase());
      }
    }
  }
};

exports.default = EventedTokenizer;
});

unwrapExports$1(eventedTokenizer);

var tokenizer = createCommonjsModule$1(function (module, exports) {

exports.__esModule = true;



var _eventedTokenizer2 = _interopRequireDefault(eventedTokenizer);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function Tokenizer(entityParser, options) {
  this.token = null;
  this.startLine = 1;
  this.startColumn = 0;
  this.options = options || {};
  this.tokenizer = new _eventedTokenizer2.default(this, entityParser);
}

Tokenizer.prototype = {
  tokenize: function tokenize(input) {
    this.tokens = [];
    this.tokenizer.tokenize(input);
    return this.tokens;
  },

  tokenizePart: function tokenizePart(input) {
    this.tokens = [];
    this.tokenizer.tokenizePart(input);
    return this.tokens;
  },

  tokenizeEOF: function tokenizeEOF() {
    this.tokens = [];
    this.tokenizer.tokenizeEOF();
    return this.tokens[0];
  },

  reset: function reset() {
    this.token = null;
    this.startLine = 1;
    this.startColumn = 0;
  },

  addLocInfo: function addLocInfo() {
    if (this.options.loc) {
      this.token.loc = {
        start: {
          line: this.startLine,
          column: this.startColumn
        },
        end: {
          line: this.tokenizer.line,
          column: this.tokenizer.column
        }
      };
    }
    this.startLine = this.tokenizer.line;
    this.startColumn = this.tokenizer.column;
  },

  // Data

  beginData: function beginData() {
    this.token = {
      type: 'Chars',
      chars: ''
    };
    this.tokens.push(this.token);
  },

  appendToData: function appendToData(char) {
    this.token.chars += char;
  },

  finishData: function finishData() {
    this.addLocInfo();
  },

  // Comment

  beginComment: function beginComment() {
    this.token = {
      type: 'Comment',
      chars: ''
    };
    this.tokens.push(this.token);
  },

  appendToCommentData: function appendToCommentData(char) {
    this.token.chars += char;
  },

  finishComment: function finishComment() {
    this.addLocInfo();
  },

  // Tags - basic

  beginStartTag: function beginStartTag() {
    this.token = {
      type: 'StartTag',
      tagName: '',
      attributes: [],
      selfClosing: false
    };
    this.tokens.push(this.token);
  },

  beginEndTag: function beginEndTag() {
    this.token = {
      type: 'EndTag',
      tagName: ''
    };
    this.tokens.push(this.token);
  },

  finishTag: function finishTag() {
    this.addLocInfo();
  },

  markTagAsSelfClosing: function markTagAsSelfClosing() {
    this.token.selfClosing = true;
  },

  // Tags - name

  appendToTagName: function appendToTagName(char) {
    this.token.tagName += char;
  },

  // Tags - attributes

  beginAttribute: function beginAttribute() {
    this._currentAttribute = ["", "", null];
    this.token.attributes.push(this._currentAttribute);
  },

  appendToAttributeName: function appendToAttributeName(char) {
    this._currentAttribute[0] += char;
  },

  beginAttributeValue: function beginAttributeValue(isQuoted) {
    this._currentAttribute[2] = isQuoted;
  },

  appendToAttributeValue: function appendToAttributeValue(char) {
    this._currentAttribute[1] = this._currentAttribute[1] || "";
    this._currentAttribute[1] += char;
  },

  finishAttributeValue: function finishAttributeValue() {}
};

exports.default = Tokenizer;
});

unwrapExports$1(tokenizer);

var tokenize_1 = createCommonjsModule$1(function (module, exports) {

exports.__esModule = true;
exports.default = tokenize;



var _tokenizer2 = _interopRequireDefault(tokenizer);



var _entityParser2 = _interopRequireDefault(entityParser);



var _html5NamedCharRefs2 = _interopRequireDefault(html5NamedCharRefs);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function tokenize(input, options) {
  var tokenizer$$1 = new _tokenizer2.default(new _entityParser2.default(_html5NamedCharRefs2.default), options);
  return tokenizer$$1.tokenize(input);
}
});

unwrapExports$1(tokenize_1);

var simpleHtmlTokenizer = createCommonjsModule$1(function (module, exports) {

exports.__esModule = true;



var _html5NamedCharRefs2 = _interopRequireDefault(html5NamedCharRefs);



var _entityParser2 = _interopRequireDefault(entityParser);



var _eventedTokenizer2 = _interopRequireDefault(eventedTokenizer);



var _tokenizer2 = _interopRequireDefault(tokenizer);



var _tokenize2 = _interopRequireDefault(tokenize_1);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var HTML5Tokenizer = {
	HTML5NamedCharRefs: _html5NamedCharRefs2.default,
	EntityParser: _entityParser2.default,
	EventedTokenizer: _eventedTokenizer2.default,
	Tokenizer: _tokenizer2.default,
	tokenize: _tokenize2.default
};

exports.default = HTML5Tokenizer;
});

unwrapExports$1(simpleHtmlTokenizer);

var _class = createCommonjsModule$1(function (module, exports) {

exports.__esModule = true;
exports.inherits = inherits;
function inherits(parent, child) {
	var props = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};

	var extended = Object.create(parent.prototype);
	for (var p in props) {
		extended[p] = props[p];
	}
	extended.constructor = child;
	child.prototype = extended;
	return child;
}
});

unwrapExports$1(_class);
var _class_1 = _class.inherits;

var options = createCommonjsModule$1(function (module, exports) {

exports.__esModule = true;

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

var defaults = {
	defaultProtocol: 'http',
	events: null,
	format: noop,
	formatHref: noop,
	nl2br: false,
	tagName: 'a',
	target: typeToTarget,
	validate: true,
	ignoreTags: [],
	attributes: null,
	className: 'linkified' // Deprecated value - no default class will be provided in the future
};

exports.defaults = defaults;
exports.Options = Options;
exports.contains = contains;


function Options(opts) {
	opts = opts || {};

	this.defaultProtocol = opts.hasOwnProperty('defaultProtocol') ? opts.defaultProtocol : defaults.defaultProtocol;
	this.events = opts.hasOwnProperty('events') ? opts.events : defaults.events;
	this.format = opts.hasOwnProperty('format') ? opts.format : defaults.format;
	this.formatHref = opts.hasOwnProperty('formatHref') ? opts.formatHref : defaults.formatHref;
	this.nl2br = opts.hasOwnProperty('nl2br') ? opts.nl2br : defaults.nl2br;
	this.tagName = opts.hasOwnProperty('tagName') ? opts.tagName : defaults.tagName;
	this.target = opts.hasOwnProperty('target') ? opts.target : defaults.target;
	this.validate = opts.hasOwnProperty('validate') ? opts.validate : defaults.validate;
	this.ignoreTags = [];

	// linkAttributes and linkClass is deprecated
	this.attributes = opts.attributes || opts.linkAttributes || defaults.attributes;
	this.className = opts.hasOwnProperty('className') ? opts.className : opts.linkClass || defaults.className;

	// Make all tags names upper case
	var ignoredTags = opts.hasOwnProperty('ignoreTags') ? opts.ignoreTags : defaults.ignoreTags;
	for (var i = 0; i < ignoredTags.length; i++) {
		this.ignoreTags.push(ignoredTags[i].toUpperCase());
	}
}

Options.prototype = {
	/**
  * Given the token, return all options for how it should be displayed
  */
	resolve: function resolve(token) {
		var href = token.toHref(this.defaultProtocol);
		return {
			formatted: this.get('format', token.toString(), token),
			formattedHref: this.get('formatHref', href, token),
			tagName: this.get('tagName', href, token),
			className: this.get('className', href, token),
			target: this.get('target', href, token),
			events: this.getObject('events', href, token),
			attributes: this.getObject('attributes', href, token)
		};
	},


	/**
  * Returns true or false based on whether a token should be displayed as a
  * link based on the user options. By default,
  */
	check: function check(token) {
		return this.get('validate', token.toString(), token);
	},


	// Private methods

	/**
  * Resolve an option's value based on the value of the option and the given
  * params.
  * @param {String} key Name of option to use
  * @param operator will be passed to the target option if it's method
  * @param {MultiToken} token The token from linkify.tokenize
  */
	get: function get(key, operator, token) {
		var optionValue = void 0,
		    option = this[key];
		if (!option) {
			return option;
		}

		switch (typeof option === 'undefined' ? 'undefined' : _typeof(option)) {
			case 'function':
				return option(operator, token.type);
			case 'object':
				optionValue = option.hasOwnProperty(token.type) ? option[token.type] : defaults[key];
				return typeof optionValue === 'function' ? optionValue(operator, token.type) : optionValue;
		}

		return option;
	},
	getObject: function getObject(key, operator, token) {
		var option = this[key];
		return typeof option === 'function' ? option(operator, token.type) : option;
	}
};

/**
 * Quick indexOf replacement for checking the ignoreTags option
 */
function contains(arr, value) {
	for (var i = 0; i < arr.length; i++) {
		if (arr[i] === value) {
			return true;
		}
	}
	return false;
}

function noop(val) {
	return val;
}

function typeToTarget(href, type) {
	return type === 'url' ? '_blank' : null;
}
});

unwrapExports$1(options);
var options_1 = options.defaults;
var options_2 = options.Options;
var options_3 = options.contains;

var state = createCommonjsModule$1(function (module, exports) {

exports.__esModule = true;
exports.stateify = exports.TokenState = exports.CharacterState = undefined;



function createStateClass() {
	return function (tClass) {
		this.j = [];
		this.T = tClass || null;
	};
}

/**
	A simple state machine that can emit token classes

	The `j` property in this class refers to state jumps. It's a
	multidimensional array where for each element:

	* index [0] is a symbol or class of symbols to transition to.
	* index [1] is a State instance which matches

	The type of symbol will depend on the target implementation for this class.
	In Linkify, we have a two-stage scanner. Each stage uses this state machine
	but with a slighly different (polymorphic) implementation.

	The `T` property refers to the token class.

	TODO: Can the `on` and `next` methods be combined?

	@class BaseState
*/
var BaseState = createStateClass();
BaseState.prototype = {
	defaultTransition: false,

	/**
 	@method constructor
 	@param {Class} tClass Pass in the kind of token to emit if there are
 		no jumps after this state and the state is accepting.
 */

	/**
 	On the given symbol(s), this machine should go to the given state
 		@method on
 	@param {Array|Mixed} symbol
 	@param {BaseState} state Note that the type of this state should be the
 		same as the current instance (i.e., don't pass in a different
 		subclass)
 */
	on: function on(symbol, state) {
		if (symbol instanceof Array) {
			for (var i = 0; i < symbol.length; i++) {
				this.j.push([symbol[i], state]);
			}
			return this;
		}
		this.j.push([symbol, state]);
		return this;
	},


	/**
 	Given the next item, returns next state for that item
 	@method next
 	@param {Mixed} item Should be an instance of the symbols handled by
 		this particular machine.
 	@return {State} state Returns false if no jumps are available
 */
	next: function next(item) {
		for (var i = 0; i < this.j.length; i++) {
			var jump = this.j[i];
			var symbol = jump[0]; // Next item to check for
			var state = jump[1]; // State to jump to if items match

			// compare item with symbol
			if (this.test(item, symbol)) {
				return state;
			}
		}

		// Nowhere left to jump!
		return this.defaultTransition;
	},


	/**
 	Does this state accept?
 	`true` only of `this.T` exists
 		@method accepts
 	@return {Boolean}
 */
	accepts: function accepts() {
		return !!this.T;
	},


	/**
 	Determine whether a given item "symbolizes" the symbol, where symbol is
 	a class of items handled by this state machine.
 		This method should be overriden in extended classes.
 		@method test
 	@param {Mixed} item Does this item match the given symbol?
 	@param {Mixed} symbol
 	@return {Boolean}
 */
	test: function test(item, symbol) {
		return item === symbol;
	},


	/**
 	Emit the token for this State (just return it in this case)
 	If this emits a token, this instance is an accepting state
 	@method emit
 	@return {Class} T
 */
	emit: function emit() {
		return this.T;
	}
};

/**
	State machine for string-based input

	@class CharacterState
	@extends BaseState
*/
var CharacterState = (0, _class.inherits)(BaseState, createStateClass(), {
	/**
 	Does the given character match the given character or regular
 	expression?
 		@method test
 	@param {String} char
 	@param {String|RegExp} charOrRegExp
 	@return {Boolean}
 */
	test: function test(character, charOrRegExp) {
		return character === charOrRegExp || charOrRegExp instanceof RegExp && charOrRegExp.test(character);
	}
});

/**
	State machine for input in the form of TextTokens

	@class TokenState
	@extends BaseState
*/
var TokenState = (0, _class.inherits)(BaseState, createStateClass(), {

	/**
  * Similar to `on`, but returns the state the results in the transition from
  * the given item
  * @method jump
  * @param {Mixed} item
  * @param {Token} [token]
  * @return state
  */
	jump: function jump(token) {
		var tClass = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

		var state = this.next(new token('')); // dummy temp token
		if (state === this.defaultTransition) {
			// Make a new state!
			state = new this.constructor(tClass);
			this.on(token, state);
		} else if (tClass) {
			state.T = tClass;
		}
		return state;
	},


	/**
 	Is the given token an instance of the given token class?
 		@method test
 	@param {TextToken} token
 	@param {Class} tokenClass
 	@return {Boolean}
 */
	test: function test(token, tokenClass) {
		return token instanceof tokenClass;
	}
});

/**
	Given a non-empty target string, generates states (if required) for each
	consecutive substring of characters in str starting from the beginning of
	the string. The final state will have a special value, as specified in
	options. All other "in between" substrings will have a default end state.

	This turns the state machine into a Trie-like data structure (rather than a
	intelligently-designed DFA).

	Note that I haven't really tried these with any strings other than
	DOMAIN.

	@param {String} str
	@param {CharacterState} start State to jump from the first character
	@param {Class} endToken Token class to emit when the given string has been
		matched and no more jumps exist.
	@param {Class} defaultToken "Filler token", or which token type to emit when
		we don't have a full match
	@return {Array} list of newly-created states
*/
function stateify(str, start, endToken, defaultToken) {
	var i = 0,
	    len = str.length,
	    state = start,
	    newStates = [],
	    nextState = void 0;

	// Find the next state without a jump to the next character
	while (i < len && (nextState = state.next(str[i]))) {
		state = nextState;
		i++;
	}

	if (i >= len) {
		return [];
	} // no new tokens were added

	while (i < len - 1) {
		nextState = new CharacterState(defaultToken);
		newStates.push(nextState);
		state.on(str[i], nextState);
		state = nextState;
		i++;
	}

	nextState = new CharacterState(endToken);
	newStates.push(nextState);
	state.on(str[len - 1], nextState);

	return newStates;
}

exports.CharacterState = CharacterState;
exports.TokenState = TokenState;
exports.stateify = stateify;
});

unwrapExports$1(state);
var state_1 = state.stateify;
var state_2 = state.TokenState;
var state_3 = state.CharacterState;

var createTokenClass_1 = createCommonjsModule$1(function (module, exports) {

exports.__esModule = true;
function createTokenClass() {
	return function (value) {
		if (value) {
			this.v = value;
		}
	};
}

exports.createTokenClass = createTokenClass;
});

unwrapExports$1(createTokenClass_1);
var createTokenClass_2 = createTokenClass_1.createTokenClass;

var text = createCommonjsModule$1(function (module, exports) {

exports.__esModule = true;
exports.AMPERSAND = exports.CLOSEPAREN = exports.CLOSEANGLEBRACKET = exports.CLOSEBRACKET = exports.CLOSEBRACE = exports.OPENPAREN = exports.OPENANGLEBRACKET = exports.OPENBRACKET = exports.OPENBRACE = exports.WS = exports.TLD = exports.SYM = exports.UNDERSCORE = exports.SLASH = exports.MAILTO = exports.PROTOCOL = exports.QUERY = exports.POUND = exports.PLUS = exports.NUM = exports.NL = exports.LOCALHOST = exports.PUNCTUATION = exports.DOT = exports.COLON = exports.AT = exports.DOMAIN = exports.Base = undefined;





/******************************************************************************
	Text Tokens
	Tokens composed of strings
******************************************************************************/

/**
	Abstract class used for manufacturing text tokens.
	Pass in the value this token represents

	@class TextToken
	@abstract
*/
var TextToken = (0, createTokenClass_1.createTokenClass)();
TextToken.prototype = {
	toString: function toString() {
		return this.v + '';
	}
};

function inheritsToken(value) {
	var props = value ? { v: value } : {};
	return (0, _class.inherits)(TextToken, (0, createTokenClass_1.createTokenClass)(), props);
}

/**
	A valid domain token
	@class DOMAIN
	@extends TextToken
*/
var DOMAIN = inheritsToken();

/**
	@class AT
	@extends TextToken
*/
var AT = inheritsToken('@');

/**
	Represents a single colon `:` character

	@class COLON
	@extends TextToken
*/
var COLON = inheritsToken(':');

/**
	@class DOT
	@extends TextToken
*/
var DOT = inheritsToken('.');

/**
	A character class that can surround the URL, but which the URL cannot begin
	or end with. Does not include certain English punctuation like parentheses.

	@class PUNCTUATION
	@extends TextToken
*/
var PUNCTUATION = inheritsToken();

/**
	The word localhost (by itself)
	@class LOCALHOST
	@extends TextToken
*/
var LOCALHOST = inheritsToken();

/**
	Newline token
	@class NL
	@extends TextToken
*/
var NL = inheritsToken('\n');

/**
	@class NUM
	@extends TextToken
*/
var NUM = inheritsToken();

/**
	@class PLUS
	@extends TextToken
*/
var PLUS = inheritsToken('+');

/**
	@class POUND
	@extends TextToken
*/
var POUND = inheritsToken('#');

/**
	Represents a web URL protocol. Supported types include

	* `http:`
	* `https:`
	* `ftp:`
	* `ftps:`

	@class PROTOCOL
	@extends TextToken
*/
var PROTOCOL = inheritsToken();

/**
	Represents the start of the email URI protocol

	@class MAILTO
	@extends TextToken
*/
var MAILTO = inheritsToken('mailto:');

/**
	@class QUERY
	@extends TextToken
*/
var QUERY = inheritsToken('?');

/**
	@class SLASH
	@extends TextToken
*/
var SLASH = inheritsToken('/');

/**
	@class UNDERSCORE
	@extends TextToken
*/
var UNDERSCORE = inheritsToken('_');

/**
	One ore more non-whitespace symbol.
	@class SYM
	@extends TextToken
*/
var SYM = inheritsToken();

/**
	@class TLD
	@extends TextToken
*/
var TLD = inheritsToken();

/**
	Represents a string of consecutive whitespace characters

	@class WS
	@extends TextToken
*/
var WS = inheritsToken();

/**
	Opening/closing bracket classes
*/

var OPENBRACE = inheritsToken('{');
var OPENBRACKET = inheritsToken('[');
var OPENANGLEBRACKET = inheritsToken('<');
var OPENPAREN = inheritsToken('(');
var CLOSEBRACE = inheritsToken('}');
var CLOSEBRACKET = inheritsToken(']');
var CLOSEANGLEBRACKET = inheritsToken('>');
var CLOSEPAREN = inheritsToken(')');

var AMPERSAND = inheritsToken('&');

exports.Base = TextToken;
exports.DOMAIN = DOMAIN;
exports.AT = AT;
exports.COLON = COLON;
exports.DOT = DOT;
exports.PUNCTUATION = PUNCTUATION;
exports.LOCALHOST = LOCALHOST;
exports.NL = NL;
exports.NUM = NUM;
exports.PLUS = PLUS;
exports.POUND = POUND;
exports.QUERY = QUERY;
exports.PROTOCOL = PROTOCOL;
exports.MAILTO = MAILTO;
exports.SLASH = SLASH;
exports.UNDERSCORE = UNDERSCORE;
exports.SYM = SYM;
exports.TLD = TLD;
exports.WS = WS;
exports.OPENBRACE = OPENBRACE;
exports.OPENBRACKET = OPENBRACKET;
exports.OPENANGLEBRACKET = OPENANGLEBRACKET;
exports.OPENPAREN = OPENPAREN;
exports.CLOSEBRACE = CLOSEBRACE;
exports.CLOSEBRACKET = CLOSEBRACKET;
exports.CLOSEANGLEBRACKET = CLOSEANGLEBRACKET;
exports.CLOSEPAREN = CLOSEPAREN;
exports.AMPERSAND = AMPERSAND;
});

unwrapExports$1(text);
var text_1 = text.AMPERSAND;
var text_2 = text.CLOSEPAREN;
var text_3 = text.CLOSEANGLEBRACKET;
var text_4 = text.CLOSEBRACKET;
var text_5 = text.CLOSEBRACE;
var text_6 = text.OPENPAREN;
var text_7 = text.OPENANGLEBRACKET;
var text_8 = text.OPENBRACKET;
var text_9 = text.OPENBRACE;
var text_10 = text.WS;
var text_11 = text.TLD;
var text_12 = text.SYM;
var text_13 = text.UNDERSCORE;
var text_14 = text.SLASH;
var text_15 = text.MAILTO;
var text_16 = text.PROTOCOL;
var text_17 = text.QUERY;
var text_18 = text.POUND;
var text_19 = text.PLUS;
var text_20 = text.NUM;
var text_21 = text.NL;
var text_22 = text.LOCALHOST;
var text_23 = text.PUNCTUATION;
var text_24 = text.DOT;
var text_25 = text.COLON;
var text_26 = text.AT;
var text_27 = text.DOMAIN;
var text_28 = text.Base;

var scanner = createCommonjsModule$1(function (module, exports) {

exports.__esModule = true;
exports.start = exports.run = exports.TOKENS = exports.State = undefined;





var TOKENS = _interopRequireWildcard(text);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

var tlds = 'aaa|aarp|abarth|abb|abbott|abbvie|abc|able|abogado|abudhabi|ac|academy|accenture|accountant|accountants|aco|active|actor|ad|adac|ads|adult|ae|aeg|aero|aetna|af|afamilycompany|afl|africa|ag|agakhan|agency|ai|aig|aigo|airbus|airforce|airtel|akdn|al|alfaromeo|alibaba|alipay|allfinanz|allstate|ally|alsace|alstom|am|americanexpress|americanfamily|amex|amfam|amica|amsterdam|analytics|android|anquan|anz|ao|aol|apartments|app|apple|aq|aquarelle|ar|arab|aramco|archi|army|arpa|art|arte|as|asda|asia|associates|at|athleta|attorney|au|auction|audi|audible|audio|auspost|author|auto|autos|avianca|aw|aws|ax|axa|az|azure|ba|baby|baidu|banamex|bananarepublic|band|bank|bar|barcelona|barclaycard|barclays|barefoot|bargains|baseball|basketball|bauhaus|bayern|bb|bbc|bbt|bbva|bcg|bcn|bd|be|beats|beauty|beer|bentley|berlin|best|bestbuy|bet|bf|bg|bh|bharti|bi|bible|bid|bike|bing|bingo|bio|biz|bj|black|blackfriday|blanco|blockbuster|blog|bloomberg|blue|bm|bms|bmw|bn|bnl|bnpparibas|bo|boats|boehringer|bofa|bom|bond|boo|book|booking|boots|bosch|bostik|boston|bot|boutique|box|br|bradesco|bridgestone|broadway|broker|brother|brussels|bs|bt|budapest|bugatti|build|builders|business|buy|buzz|bv|bw|by|bz|bzh|ca|cab|cafe|cal|call|calvinklein|cam|camera|camp|cancerresearch|canon|capetown|capital|capitalone|car|caravan|cards|care|career|careers|cars|cartier|casa|case|caseih|cash|casino|cat|catering|catholic|cba|cbn|cbre|cbs|cc|cd|ceb|center|ceo|cern|cf|cfa|cfd|cg|ch|chanel|channel|chase|chat|cheap|chintai|chloe|christmas|chrome|chrysler|church|ci|cipriani|circle|cisco|citadel|citi|citic|city|cityeats|ck|cl|claims|cleaning|click|clinic|clinique|clothing|cloud|club|clubmed|cm|cn|co|coach|codes|coffee|college|cologne|com|comcast|commbank|community|company|compare|computer|comsec|condos|construction|consulting|contact|contractors|cooking|cookingchannel|cool|coop|corsica|country|coupon|coupons|courses|cr|credit|creditcard|creditunion|cricket|crown|crs|cruise|cruises|csc|cu|cuisinella|cv|cw|cx|cy|cymru|cyou|cz|dabur|dad|dance|data|date|dating|datsun|day|dclk|dds|de|deal|dealer|deals|degree|delivery|dell|deloitte|delta|democrat|dental|dentist|desi|design|dev|dhl|diamonds|diet|digital|direct|directory|discount|discover|dish|diy|dj|dk|dm|dnp|do|docs|doctor|dodge|dog|doha|domains|dot|download|drive|dtv|dubai|duck|dunlop|duns|dupont|durban|dvag|dvr|dz|earth|eat|ec|eco|edeka|edu|education|ee|eg|email|emerck|energy|engineer|engineering|enterprises|epost|epson|equipment|er|ericsson|erni|es|esq|estate|esurance|et|etisalat|eu|eurovision|eus|events|everbank|exchange|expert|exposed|express|extraspace|fage|fail|fairwinds|faith|family|fan|fans|farm|farmers|fashion|fast|fedex|feedback|ferrari|ferrero|fi|fiat|fidelity|fido|film|final|finance|financial|fire|firestone|firmdale|fish|fishing|fit|fitness|fj|fk|flickr|flights|flir|florist|flowers|fly|fm|fo|foo|food|foodnetwork|football|ford|forex|forsale|forum|foundation|fox|fr|free|fresenius|frl|frogans|frontdoor|frontier|ftr|fujitsu|fujixerox|fun|fund|furniture|futbol|fyi|ga|gal|gallery|gallo|gallup|game|games|gap|garden|gb|gbiz|gd|gdn|ge|gea|gent|genting|george|gf|gg|ggee|gh|gi|gift|gifts|gives|giving|gl|glade|glass|gle|global|globo|gm|gmail|gmbh|gmo|gmx|gn|godaddy|gold|goldpoint|golf|goo|goodhands|goodyear|goog|google|gop|got|gov|gp|gq|gr|grainger|graphics|gratis|green|gripe|grocery|group|gs|gt|gu|guardian|gucci|guge|guide|guitars|guru|gw|gy|hair|hamburg|hangout|haus|hbo|hdfc|hdfcbank|health|healthcare|help|helsinki|here|hermes|hgtv|hiphop|hisamitsu|hitachi|hiv|hk|hkt|hm|hn|hockey|holdings|holiday|homedepot|homegoods|homes|homesense|honda|honeywell|horse|hospital|host|hosting|hot|hoteles|hotels|hotmail|house|how|hr|hsbc|ht|htc|hu|hughes|hyatt|hyundai|ibm|icbc|ice|icu|id|ie|ieee|ifm|ikano|il|im|imamat|imdb|immo|immobilien|in|industries|infiniti|info|ing|ink|institute|insurance|insure|int|intel|international|intuit|investments|io|ipiranga|iq|ir|irish|is|iselect|ismaili|ist|istanbul|it|itau|itv|iveco|iwc|jaguar|java|jcb|jcp|je|jeep|jetzt|jewelry|jio|jlc|jll|jm|jmp|jnj|jo|jobs|joburg|jot|joy|jp|jpmorgan|jprs|juegos|juniper|kaufen|kddi|ke|kerryhotels|kerrylogistics|kerryproperties|kfh|kg|kh|ki|kia|kim|kinder|kindle|kitchen|kiwi|km|kn|koeln|komatsu|kosher|kp|kpmg|kpn|kr|krd|kred|kuokgroup|kw|ky|kyoto|kz|la|lacaixa|ladbrokes|lamborghini|lamer|lancaster|lancia|lancome|land|landrover|lanxess|lasalle|lat|latino|latrobe|law|lawyer|lb|lc|lds|lease|leclerc|lefrak|legal|lego|lexus|lgbt|li|liaison|lidl|life|lifeinsurance|lifestyle|lighting|like|lilly|limited|limo|lincoln|linde|link|lipsy|live|living|lixil|lk|loan|loans|locker|locus|loft|lol|london|lotte|lotto|love|lpl|lplfinancial|lr|ls|lt|ltd|ltda|lu|lundbeck|lupin|luxe|luxury|lv|ly|ma|macys|madrid|maif|maison|makeup|man|management|mango|map|market|marketing|markets|marriott|marshalls|maserati|mattel|mba|mc|mckinsey|md|me|med|media|meet|melbourne|meme|memorial|men|menu|meo|merckmsd|metlife|mg|mh|miami|microsoft|mil|mini|mint|mit|mitsubishi|mk|ml|mlb|mls|mm|mma|mn|mo|mobi|mobile|mobily|moda|moe|moi|mom|monash|money|monster|mopar|mormon|mortgage|moscow|moto|motorcycles|mov|movie|movistar|mp|mq|mr|ms|msd|mt|mtn|mtr|mu|museum|mutual|mv|mw|mx|my|mz|na|nab|nadex|nagoya|name|nationwide|natura|navy|nba|nc|ne|nec|net|netbank|netflix|network|neustar|new|newholland|news|next|nextdirect|nexus|nf|nfl|ng|ngo|nhk|ni|nico|nike|nikon|ninja|nissan|nissay|nl|no|nokia|northwesternmutual|norton|now|nowruz|nowtv|np|nr|nra|nrw|ntt|nu|nyc|nz|obi|observer|off|office|okinawa|olayan|olayangroup|oldnavy|ollo|om|omega|one|ong|onl|online|onyourside|ooo|open|oracle|orange|org|organic|origins|osaka|otsuka|ott|ovh|pa|page|panasonic|panerai|paris|pars|partners|parts|party|passagens|pay|pccw|pe|pet|pf|pfizer|pg|ph|pharmacy|phd|philips|phone|photo|photography|photos|physio|piaget|pics|pictet|pictures|pid|pin|ping|pink|pioneer|pizza|pk|pl|place|play|playstation|plumbing|plus|pm|pn|pnc|pohl|poker|politie|porn|post|pr|pramerica|praxi|press|prime|pro|prod|productions|prof|progressive|promo|properties|property|protection|pru|prudential|ps|pt|pub|pw|pwc|py|qa|qpon|quebec|quest|qvc|racing|radio|raid|re|read|realestate|realtor|realty|recipes|red|redstone|redumbrella|rehab|reise|reisen|reit|reliance|ren|rent|rentals|repair|report|republican|rest|restaurant|review|reviews|rexroth|rich|richardli|ricoh|rightathome|ril|rio|rip|rmit|ro|rocher|rocks|rodeo|rogers|room|rs|rsvp|ru|rugby|ruhr|run|rw|rwe|ryukyu|sa|saarland|safe|safety|sakura|sale|salon|samsclub|samsung|sandvik|sandvikcoromant|sanofi|sap|sapo|sarl|sas|save|saxo|sb|sbi|sbs|sc|sca|scb|schaeffler|schmidt|scholarships|school|schule|schwarz|science|scjohnson|scor|scot|sd|se|search|seat|secure|security|seek|select|sener|services|ses|seven|sew|sex|sexy|sfr|sg|sh|shangrila|sharp|shaw|shell|shia|shiksha|shoes|shop|shopping|shouji|show|showtime|shriram|si|silk|sina|singles|site|sj|sk|ski|skin|sky|skype|sl|sling|sm|smart|smile|sn|sncf|so|soccer|social|softbank|software|sohu|solar|solutions|song|sony|soy|space|spiegel|spot|spreadbetting|sr|srl|srt|st|stada|staples|star|starhub|statebank|statefarm|statoil|stc|stcgroup|stockholm|storage|store|stream|studio|study|style|su|sucks|supplies|supply|support|surf|surgery|suzuki|sv|swatch|swiftcover|swiss|sx|sy|sydney|symantec|systems|sz|tab|taipei|talk|taobao|target|tatamotors|tatar|tattoo|tax|taxi|tc|tci|td|tdk|team|tech|technology|tel|telecity|telefonica|temasek|tennis|teva|tf|tg|th|thd|theater|theatre|tiaa|tickets|tienda|tiffany|tips|tires|tirol|tj|tjmaxx|tjx|tk|tkmaxx|tl|tm|tmall|tn|to|today|tokyo|tools|top|toray|toshiba|total|tours|town|toyota|toys|tr|trade|trading|training|travel|travelchannel|travelers|travelersinsurance|trust|trv|tt|tube|tui|tunes|tushu|tv|tvs|tw|tz|ua|ubank|ubs|uconnect|ug|uk|unicom|university|uno|uol|ups|us|uy|uz|va|vacations|vana|vanguard|vc|ve|vegas|ventures|verisign|versicherung|vet|vg|vi|viajes|video|vig|viking|villas|vin|vip|virgin|visa|vision|vista|vistaprint|viva|vivo|vlaanderen|vn|vodka|volkswagen|volvo|vote|voting|voto|voyage|vu|vuelos|wales|walmart|walter|wang|wanggou|warman|watch|watches|weather|weatherchannel|webcam|weber|website|wed|wedding|weibo|weir|wf|whoswho|wien|wiki|williamhill|win|windows|wine|winners|wme|wolterskluwer|woodside|work|works|world|wow|ws|wtc|wtf|xbox|xerox|xfinity|xihuan|xin|xn--11b4c3d|xn--1ck2e1b|xn--1qqw23a|xn--2scrj9c|xn--30rr7y|xn--3bst00m|xn--3ds443g|xn--3e0b707e|xn--3hcrj9c|xn--3oq18vl8pn36a|xn--3pxu8k|xn--42c2d9a|xn--45br5cyl|xn--45brj9c|xn--45q11c|xn--4gbrim|xn--54b7fta0cc|xn--55qw42g|xn--55qx5d|xn--5su34j936bgsg|xn--5tzm5g|xn--6frz82g|xn--6qq986b3xl|xn--80adxhks|xn--80ao21a|xn--80aqecdr1a|xn--80asehdb|xn--80aswg|xn--8y0a063a|xn--90a3ac|xn--90ae|xn--90ais|xn--9dbq2a|xn--9et52u|xn--9krt00a|xn--b4w605ferd|xn--bck1b9a5dre4c|xn--c1avg|xn--c2br7g|xn--cck2b3b|xn--cg4bki|xn--clchc0ea0b2g2a9gcd|xn--czr694b|xn--czrs0t|xn--czru2d|xn--d1acj3b|xn--d1alf|xn--e1a4c|xn--eckvdtc9d|xn--efvy88h|xn--estv75g|xn--fct429k|xn--fhbei|xn--fiq228c5hs|xn--fiq64b|xn--fiqs8s|xn--fiqz9s|xn--fjq720a|xn--flw351e|xn--fpcrj9c3d|xn--fzc2c9e2c|xn--fzys8d69uvgm|xn--g2xx48c|xn--gckr3f0f|xn--gecrj9c|xn--gk3at1e|xn--h2breg3eve|xn--h2brj9c|xn--h2brj9c8c|xn--hxt814e|xn--i1b6b1a6a2e|xn--imr513n|xn--io0a7i|xn--j1aef|xn--j1amh|xn--j6w193g|xn--jlq61u9w7b|xn--jvr189m|xn--kcrx77d1x4a|xn--kprw13d|xn--kpry57d|xn--kpu716f|xn--kput3i|xn--l1acc|xn--lgbbat1ad8j|xn--mgb9awbf|xn--mgba3a3ejt|xn--mgba3a4f16a|xn--mgba7c0bbn0a|xn--mgbaakc7dvf|xn--mgbaam7a8h|xn--mgbab2bd|xn--mgbai9azgqp6j|xn--mgbayh7gpa|xn--mgbb9fbpob|xn--mgbbh1a|xn--mgbbh1a71e|xn--mgbc0a9azcg|xn--mgbca7dzdo|xn--mgberp4a5d4ar|xn--mgbgu82a|xn--mgbi4ecexp|xn--mgbpl2fh|xn--mgbt3dhd|xn--mgbtx2b|xn--mgbx4cd0ab|xn--mix891f|xn--mk1bu44c|xn--mxtq1m|xn--ngbc5azd|xn--ngbe9e0a|xn--ngbrx|xn--node|xn--nqv7f|xn--nqv7fs00ema|xn--nyqy26a|xn--o3cw4h|xn--ogbpf8fl|xn--p1acf|xn--p1ai|xn--pbt977c|xn--pgbs0dh|xn--pssy2u|xn--q9jyb4c|xn--qcka1pmc|xn--qxam|xn--rhqv96g|xn--rovu88b|xn--rvc1e0am3e|xn--s9brj9c|xn--ses554g|xn--t60b56a|xn--tckwe|xn--tiq49xqyj|xn--unup4y|xn--vermgensberater-ctb|xn--vermgensberatung-pwb|xn--vhquv|xn--vuq861b|xn--w4r85el8fhu5dnra|xn--w4rs40l|xn--wgbh1c|xn--wgbl6a|xn--xhq521b|xn--xkc2al3hye2a|xn--xkc2dl3a5ee0h|xn--y9a3aq|xn--yfro4i67o|xn--ygbi2ammx|xn--zfr164b|xperia|xxx|xyz|yachts|yahoo|yamaxun|yandex|ye|yodobashi|yoga|yokohama|you|youtube|yt|yun|za|zappos|zara|zero|zip|zippo|zm|zone|zuerich|zw'.split('|'); // macro, see gulpfile.js

/**
	The scanner provides an interface that takes a string of text as input, and
	outputs an array of tokens instances that can be used for easy URL parsing.

	@module linkify
	@submodule scanner
	@main scanner
*/

var NUMBERS = '0123456789'.split('');
var ALPHANUM = '0123456789abcdefghijklmnopqrstuvwxyz'.split('');
var WHITESPACE = [' ', '\f', '\r', '\t', '\v', '\xA0', '\u1680', '\u180E']; // excluding line breaks

var domainStates = []; // states that jump to DOMAIN on /[a-z0-9]/
var makeState = function makeState(tokenClass) {
	return new state.CharacterState(tokenClass);
};

// Frequently used states
var S_START = makeState();
var S_NUM = makeState(text.NUM);
var S_DOMAIN = makeState(text.DOMAIN);
var S_DOMAIN_HYPHEN = makeState(); // domain followed by 1 or more hyphen characters
var S_WS = makeState(text.WS);

// States for special URL symbols
S_START.on('@', makeState(text.AT)).on('.', makeState(text.DOT)).on('+', makeState(text.PLUS)).on('#', makeState(text.POUND)).on('?', makeState(text.QUERY)).on('/', makeState(text.SLASH)).on('_', makeState(text.UNDERSCORE)).on(':', makeState(text.COLON)).on('{', makeState(text.OPENBRACE)).on('[', makeState(text.OPENBRACKET)).on('<', makeState(text.OPENANGLEBRACKET)).on('(', makeState(text.OPENPAREN)).on('}', makeState(text.CLOSEBRACE)).on(']', makeState(text.CLOSEBRACKET)).on('>', makeState(text.CLOSEANGLEBRACKET)).on(')', makeState(text.CLOSEPAREN)).on('&', makeState(text.AMPERSAND)).on([',', ';', '!', '"', '\''], makeState(text.PUNCTUATION));

// Whitespace jumps
// Tokens of only non-newline whitespace are arbitrarily long
S_START.on('\n', makeState(text.NL)).on(WHITESPACE, S_WS);

// If any whitespace except newline, more whitespace!
S_WS.on(WHITESPACE, S_WS);

// Generates states for top-level domains
// Note that this is most accurate when tlds are in alphabetical order
for (var i = 0; i < tlds.length; i++) {
	var newStates = (0, state.stateify)(tlds[i], S_START, text.TLD, text.DOMAIN);
	domainStates.push.apply(domainStates, newStates);
}

// Collect the states generated by different protocls
var partialProtocolFileStates = (0, state.stateify)('file', S_START, text.DOMAIN, text.DOMAIN);
var partialProtocolFtpStates = (0, state.stateify)('ftp', S_START, text.DOMAIN, text.DOMAIN);
var partialProtocolHttpStates = (0, state.stateify)('http', S_START, text.DOMAIN, text.DOMAIN);
var partialProtocolMailtoStates = (0, state.stateify)('mailto', S_START, text.DOMAIN, text.DOMAIN);

// Add the states to the array of DOMAINeric states
domainStates.push.apply(domainStates, partialProtocolFileStates);
domainStates.push.apply(domainStates, partialProtocolFtpStates);
domainStates.push.apply(domainStates, partialProtocolHttpStates);
domainStates.push.apply(domainStates, partialProtocolMailtoStates);

// Protocol states
var S_PROTOCOL_FILE = partialProtocolFileStates.pop();
var S_PROTOCOL_FTP = partialProtocolFtpStates.pop();
var S_PROTOCOL_HTTP = partialProtocolHttpStates.pop();
var S_MAILTO = partialProtocolMailtoStates.pop();
var S_PROTOCOL_SECURE = makeState(text.DOMAIN);
var S_FULL_PROTOCOL = makeState(text.PROTOCOL); // Full protocol ends with COLON
var S_FULL_MAILTO = makeState(text.MAILTO); // Mailto ends with COLON

// Secure protocols (end with 's')
S_PROTOCOL_FTP.on('s', S_PROTOCOL_SECURE).on(':', S_FULL_PROTOCOL);

S_PROTOCOL_HTTP.on('s', S_PROTOCOL_SECURE).on(':', S_FULL_PROTOCOL);

domainStates.push(S_PROTOCOL_SECURE);

// Become protocol tokens after a COLON
S_PROTOCOL_FILE.on(':', S_FULL_PROTOCOL);
S_PROTOCOL_SECURE.on(':', S_FULL_PROTOCOL);
S_MAILTO.on(':', S_FULL_MAILTO);

// Localhost
var partialLocalhostStates = (0, state.stateify)('localhost', S_START, text.LOCALHOST, text.DOMAIN);
domainStates.push.apply(domainStates, partialLocalhostStates);

// Everything else
// DOMAINs make more DOMAINs
// Number and character transitions
S_START.on(NUMBERS, S_NUM);
S_NUM.on('-', S_DOMAIN_HYPHEN).on(NUMBERS, S_NUM).on(ALPHANUM, S_DOMAIN); // number becomes DOMAIN

S_DOMAIN.on('-', S_DOMAIN_HYPHEN).on(ALPHANUM, S_DOMAIN);

// All the generated states should have a jump to DOMAIN
for (var _i = 0; _i < domainStates.length; _i++) {
	domainStates[_i].on('-', S_DOMAIN_HYPHEN).on(ALPHANUM, S_DOMAIN);
}

S_DOMAIN_HYPHEN.on('-', S_DOMAIN_HYPHEN).on(NUMBERS, S_DOMAIN).on(ALPHANUM, S_DOMAIN);

// Set default transition
S_START.defaultTransition = makeState(text.SYM);

/**
	Given a string, returns an array of TOKEN instances representing the
	composition of that string.

	@method run
	@param {String} str Input string to scan
	@return {Array} Array of TOKEN instances
*/
var run = function run(str) {

	// The state machine only looks at lowercase strings.
	// This selective `toLowerCase` is used because lowercasing the entire
	// string causes the length and character position to vary in some in some
	// non-English strings. This happens only on V8-based runtimes.
	var lowerStr = str.replace(/[A-Z]/g, function (c) {
		return c.toLowerCase();
	});
	var len = str.length;
	var tokens = []; // return value

	var cursor = 0;

	// Tokenize the string
	while (cursor < len) {
		var state$$1 = S_START;
		var nextState = null;
		var tokenLength = 0;
		var latestAccepting = null;
		var sinceAccepts = -1;

		while (cursor < len && (nextState = state$$1.next(lowerStr[cursor]))) {
			state$$1 = nextState;

			// Keep track of the latest accepting state
			if (state$$1.accepts()) {
				sinceAccepts = 0;
				latestAccepting = state$$1;
			} else if (sinceAccepts >= 0) {
				sinceAccepts++;
			}

			tokenLength++;
			cursor++;
		}

		if (sinceAccepts < 0) {
			continue;
		} // Should never happen

		// Roll back to the latest accepting state
		cursor -= sinceAccepts;
		tokenLength -= sinceAccepts;

		// Get the class for the new token
		var TOKEN = latestAccepting.emit(); // Current token class

		// No more jumps, just make a new token
		tokens.push(new TOKEN(str.substr(cursor - tokenLength, tokenLength)));
	}

	return tokens;
};

var start = S_START;
exports.State = state.CharacterState;
exports.TOKENS = TOKENS;
exports.run = run;
exports.start = start;
});

unwrapExports$1(scanner);
var scanner_1 = scanner.start;
var scanner_2 = scanner.run;
var scanner_3 = scanner.TOKENS;
var scanner_4 = scanner.State;

var multi = createCommonjsModule$1(function (module, exports) {

exports.__esModule = true;
exports.URL = exports.TEXT = exports.NL = exports.EMAIL = exports.MAILTOEMAIL = exports.Base = undefined;







/******************************************************************************
	Multi-Tokens
	Tokens composed of arrays of TextTokens
******************************************************************************/

// Is the given token a valid domain token?
// Should nums be included here?
function isDomainToken(token) {
	return token instanceof text.DOMAIN || token instanceof text.TLD;
}

/**
	Abstract class used for manufacturing tokens of text tokens. That is rather
	than the value for a token being a small string of text, it's value an array
	of text tokens.

	Used for grouping together URLs, emails, hashtags, and other potential
	creations.

	@class MultiToken
	@abstract
*/
var MultiToken = (0, createTokenClass_1.createTokenClass)();

MultiToken.prototype = {
	/**
 	String representing the type for this token
 	@property type
 	@default 'TOKEN'
 */
	type: 'token',

	/**
 	Is this multitoken a link?
 	@property isLink
 	@default false
 */
	isLink: false,

	/**
 	Return the string this token represents.
 	@method toString
 	@return {String}
 */
	toString: function toString() {
		var result = [];
		for (var i = 0; i < this.v.length; i++) {
			result.push(this.v[i].toString());
		}
		return result.join('');
	},


	/**
 	What should the value for this token be in the `href` HTML attribute?
 	Returns the `.toString` value by default.
 		@method toHref
 	@return {String}
 */
	toHref: function toHref() {
		return this.toString();
	},


	/**
 	Returns a hash of relevant values for this token, which includes keys
 	* type - Kind of token ('url', 'email', etc.)
 	* value - Original text
 	* href - The value that should be added to the anchor tag's href
 		attribute
 		@method toObject
 	@param {String} [protocol] `'http'` by default
 	@return {Object}
 */
	toObject: function toObject() {
		var protocol = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'http';

		return {
			type: this.type,
			value: this.toString(),
			href: this.toHref(protocol)
		};
	}
};

/**
	Represents an arbitrarily mailto email address with the prefix included
	@class MAILTO
	@extends MultiToken
*/
var MAILTOEMAIL = (0, _class.inherits)(MultiToken, (0, createTokenClass_1.createTokenClass)(), {
	type: 'email',
	isLink: true
});

/**
	Represents a list of tokens making up a valid email address
	@class EMAIL
	@extends MultiToken
*/
var EMAIL = (0, _class.inherits)(MultiToken, (0, createTokenClass_1.createTokenClass)(), {
	type: 'email',
	isLink: true,
	toHref: function toHref() {
		return 'mailto:' + this.toString();
	}
});

/**
	Represents some plain text
	@class TEXT
	@extends MultiToken
*/
var TEXT = (0, _class.inherits)(MultiToken, (0, createTokenClass_1.createTokenClass)(), { type: 'text' });

/**
	Multi-linebreak token - represents a line break
	@class NL
	@extends MultiToken
*/
var NL = (0, _class.inherits)(MultiToken, (0, createTokenClass_1.createTokenClass)(), { type: 'nl' });

/**
	Represents a list of tokens making up a valid URL
	@class URL
	@extends MultiToken
*/
var URL = (0, _class.inherits)(MultiToken, (0, createTokenClass_1.createTokenClass)(), {
	type: 'url',
	isLink: true,

	/**
 	Lowercases relevant parts of the domain and adds the protocol if
 	required. Note that this will not escape unsafe HTML characters in the
 	URL.
 		@method href
 	@param {String} protocol
 	@return {String}
 */
	toHref: function toHref() {
		var protocol = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 'http';

		var hasProtocol = false;
		var hasSlashSlash = false;
		var tokens = this.v;
		var result = [];
		var i = 0;

		// Make the first part of the domain lowercase
		// Lowercase protocol
		while (tokens[i] instanceof text.PROTOCOL) {
			hasProtocol = true;
			result.push(tokens[i].toString().toLowerCase());
			i++;
		}

		// Skip slash-slash
		while (tokens[i] instanceof text.SLASH) {
			hasSlashSlash = true;
			result.push(tokens[i].toString());
			i++;
		}

		// Lowercase all other characters in the domain
		while (isDomainToken(tokens[i])) {
			result.push(tokens[i].toString().toLowerCase());
			i++;
		}

		// Leave all other characters as they were written
		for (; i < tokens.length; i++) {
			result.push(tokens[i].toString());
		}

		result = result.join('');

		if (!(hasProtocol || hasSlashSlash)) {
			result = protocol + '://' + result;
		}

		return result;
	},
	hasProtocol: function hasProtocol() {
		return this.v[0] instanceof text.PROTOCOL;
	}
});

exports.Base = MultiToken;
exports.MAILTOEMAIL = MAILTOEMAIL;
exports.EMAIL = EMAIL;
exports.NL = NL;
exports.TEXT = TEXT;
exports.URL = URL;
});

unwrapExports$1(multi);
var multi_1 = multi.URL;
var multi_2 = multi.TEXT;
var multi_3 = multi.NL;
var multi_4 = multi.EMAIL;
var multi_5 = multi.MAILTOEMAIL;
var multi_6 = multi.Base;

var parser$2 = createCommonjsModule$1(function (module, exports) {

exports.__esModule = true;
exports.start = exports.run = exports.TOKENS = exports.State = undefined;





var MULTI_TOKENS = _interopRequireWildcard(multi);



function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

/**
	Not exactly parser, more like the second-stage scanner (although we can
	theoretically hotswap the code here with a real parser in the future... but
	for a little URL-finding utility abstract syntax trees may be a little
	overkill).

	URL format: http://en.wikipedia.org/wiki/URI_scheme
	Email format: http://en.wikipedia.org/wiki/Email_address (links to RFC in
	reference)

	@module linkify
	@submodule parser
	@main parser
*/

var makeState = function makeState(tokenClass) {
	return new state.TokenState(tokenClass);
};

// The universal starting state.
var S_START = makeState();

// Intermediate states for URLs. Note that domains that begin with a protocol
// are treated slighly differently from those that don't.
var S_PROTOCOL = makeState(); // e.g., 'http:'
var S_MAILTO = makeState(); // 'mailto:'
var S_PROTOCOL_SLASH = makeState(); // e.g., '/', 'http:/''
var S_PROTOCOL_SLASH_SLASH = makeState(); // e.g., '//', 'http://'
var S_DOMAIN = makeState(); // parsed string ends with a potential domain name (A)
var S_DOMAIN_DOT = makeState(); // (A) domain followed by DOT
var S_TLD = makeState(multi.URL); // (A) Simplest possible URL with no query string
var S_TLD_COLON = makeState(); // (A) URL followed by colon (potential port number here)
var S_TLD_PORT = makeState(multi.URL); // TLD followed by a port number
var S_URL = makeState(multi.URL); // Long URL with optional port and maybe query string
var S_URL_NON_ACCEPTING = makeState(); // URL followed by some symbols (will not be part of the final URL)
var S_URL_OPENBRACE = makeState(); // URL followed by {
var S_URL_OPENBRACKET = makeState(); // URL followed by [
var S_URL_OPENANGLEBRACKET = makeState(); // URL followed by <
var S_URL_OPENPAREN = makeState(); // URL followed by (
var S_URL_OPENBRACE_Q = makeState(multi.URL); // URL followed by { and some symbols that the URL can end it
var S_URL_OPENBRACKET_Q = makeState(multi.URL); // URL followed by [ and some symbols that the URL can end it
var S_URL_OPENANGLEBRACKET_Q = makeState(multi.URL); // URL followed by < and some symbols that the URL can end it
var S_URL_OPENPAREN_Q = makeState(multi.URL); // URL followed by ( and some symbols that the URL can end it
var S_URL_OPENBRACE_SYMS = makeState(); // S_URL_OPENBRACE_Q followed by some symbols it cannot end it
var S_URL_OPENBRACKET_SYMS = makeState(); // S_URL_OPENBRACKET_Q followed by some symbols it cannot end it
var S_URL_OPENANGLEBRACKET_SYMS = makeState(); // S_URL_OPENANGLEBRACKET_Q followed by some symbols it cannot end it
var S_URL_OPENPAREN_SYMS = makeState(); // S_URL_OPENPAREN_Q followed by some symbols it cannot end it
var S_EMAIL_DOMAIN = makeState(); // parsed string starts with local email info + @ with a potential domain name (C)
var S_EMAIL_DOMAIN_DOT = makeState(); // (C) domain followed by DOT
var S_EMAIL = makeState(multi.EMAIL); // (C) Possible email address (could have more tlds)
var S_EMAIL_COLON = makeState(); // (C) URL followed by colon (potential port number here)
var S_EMAIL_PORT = makeState(multi.EMAIL); // (C) Email address with a port
var S_MAILTO_EMAIL = makeState(multi.MAILTOEMAIL); // Email that begins with the mailto prefix (D)
var S_MAILTO_EMAIL_NON_ACCEPTING = makeState(); // (D) Followed by some non-query string chars
var S_LOCALPART = makeState(); // Local part of the email address
var S_LOCALPART_AT = makeState(); // Local part of the email address plus @
var S_LOCALPART_DOT = makeState(); // Local part of the email address plus '.' (localpart cannot end in .)
var S_NL = makeState(multi.NL); // single new line

// Make path from start to protocol (with '//')
S_START.on(text.NL, S_NL).on(text.PROTOCOL, S_PROTOCOL).on(text.MAILTO, S_MAILTO).on(text.SLASH, S_PROTOCOL_SLASH);

S_PROTOCOL.on(text.SLASH, S_PROTOCOL_SLASH);
S_PROTOCOL_SLASH.on(text.SLASH, S_PROTOCOL_SLASH_SLASH);

// The very first potential domain name
S_START.on(text.TLD, S_DOMAIN).on(text.DOMAIN, S_DOMAIN).on(text.LOCALHOST, S_TLD).on(text.NUM, S_DOMAIN);

// Force URL for protocol followed by anything sane
S_PROTOCOL_SLASH_SLASH.on(text.TLD, S_URL).on(text.DOMAIN, S_URL).on(text.NUM, S_URL).on(text.LOCALHOST, S_URL);

// Account for dots and hyphens
// hyphens are usually parts of domain names
S_DOMAIN.on(text.DOT, S_DOMAIN_DOT);
S_EMAIL_DOMAIN.on(text.DOT, S_EMAIL_DOMAIN_DOT);

// Hyphen can jump back to a domain name

// After the first domain and a dot, we can find either a URL or another domain
S_DOMAIN_DOT.on(text.TLD, S_TLD).on(text.DOMAIN, S_DOMAIN).on(text.NUM, S_DOMAIN).on(text.LOCALHOST, S_DOMAIN);

S_EMAIL_DOMAIN_DOT.on(text.TLD, S_EMAIL).on(text.DOMAIN, S_EMAIL_DOMAIN).on(text.NUM, S_EMAIL_DOMAIN).on(text.LOCALHOST, S_EMAIL_DOMAIN);

// S_TLD accepts! But the URL could be longer, try to find a match greedily
// The `run` function should be able to "rollback" to the accepting state
S_TLD.on(text.DOT, S_DOMAIN_DOT);
S_EMAIL.on(text.DOT, S_EMAIL_DOMAIN_DOT);

// Become real URLs after `SLASH` or `COLON NUM SLASH`
// Here PSS and non-PSS converge
S_TLD.on(text.COLON, S_TLD_COLON).on(text.SLASH, S_URL);
S_TLD_COLON.on(text.NUM, S_TLD_PORT);
S_TLD_PORT.on(text.SLASH, S_URL);
S_EMAIL.on(text.COLON, S_EMAIL_COLON);
S_EMAIL_COLON.on(text.NUM, S_EMAIL_PORT);

// Types of characters the URL can definitely end in
var qsAccepting = [text.DOMAIN, text.AT, text.LOCALHOST, text.NUM, text.PLUS, text.POUND, text.PROTOCOL, text.SLASH, text.TLD, text.UNDERSCORE, text.SYM, text.AMPERSAND];

// Types of tokens that can follow a URL and be part of the query string
// but cannot be the very last characters
// Characters that cannot appear in the URL at all should be excluded
var qsNonAccepting = [text.COLON, text.DOT, text.QUERY, text.PUNCTUATION, text.CLOSEBRACE, text.CLOSEBRACKET, text.CLOSEANGLEBRACKET, text.CLOSEPAREN, text.OPENBRACE, text.OPENBRACKET, text.OPENANGLEBRACKET, text.OPENPAREN];

// These states are responsible primarily for determining whether or not to
// include the final round bracket.

// URL, followed by an opening bracket
S_URL.on(text.OPENBRACE, S_URL_OPENBRACE).on(text.OPENBRACKET, S_URL_OPENBRACKET).on(text.OPENANGLEBRACKET, S_URL_OPENANGLEBRACKET).on(text.OPENPAREN, S_URL_OPENPAREN);

// URL with extra symbols at the end, followed by an opening bracket
S_URL_NON_ACCEPTING.on(text.OPENBRACE, S_URL_OPENBRACE).on(text.OPENBRACKET, S_URL_OPENBRACKET).on(text.OPENANGLEBRACKET, S_URL_OPENANGLEBRACKET).on(text.OPENPAREN, S_URL_OPENPAREN);

// Closing bracket component. This character WILL be included in the URL
S_URL_OPENBRACE.on(text.CLOSEBRACE, S_URL);
S_URL_OPENBRACKET.on(text.CLOSEBRACKET, S_URL);
S_URL_OPENANGLEBRACKET.on(text.CLOSEANGLEBRACKET, S_URL);
S_URL_OPENPAREN.on(text.CLOSEPAREN, S_URL);
S_URL_OPENBRACE_Q.on(text.CLOSEBRACE, S_URL);
S_URL_OPENBRACKET_Q.on(text.CLOSEBRACKET, S_URL);
S_URL_OPENANGLEBRACKET_Q.on(text.CLOSEANGLEBRACKET, S_URL);
S_URL_OPENPAREN_Q.on(text.CLOSEPAREN, S_URL);
S_URL_OPENBRACE_SYMS.on(text.CLOSEBRACE, S_URL);
S_URL_OPENBRACKET_SYMS.on(text.CLOSEBRACKET, S_URL);
S_URL_OPENANGLEBRACKET_SYMS.on(text.CLOSEANGLEBRACKET, S_URL);
S_URL_OPENPAREN_SYMS.on(text.CLOSEPAREN, S_URL);

// URL that beings with an opening bracket, followed by a symbols.
// Note that the final state can still be `S_URL_OPENBRACE_Q` (if the URL only
// has a single opening bracket for some reason).
S_URL_OPENBRACE.on(qsAccepting, S_URL_OPENBRACE_Q);
S_URL_OPENBRACKET.on(qsAccepting, S_URL_OPENBRACKET_Q);
S_URL_OPENANGLEBRACKET.on(qsAccepting, S_URL_OPENANGLEBRACKET_Q);
S_URL_OPENPAREN.on(qsAccepting, S_URL_OPENPAREN_Q);
S_URL_OPENBRACE.on(qsNonAccepting, S_URL_OPENBRACE_SYMS);
S_URL_OPENBRACKET.on(qsNonAccepting, S_URL_OPENBRACKET_SYMS);
S_URL_OPENANGLEBRACKET.on(qsNonAccepting, S_URL_OPENANGLEBRACKET_SYMS);
S_URL_OPENPAREN.on(qsNonAccepting, S_URL_OPENPAREN_SYMS);

// URL that begins with an opening bracket, followed by some symbols
S_URL_OPENBRACE_Q.on(qsAccepting, S_URL_OPENBRACE_Q);
S_URL_OPENBRACKET_Q.on(qsAccepting, S_URL_OPENBRACKET_Q);
S_URL_OPENANGLEBRACKET_Q.on(qsAccepting, S_URL_OPENANGLEBRACKET_Q);
S_URL_OPENPAREN_Q.on(qsAccepting, S_URL_OPENPAREN_Q);
S_URL_OPENBRACE_Q.on(qsNonAccepting, S_URL_OPENBRACE_Q);
S_URL_OPENBRACKET_Q.on(qsNonAccepting, S_URL_OPENBRACKET_Q);
S_URL_OPENANGLEBRACKET_Q.on(qsNonAccepting, S_URL_OPENANGLEBRACKET_Q);
S_URL_OPENPAREN_Q.on(qsNonAccepting, S_URL_OPENPAREN_Q);

S_URL_OPENBRACE_SYMS.on(qsAccepting, S_URL_OPENBRACE_Q);
S_URL_OPENBRACKET_SYMS.on(qsAccepting, S_URL_OPENBRACKET_Q);
S_URL_OPENANGLEBRACKET_SYMS.on(qsAccepting, S_URL_OPENANGLEBRACKET_Q);
S_URL_OPENPAREN_SYMS.on(qsAccepting, S_URL_OPENPAREN_Q);
S_URL_OPENBRACE_SYMS.on(qsNonAccepting, S_URL_OPENBRACE_SYMS);
S_URL_OPENBRACKET_SYMS.on(qsNonAccepting, S_URL_OPENBRACKET_SYMS);
S_URL_OPENANGLEBRACKET_SYMS.on(qsNonAccepting, S_URL_OPENANGLEBRACKET_SYMS);
S_URL_OPENPAREN_SYMS.on(qsNonAccepting, S_URL_OPENPAREN_SYMS);

// Account for the query string
S_URL.on(qsAccepting, S_URL);
S_URL_NON_ACCEPTING.on(qsAccepting, S_URL);

S_URL.on(qsNonAccepting, S_URL_NON_ACCEPTING);
S_URL_NON_ACCEPTING.on(qsNonAccepting, S_URL_NON_ACCEPTING);

// Email address-specific state definitions
// Note: We are not allowing '/' in email addresses since this would interfere
// with real URLs

// For addresses with the mailto prefix
// 'mailto:' followed by anything sane is a valid email
S_MAILTO.on(text.TLD, S_MAILTO_EMAIL).on(text.DOMAIN, S_MAILTO_EMAIL).on(text.NUM, S_MAILTO_EMAIL).on(text.LOCALHOST, S_MAILTO_EMAIL);

// Greedily get more potential valid email values
S_MAILTO_EMAIL.on(qsAccepting, S_MAILTO_EMAIL).on(qsNonAccepting, S_MAILTO_EMAIL_NON_ACCEPTING);
S_MAILTO_EMAIL_NON_ACCEPTING.on(qsAccepting, S_MAILTO_EMAIL).on(qsNonAccepting, S_MAILTO_EMAIL_NON_ACCEPTING);

// For addresses without the mailto prefix
// Tokens allowed in the localpart of the email
var localpartAccepting = [text.DOMAIN, text.NUM, text.PLUS, text.POUND, text.QUERY, text.UNDERSCORE, text.SYM, text.AMPERSAND, text.TLD];

// Some of the tokens in `localpartAccepting` are already accounted for here and
// will not be overwritten (don't worry)
S_DOMAIN.on(localpartAccepting, S_LOCALPART).on(text.AT, S_LOCALPART_AT);
S_TLD.on(localpartAccepting, S_LOCALPART).on(text.AT, S_LOCALPART_AT);
S_DOMAIN_DOT.on(localpartAccepting, S_LOCALPART);

// Okay we're on a localpart. Now what?
// TODO: IP addresses and what if the email starts with numbers?
S_LOCALPART.on(localpartAccepting, S_LOCALPART).on(text.AT, S_LOCALPART_AT) // close to an email address now
.on(text.DOT, S_LOCALPART_DOT);
S_LOCALPART_DOT.on(localpartAccepting, S_LOCALPART);
S_LOCALPART_AT.on(text.TLD, S_EMAIL_DOMAIN).on(text.DOMAIN, S_EMAIL_DOMAIN).on(text.LOCALHOST, S_EMAIL);
// States following `@` defined above

var run = function run(tokens) {
	var len = tokens.length;
	var cursor = 0;
	var multis = [];
	var textTokens = [];

	while (cursor < len) {
		var state$$1 = S_START;
		var secondState = null;
		var nextState = null;
		var multiLength = 0;
		var latestAccepting = null;
		var sinceAccepts = -1;

		while (cursor < len && !(secondState = state$$1.next(tokens[cursor]))) {
			// Starting tokens with nowhere to jump to.
			// Consider these to be just plain text
			textTokens.push(tokens[cursor++]);
		}

		while (cursor < len && (nextState = secondState || state$$1.next(tokens[cursor]))) {

			// Get the next state
			secondState = null;
			state$$1 = nextState;

			// Keep track of the latest accepting state
			if (state$$1.accepts()) {
				sinceAccepts = 0;
				latestAccepting = state$$1;
			} else if (sinceAccepts >= 0) {
				sinceAccepts++;
			}

			cursor++;
			multiLength++;
		}

		if (sinceAccepts < 0) {

			// No accepting state was found, part of a regular text token
			// Add all the tokens we looked at to the text tokens array
			for (var i = cursor - multiLength; i < cursor; i++) {
				textTokens.push(tokens[i]);
			}
		} else {

			// Accepting state!

			// First close off the textTokens (if available)
			if (textTokens.length > 0) {
				multis.push(new multi.TEXT(textTokens));
				textTokens = [];
			}

			// Roll back to the latest accepting state
			cursor -= sinceAccepts;
			multiLength -= sinceAccepts;

			// Create a new multitoken
			var MULTI = latestAccepting.emit();
			multis.push(new MULTI(tokens.slice(cursor - multiLength, cursor)));
		}
	}

	// Finally close off the textTokens (if available)
	if (textTokens.length > 0) {
		multis.push(new multi.TEXT(textTokens));
	}

	return multis;
};

exports.State = state.TokenState;
exports.TOKENS = MULTI_TOKENS;
exports.run = run;
exports.start = S_START;
});

unwrapExports$1(parser$2);
var parser_1 = parser$2.start;
var parser_2 = parser$2.run;
var parser_3 = parser$2.TOKENS;
var parser_4 = parser$2.State;

var linkify = createCommonjsModule$1(function (module, exports) {

exports.__esModule = true;
exports.tokenize = exports.test = exports.scanner = exports.parser = exports.options = exports.inherits = exports.find = undefined;





var options$$1 = _interopRequireWildcard(options);



var scanner$$1 = _interopRequireWildcard(scanner);



var parser = _interopRequireWildcard(parser$2);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

if (!Array.isArray) {
	Array.isArray = function (arg) {
		return Object.prototype.toString.call(arg) === '[object Array]';
	};
}

/**
	Converts a string into tokens that represent linkable and non-linkable bits
	@method tokenize
	@param {String} str
	@return {Array} tokens
*/
var tokenize = function tokenize(str) {
	return parser.run(scanner$$1.run(str));
};

/**
	Returns a list of linkable items in the given string.
*/
var find = function find(str) {
	var type = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

	var tokens = tokenize(str);
	var filtered = [];

	for (var i = 0; i < tokens.length; i++) {
		var token = tokens[i];
		if (token.isLink && (!type || token.type === type)) {
			filtered.push(token.toObject());
		}
	}

	return filtered;
};

/**
	Is the given string valid linkable text of some sort
	Note that this does not trim the text for you.

	Optionally pass in a second `type` param, which is the type of link to test
	for.

	For example,

		test(str, 'email');

	Will return `true` if str is a valid email.
*/
var test = function test(str) {
	var type = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : null;

	var tokens = tokenize(str);
	return tokens.length === 1 && tokens[0].isLink && (!type || tokens[0].type === type);
};

// Scanner and parser provide states and tokens for the lexicographic stage
// (will be used to add additional link types)
exports.find = find;
exports.inherits = _class.inherits;
exports.options = options$$1;
exports.parser = parser;
exports.scanner = scanner$$1;
exports.test = test;
exports.tokenize = tokenize;
});

unwrapExports$1(linkify);
var linkify_1 = linkify.tokenize;
var linkify_2 = linkify.test;
var linkify_3 = linkify.scanner;
var linkify_4 = linkify.parser;
var linkify_5 = linkify.options;
var linkify_6 = linkify.inherits;
var linkify_7 = linkify.find;

var linkifyHtml_1 = createCommonjsModule$1(function (module, exports) {

exports.__esModule = true;
exports.default = linkifyHtml;



var _simpleHtmlTokenizer2 = _interopRequireDefault(simpleHtmlTokenizer);



var linkify$$1 = _interopRequireWildcard(linkify);

function _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var options = linkify$$1.options;
var Options = options.Options;


var StartTag = 'StartTag';
var EndTag = 'EndTag';
var Chars = 'Chars';
var Comment = 'Comment';

/**
	`tokens` and `token` in this section refer to tokens generated by the HTML
	parser.
*/
function linkifyHtml(str) {
	var opts = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

	var tokens = _simpleHtmlTokenizer2.default.tokenize(str);
	var linkifiedTokens = [];
	var linkified = [];
	var i;

	opts = new Options(opts);

	// Linkify the tokens given by the parser
	for (i = 0; i < tokens.length; i++) {
		var token = tokens[i];

		if (token.type === StartTag) {
			linkifiedTokens.push(token);

			// Ignore all the contents of ignored tags
			var tagName = token.tagName.toUpperCase();
			var isIgnored = tagName === 'A' || options.contains(opts.ignoreTags, tagName);
			if (!isIgnored) {
				continue;
			}

			var preskipLen = linkifiedTokens.length;
			skipTagTokens(tagName, tokens, ++i, linkifiedTokens);
			i += linkifiedTokens.length - preskipLen - 1;
			continue;
		} else if (token.type !== Chars) {
			// Skip this token, it's not important
			linkifiedTokens.push(token);
			continue;
		}

		// Valid text token, linkify it!
		var linkifedChars = linkifyChars(token.chars, opts);
		linkifiedTokens.push.apply(linkifiedTokens, linkifedChars);
	}

	// Convert the tokens back into a string
	for (i = 0; i < linkifiedTokens.length; i++) {
		var _token = linkifiedTokens[i];
		switch (_token.type) {
			case StartTag:
				{
					var link = '<' + _token.tagName;
					if (_token.attributes.length > 0) {
						var attrs = attrsToStrings(_token.attributes);
						link += ' ' + attrs.join(' ');
					}
					link += '>';
					linkified.push(link);
					break;
				}
			case EndTag:
				linkified.push('</' + _token.tagName + '>');
				break;
			case Chars:
				linkified.push(escapeText(_token.chars));
				break;
			case Comment:
				linkified.push('<!--' + escapeText(_token.chars) + '-->');
				break;
		}
	}

	return linkified.join('');
}

/**
	`tokens` and `token` in this section referes to tokens returned by
	`linkify.tokenize`. `linkified` will contain HTML Parser-style tokens
*/
function linkifyChars(str, opts) {
	var tokens = linkify$$1.tokenize(str);
	var result = [];

	for (var i = 0; i < tokens.length; i++) {
		var token = tokens[i];

		if (token.type === 'nl' && opts.nl2br) {
			result.push({
				type: StartTag,
				tagName: 'br',
				attributes: [],
				selfClosing: true
			});
			continue;
		} else if (!token.isLink || !opts.check(token)) {
			result.push({ type: Chars, chars: token.toString() });
			continue;
		}

		var _opts$resolve = opts.resolve(token),
		    formatted = _opts$resolve.formatted,
		    formattedHref = _opts$resolve.formattedHref,
		    tagName = _opts$resolve.tagName,
		    className = _opts$resolve.className,
		    target = _opts$resolve.target,
		    attributes = _opts$resolve.attributes;

		// Build up attributes


		var attributeArray = [['href', formattedHref]];

		if (className) {
			attributeArray.push(['class', className]);
		}

		if (target) {
			attributeArray.push(['target', target]);
		}

		for (var attr in attributes) {
			attributeArray.push([attr, attributes[attr]]);
		}

		// Add the required tokens
		result.push({
			type: StartTag,
			tagName: tagName,
			attributes: attributeArray,
			selfClosing: false
		});
		result.push({ type: Chars, chars: formatted });
		result.push({ type: EndTag, tagName: tagName });
	}

	return result;
}

/**
	Returns a list of tokens skipped until the closing tag of tagName.

	* `tagName` is the closing tag which will prompt us to stop skipping
	* `tokens` is the array of tokens generated by HTML5Tokenizer which
	* `i` is the index immediately after the opening tag to skip
	* `skippedTokens` is an array which skipped tokens are being pushed into

	Caveats

	* Assumes that i is the first token after the given opening tagName
	* The closing tag will be skipped, but nothing after it
	* Will track whether there is a nested tag of the same type
*/
function skipTagTokens(tagName, tokens, i, skippedTokens) {

	// number of tokens of this type on the [fictional] stack
	var stackCount = 1;

	while (i < tokens.length && stackCount > 0) {
		var token = tokens[i];

		if (token.type === StartTag && token.tagName.toUpperCase() === tagName) {
			// Nested tag of the same type, "add to stack"
			stackCount++;
		} else if (token.type === EndTag && token.tagName.toUpperCase() === tagName) {
			// Closing tag
			stackCount--;
		}

		skippedTokens.push(token);
		i++;
	}

	// Note that if stackCount > 0 here, the HTML is probably invalid
	return skippedTokens;
}

function escapeText(text) {
	// Not required, HTML tokenizer ensures this occurs properly
	return text;
}

function escapeAttr(attr) {
	return attr.replace(/"/g, '&quot;');
}

function attrsToStrings(attrs) {
	var attrStrs = [];
	for (var i = 0; i < attrs.length; i++) {
		var _attrs$i = attrs[i],
		    name = _attrs$i[0],
		    value = _attrs$i[1];

		attrStrs.push(name + '="' + escapeAttr(value) + '"');
	}
	return attrStrs;
}
});

unwrapExports$1(linkifyHtml_1);

var html = linkifyHtml_1.default;

var regExpXss = /<a\s+(?:[^>]*?\s+)?href=("|')(javascript|data)(.*?)>(.*)<\/a>/gim;

function createLinks(text) {
	var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
	    linkWrapClass = _ref.linkWrapClass,
	    bcc = _ref.bcc,
	    _ref$noEscape = _ref.noEscape,
	    noEscape = _ref$noEscape === undefined ? false : _ref$noEscape,
	    _ref$urlsOnly = _ref.urlsOnly,
	    urlsOnly = _ref$urlsOnly === undefined ? false : _ref$urlsOnly,
	    _ref$fullUrlsOnly = _ref.fullUrlsOnly,
	    fullUrlsOnly = _ref$fullUrlsOnly === undefined ? false : _ref$fullUrlsOnly,
	    _ref$openEmailsInNewT = _ref.openEmailsInNewTab,
	    openEmailsInNewTab = _ref$openEmailsInNewT === undefined ? false : _ref$openEmailsInNewT,
	    _ref$openLinksInNewTa = _ref.openLinksInNewTab,
	    openLinksInNewTab = _ref$openLinksInNewTa === undefined ? false : _ref$openLinksInNewTa,
	    _ref$defaultProtocol = _ref.defaultProtocol,
	    defaultProtocol = _ref$defaultProtocol === undefined ? 'http' : _ref$defaultProtocol;

	if (!lodash_isstring(text)) {
		return;
	}

	if (regExpXss.test(text)) {
		// Replace found in html <a href XSS with link text
		text = text.replace(regExpXss, '$4');
	}

	if (!noEscape) {
		var wrapper = document.createElement('div');

		wrapper.textContent = text;
		text = wrapper.innerHTML;
	}

	return html(text, {
		defaultProtocol: defaultProtocol,
		attributes: function attributes() {
			if (openLinksInNewTab || openEmailsInNewTab) {
				return {
					rel: 'noopener noreferrer'
				};
			}

			return null;
		},

		target: {
			url: function url() {
				if (openLinksInNewTab) {
					return '_blank';
				}

				return null;
			},
			email: function email() {
				if (openEmailsInNewTab) {
					return '_blank';
				}

				return null;
			}
		},
		className: linkWrapClass || '',
		formatHref: {
			email: function email(href) {
				if (lodash_isstring(bcc)) {
					return href + '?bcc=' + encodeURIComponent(bcc);
				}

				return href;
			}
		},
		validate: {
			url: function url(value) {
				return !(fullUrlsOnly && !/^((http|ftp)s?:\/\/|www\.)/.test(value));
			},
			email: function email() {
				return !urlsOnly;
			}
		}
	});
}

var tableAttributesToReplace = [{
	selector: 'table[border]',
	attribute: 'border',
	style: {
		key: 'border',
		unit: 'px',
		appliesToSelf: true,
		appliesToCells: true,
		preventOverriding: true,
		properties: [{
			key: 'borderWidth'
		}, {
			key: 'borderColor',
			default: 'gray'
		}, {
			key: 'borderStyle',
			default: 'solid'
		}]
	}
}, {
	selector: 'table[cellpadding]',
	attribute: 'cellpadding',
	style: {
		key: 'padding',
		unit: 'px',
		appliesToCells: true,
		properties: [{
			key: 'paddingLeft'
		}, {
			key: 'paddingRight'
		}, {
			key: 'paddingTop'
		}, {
			key: 'paddingBottom'
		}]
	}
}, {
	selector: 'table[cellspacing]',
	attribute: 'cellspacing',
	style: { key: 'border-spacing', unit: 'px', appliesToSelf: true }
}];
var tablesSelector = tableAttributesToReplace.map(function (attr) {
	return attr.selector;
}).join(', ');

function replaceTableAttributes(html) {
	var parser = new DOMParser();
	var parsedHtml = parser.parseFromString(html, 'text/html');
	var wrapper = parsedHtml.body;

	if (!wrapper.querySelectorAll(tablesSelector).length) {
		return html;
	}

	tableAttributesToReplace.forEach(function (attr) {
		return replaceTableAttributeWithStyle(wrapper, attr);
	});

	return wrapper.innerHTML;
}

function applyAdditionalStyles(element, style, styleValue) {
	var key = style.key,
	    properties = style.properties,
	    preventOverriding = style.preventOverriding;


	if (!properties) {
		element.style[key] = styleValue;

		return;
	}

	if (preventOverriding && properties.find(function (property) {
		return element.style[property.key];
	})) {
		return;
	}

	properties.forEach(function (property) {
		if (!element.style[property.key]) {
			element.style[property.key] = property.default ? property.default : styleValue;
		}
	});
}

function replaceTableAttributeWithStyle(wrapper, _ref) {
	var selector = _ref.selector,
	    attribute = _ref.attribute,
	    style = _ref.style;

	var tables = wrapper.querySelectorAll(selector);

	if (!tables.length) {
		return;
	}

	tables.forEach(function (table) {
		var key = style.key,
		    unit = style.unit,
		    appliesToSelf = style.appliesToSelf,
		    appliesToCells = style.appliesToCells;

		var attributeValue = table.attributes[attribute].value;
		var styleValue = parseInt(attributeValue, 10) ? '' + attributeValue + unit : 0;

		if (appliesToSelf && !table.style[key]) {
			applyAdditionalStyles(table, style, styleValue);
		}

		if (appliesToCells) {
			applyStylesToTableCells(wrapper, table, style, styleValue);
		}

		table.removeAttribute(attribute);
	});
}

function applyStylesToTableCells(wrapper, table, style, styleValue) {
	var tableId = 'table-' + new Date().getTime();

	table.id = tableId;
	wrapper.querySelectorAll('#' + tableId + ' > thead > tr > th, #' + tableId + ' > tbody > tr > td').forEach(function (cell) {
		if (!cell.style[style.key]) {
			applyAdditionalStyles(cell, style, styleValue);
		}
	});
	table.removeAttribute('id');
}

var pdxss = new lib$1.FilterXSS({
	whiteList: {
		a: ['style', 'class', 'href', 'title', 'target', 'rel', 'name'],
		img: ['style', 'class', 'src', 'alt', 'width', 'height', 'align'],
		div: ['style', 'class', 'align', 'dir'],
		span: ['style', 'class'],
		center: ['style', 'class'],
		p: ['style', 'class', 'align'],
		strong: ['style', 'class'],
		b: ['style', 'class'],
		u: ['style', 'class'],
		i: ['style', 'class'],
		em: ['style', 'class'],
		blockquote: ['style', 'class'],
		code: ['style', 'class'],
		pre: ['style', 'class', 'width'],
		hr: ['style', 'class', 'align', 'width'],
		h1: ['style', 'class', 'align'],
		h2: ['style', 'class', 'align'],
		h3: ['style', 'class', 'align'],
		h4: ['style', 'class', 'align'],
		h5: ['style', 'class', 'align'],
		h6: ['style', 'class', 'align'],
		br: [],
		ul: ['style', 'class', 'type'],
		ol: ['style', 'class'],
		li: ['style', 'class', 'type', 'value'],
		table: ['style', 'class', 'cellpadding', 'cellspacing', 'bgcolor', 'width'],
		tbody: ['style', 'class'],
		thead: ['style', 'class'],
		tfoot: ['style', 'class'],
		td: ['style', 'class', 'colspan', 'rowspan', 'align', 'bgcolor', 'width', 'height', 'valign'],
		tr: ['style', 'class'],
		th: ['style', 'class', 'colspan', 'rowspan', 'align', 'bgcolor', 'width', 'height', 'valign'],
		colgroup: ['style', 'class', 'align', 'valign', 'width'],
		col: ['style', 'class', 'align', 'valign', 'width'],
		font: ['style', 'class', 'color', 'face', 'size'],
		style: ['type']
	},
	onTagAttr: function onTagAttr(tag, name, value) {
		var anyLink = new RegExp('^(?!(data|javascript))([a-zA-Z]*:)', 'i');

		// Allow images that have cid: as URL
		if (tag === 'img' && name === 'src' && value.substr(0, 4) === 'cid:') {
			return name + '="' + lib$1.escapeAttrValue(value) + '"';
		}

		// Allow custom links like quotewerks://opendocument
		if (tag === 'a' && name === 'href' && value.match(anyLink)) {
			return name + '="' + lib$1.escapeAttrValue(value) + '"';
		}
	},
	// Allow data attributes
	onIgnoreTagAttr: function onIgnoreTagAttr(tag, name, value) {
		if (name.substr(0, 5) === 'data-') {
			// escape its value using built-in escapeAttrValue function
			return name + '="' + lib$1.escapeAttrValue(value) + '"';
		}
	},
	stripIgnoreTag: true
});

function sanitizeHtml(html) {
	var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
	    _ref$loose = _ref.loose,
	    loose = _ref$loose === undefined ? false : _ref$loose,
	    _ref$removeStyle = _ref.removeStyle,
	    removeStyle = _ref$removeStyle === undefined ? false : _ref$removeStyle,
	    _ref$replaceLinks = _ref.replaceLinks,
	    replaceLinks = _ref$replaceLinks === undefined ? false : _ref$replaceLinks,
	    _ref$fullUrlsOnly = _ref.fullUrlsOnly,
	    fullUrlsOnly = _ref$fullUrlsOnly === undefined ? false : _ref$fullUrlsOnly,
	    _ref$openLinksInNewTa = _ref.openLinksInNewTab,
	    openLinksInNewTab = _ref$openLinksInNewTa === undefined ? true : _ref$openLinksInNewTa;

	if (replaceLinks) {
		html = createLinks(html, {
			noEscape: true,
			urlsOnly: true,
			fullUrlsOnly: fullUrlsOnly,
			openLinksInNewTab: openLinksInNewTab
		});
	}

	if (!removeStyle) {
		html = replaceTableAttributes(html);
	}

	html = pdxss.process(html);

	var wrapper = document.createElement('div');

	wrapper.innerHTML = html;

	var anchorTags = wrapper.querySelectorAll('a[target*="_blank"]');

	anchorTags.forEach(function (anchorTag) {
		var relValue = anchorTag.getAttribute('rel') || '';

		if (relValue.search('noopener') < 0) {
			relValue += ' noopener';
		}

		if (relValue.search('noreferrer') < 0) {
			relValue += ' noreferrer';
		}

		anchorTag.setAttribute('rel', relValue);
	});

	if (!loose) {
		wrapper.querySelectorAll('*').forEach(function (element) {
			return element.removeAttribute('class');
		});

		wrapper.querySelectorAll('style').forEach(function (styleElement) {
			return styleElement.remove();
		});
	}

	if (removeStyle) {
		wrapper.querySelectorAll('*').forEach(function (element) {
			return element.removeAttribute('style');
		});
	}

	html = wrapper.innerHTML;
	wrapper.remove();

	return html;
}

var _extends_1 = createCommonjsModule(function (module) {
function _extends() {
  module.exports = _extends = Object.assign || function (target) {
    for (var i = 1; i < arguments.length; i++) {
      var source = arguments[i];

      for (var key in source) {
        if (Object.prototype.hasOwnProperty.call(source, key)) {
          target[key] = source[key];
        }
      }
    }

    return target;
  };

  return _extends.apply(this, arguments);
}

module.exports = _extends;
});

var Toolbar = function Toolbar(_ref) {
  var children = _ref.children,
      _ref$activeButtons = _ref.activeButtons,
      activeButtons = _ref$activeButtons === void 0 ? [] : _ref$activeButtons;
  var translator = Bi();
  var buttons = [{
    type: 'bold',
    tooltipText: translator.gettext('Bold'),
    icon: 'bold'
  }, {
    type: 'italic',
    tooltipText: translator.gettext('Italic')
  }, {
    type: 'underline',
    tooltipText: translator.gettext('Underline'),
    icon: 'underline'
  }, {
    type: 'link',
    tooltipText: translator.gettext('Link'),
    icon: 'link'
  }, {
    type: 'ul',
    tooltipText: translator.gettext('Unordered list'),
    icon: 'list-bulleted'
  }, {
    type: 'ol',
    tooltipText: translator.gettext('Ordered list'),
    icon: 'list-numbered'
  }, {
    type: 'remove',
    tooltipText: translator.gettext('Remove style'),
    icon: 'clearformat'
  }];
  return /*#__PURE__*/React__default['default'].createElement(React__default['default'].Fragment, null, /*#__PURE__*/React__default['default'].createElement(PdWysiwyg.ToolbarButtonGroup, null, buttons.map(function (props) {
    return /*#__PURE__*/React__default['default'].createElement(PdWysiwyg.ToolbarButton, _extends_1({}, props, {
      size: "s",
      key: props.type,
      active: activeButtons.includes(props.type)
    }));
  })), children);
};

var isError = function isError() {
  var error = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};
  return 'message' in error;
};

function useAsync(loader, _ref) {
  var _ref$immediate = _ref.immediate,
      immediate = _ref$immediate === void 0 ? true : _ref$immediate,
      logger = _ref.logger,
      onSuccess = _ref.onSuccess;

  var _useState = React.useState(false),
      _useState2 = slicedToArray(_useState, 2),
      loading = _useState2[0],
      setLoading = _useState2[1];

  var _useState3 = React.useState(null),
      _useState4 = slicedToArray(_useState3, 2),
      response = _useState4[0],
      setResponse = _useState4[1];

  var _useState5 = React.useState(),
      _useState6 = slicedToArray(_useState5, 2),
      setError = _useState6[1];

  var _useState7 = React.useState(immediate),
      _useState8 = slicedToArray(_useState7, 2),
      fetchingEnabled = _useState8[0],
      setFetchingEnabled = _useState8[1];

  function logError(error) {
    if (isError(error)) {
      // error.message will be same as caughtErrorMessage, but we have nothing else
      logger === null || logger === void 0 ? void 0 : logger.error(error.message, error, {
        triggeredBy: 'useFetch hook'
      });
    } else if (typeof error === 'string') {
      logger === null || logger === void 0 ? void 0 : logger.error(error, null, {
        triggeredBy: 'useFetch hook'
      });
    }
  }

  React.useEffect(function () {
    if (!fetchingEnabled) {
      return;
    }

    setLoading(true);
    var didCancel = false;

    var fetchData = /*#__PURE__*/function () {
      var _ref2 = asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {
        var res;
        return regeneratorRuntime.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                _context.prev = 0;
                _context.next = 3;
                return loader();

              case 3:
                res = _context.sent;

                if (!didCancel) {
                  onSuccess === null || onSuccess === void 0 ? void 0 : onSuccess(res);
                  setResponse(function () {
                    return res;
                  });
                }

                _context.next = 10;
                break;

              case 7:
                _context.prev = 7;
                _context.t0 = _context["catch"](0);

                if (!didCancel) {
                  logError(_context.t0); // https://github.com/facebook/react/issues/14981#issuecomment-468460187

                  setError(function () {
                    throw _context.t0;
                  });
                }

              case 10:
                _context.prev = 10;

                if (!didCancel) {
                  setLoading(false);
                }

                return _context.finish(10);

              case 13:
              case "end":
                return _context.stop();
            }
          }
        }, _callee, null, [[0, 7, 10, 13]]);
      }));

      return function fetchData() {
        return _ref2.apply(this, arguments);
      };
    }();

    fetchData();
    return function () {
      didCancel = true;
    };
  }, [fetchingEnabled]);
  var execute = React.useCallback(function () {
    setFetchingEnabled(true);
  }, []);
  return {
    execute: execute,
    loading: loading,
    response: response
  };
}

var LoggerContext = /*#__PURE__*/React__default['default'].createContext(null);
var LoggerProvider = function LoggerProvider(_ref) {
  var logger = _ref.logger,
      children = _ref.children;
  return /*#__PURE__*/React__default['default'].createElement(LoggerContext.Provider, {
    value: logger
  }, children);
};
LoggerProvider.displayName = "LoggerProvider";
// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types
function useLogger() {
  var logger = React.useContext(LoggerContext);

  if (logger == null) {
    throw new Error('useLogger must be used within a LoggerProvider');
  }

  return logger;
}

function _templateObject2$3() {
  var data = taggedTemplateLiteral(["\n\tmargin-left: 8px;\n"]);

  _templateObject2$3 = function _templateObject2() {
    return data;
  };

  return data;
}

function _templateObject$3() {
  var data = taggedTemplateLiteral(["\n\t& .bodyEditor {\n\t\tpadding: 0 0 16px;\n\t}\n\n\t& .editorToolbar {\n\t\tpadding: 0;\n\t\tborder: none;\n\t\tbackground: none;\n\t\tjustify-content: space-between;\n\t}\n"]);

  _templateObject$3 = function _templateObject() {
    return data;
  };

  return data;
}
var Wysiwyg = styled__default['default'](PdWysiwyg.ReactPdWysiwyg)(_templateObject$3());
var SaveButton = styled__default['default'](conventionUiReact.Button)(_templateObject2$3());

var ActionButtons = function ActionButtons(_ref) {
  var onCancel = _ref.onCancel,
      onSave = _ref.onSave;

  var _useState = React.useState(false),
      _useState2 = slicedToArray(_useState, 2),
      isLoading = _useState2[0],
      setIsLoading = _useState2[1];

  var translator = Bi();
  var logger = useLogger();

  var _useAsync = useAsync(function () {
    return onSave();
  }, {
    immediate: false,
    logger: logger,
    onSuccess: function onSuccess() {
      setIsLoading(false);
    }
  }),
      save = _useAsync.execute;

  var onSaveHandler = function onSaveHandler() {
    setIsLoading(true);
    save();
  };

  return /*#__PURE__*/React__default['default'].createElement("div", null, /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Button, {
    size: "s",
    onClick: onCancel
  }, translator.gettext('Cancel')), /*#__PURE__*/React__default['default'].createElement(SaveButton, {
    color: "green",
    onClick: onSaveHandler,
    size: "s",
    loading: isLoading
  }, translator.gettext('Save')));
};
ActionButtons.displayName = "ActionButtons";

var WysiwygEditor = function WysiwygEditor(_ref) {
  var note = _ref.note,
      onToggleEditNoteClick = _ref.onToggleEditNoteClick,
      onSaveNoteClick = _ref.onSaveNoteClick;
  var translator = Bi();
  var wysiwygRef = React.useRef(null);

  var onSaveClick = /*#__PURE__*/function () {
    var _ref2 = asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {
      var _wysiwygRef$current$g, _wysiwygRef$current, _wysiwygRef$current$g2;

      var sanitizedNote;
      return regeneratorRuntime.wrap(function _callee$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              sanitizedNote = sanitizeHtml((_wysiwygRef$current$g = (_wysiwygRef$current = wysiwygRef.current) === null || _wysiwygRef$current === void 0 ? void 0 : (_wysiwygRef$current$g2 = _wysiwygRef$current.getParsedContent) === null || _wysiwygRef$current$g2 === void 0 ? void 0 : _wysiwygRef$current$g2.call(_wysiwygRef$current).trim()) !== null && _wysiwygRef$current$g !== void 0 ? _wysiwygRef$current$g : '', {
                loose: true
              });
              _context.next = 3;
              return onSaveNoteClick === null || onSaveNoteClick === void 0 ? void 0 : onSaveNoteClick(sanitizedNote);

            case 3:
            case "end":
              return _context.stop();
          }
        }
      }, _callee);
    }));

    return function onSaveClick() {
      return _ref2.apply(this, arguments);
    };
  }();

  var onCancelClick = function onCancelClick() {
    onToggleEditNoteClick === null || onToggleEditNoteClick === void 0 ? void 0 : onToggleEditNoteClick();
  };

  return /*#__PURE__*/React__default['default'].createElement(Wysiwyg, {
    theme: "note",
    autoFocus: true,
    content: note !== null && note !== void 0 ? note : '',
    maxLongestSide: 294,
    minHeight: 0,
    ref: wysiwygRef,
    tabIndex: 0,
    plugins: [PdWysiwyg.LinkHandlerPlugin],
    toolbar: /*#__PURE__*/React__default['default'].createElement(Toolbar, null, /*#__PURE__*/React__default['default'].createElement(ActionButtons, {
      onCancel: onCancelClick,
      onSave: onSaveClick
    })),
    translations: {
      link: {
        textLabel: translator.gettext('Text'),
        linkLabel: translator.gettext('Link')
      },
      shared: {
        editButton: translator.gettext('Edit'),
        removeButton: translator.gettext('Remove'),
        saveButton: translator.gettext('Save')
      }
    }
  });
};
WysiwygEditor.displayName = "WysiwygEditor";

function _templateObject10() {
  var data = taggedTemplateLiteral(["\n\tmargin-left: 8px;\n\n\t& svg.cui4-icon {\n\t\tfill: ", ";\n\t}\n"]);

  _templateObject10 = function _templateObject10() {
    return data;
  };

  return data;
}

function _templateObject9() {
  var data = taggedTemplateLiteral(["\n\tflex: 1;\n\tmargin-top: 2px;\n\n\t", "\n"]);

  _templateObject9 = function _templateObject9() {
    return data;
  };

  return data;
}

function _templateObject8$1() {
  var data = taggedTemplateLiteral(["\n\toverflow: hidden;\n\twhite-space: nowrap;\n\ttext-overflow: ellipsis;\n"]);

  _templateObject8$1 = function _templateObject8() {
    return data;
  };

  return data;
}

function _templateObject7$2() {
  var data = taggedTemplateLiteral(["\n\t/* styles copy pasted from @pipedrive/pd-wysiwyg/src/react/wysiwyg.scss */\n\tword-break: break-word;\n\ta {\n\t\tcolor: ", ";\n\t}\n\n\tb,\n\tstrong {\n\t\tfont-weight: bold;\n\t}\n\n\tem,\n\ti {\n\t\tfont-style: italic;\n\t}\n\n\tu {\n\t\ttext-decoration: underline;\n\t}\n\n\tul {\n\t\tlist-style: disc;\n\t}\n\n\tol {\n\t\tlist-style: decimal;\n\t}\n\n\tul,\n\tol {\n\t\tmargin-top: 1em;\n\t\tmargin-bottom: 1em;\n\t\tpadding: 0 2.5em 0 2.5em;\n\t\tpadding-inline-start: 2.5em;\n\t\tpadding-inline-end: 0;\n\n\t\tul,\n\t\tol {\n\t\t\tmargin-top: 0;\n\t\t\tmargin-bottom: 0;\n\t\t}\n\t}\n"]);

  _templateObject7$2 = function _templateObject7() {
    return data;
  };

  return data;
}

function _templateObject6$2() {
  var data = taggedTemplateLiteral(["\n\tmargin: 0 8px;\n"]);

  _templateObject6$2 = function _templateObject6() {
    return data;
  };

  return data;
}

function _templateObject5$2() {
  var data = taggedTemplateLiteral(["\n\tflex: 1;\n"]);

  _templateObject5$2 = function _templateObject5() {
    return data;
  };

  return data;
}

function _templateObject4$2() {
  var data = taggedTemplateLiteral(["\n\tdisplay: flex;\n\tmargin-bottom: 8px;\n\tcolor: ", ";\n\tfont-size: ", ";\n"]);

  _templateObject4$2 = function _templateObject4() {
    return data;
  };

  return data;
}

function _templateObject3$3() {
  var data = taggedTemplateLiteral(["\n\tpadding: 12px 16px;\n\tborder: 1px solid ", ";\n\tbackground: ", ";\n\tmargin-bottom: -1px;\n"]);

  _templateObject3$3 = function _templateObject3() {
    return data;
  };

  return data;
}

function _templateObject2$4() {
  var data = taggedTemplateLiteral(["\n\t\t\tdisplay: block;\n\t\t\t// negative margin to position the buttons accordingly in the ItemBox\n\t\t\tmargin-bottom: -12px;\n\t\t\tmargin-right: -4px;\n\t\t"]);

  _templateObject2$4 = function _templateObject2() {
    return data;
  };

  return data;
}

function _templateObject$4() {
  var data = taggedTemplateLiteral(["\n\tdisplay: flex;\n\n\t", "\n"]);

  _templateObject$4 = function _templateObject() {
    return data;
  };

  return data;
}
var Note = styled__default['default'].div(_templateObject$4(), function (_ref) {
  var showWysiwygEditor = _ref.showWysiwygEditor;
  return showWysiwygEditor && styled.css(_templateObject2$4());
});
var NotePinned = styled__default['default'].div(_templateObject3$3(), variables_4.black16, variables_4.noteYellow);
var NoteHeader = styled__default['default'].div(_templateObject4$2(), variables_4.black64, variables_3.fontSizeS);
var NoteDetails = styled__default['default'].div(_templateObject5$2());
var DotDivider = styled__default['default'].span(_templateObject6$2());
var FormattedNoteContent = styled__default['default'](conventionUiReact.Text)(_templateObject7$2(), variables_4.blue);
var ellipsis = styled.css(_templateObject8$1());
var NoteContent = styled__default['default'](FormattedNoteContent)(_templateObject9(), function (_ref2) {
  var collapsed = _ref2.collapsed;
  return collapsed && ellipsis;
});
var NoteExpandButton = styled__default['default'](conventionUiReact.Button)(_templateObject10(), variables_4.black88);

// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types
var stripHtml = function stripHtml(html) {
  return html.replace(/(<([^>]+)>)/gi, ' ').replace(/\s{2,}/gi, ' ').trim();
};
var NoteEditor = function NoteEditor(_ref) {
  var note = _ref.note,
      _ref$showCollapseButt = _ref.showCollapseButton,
      showCollapseButton = _ref$showCollapseButt === void 0 ? false : _ref$showCollapseButt,
      isCollapsed = _ref.isCollapsed,
      onCollapsedButtonClick = _ref.onCollapsedButtonClick,
      _ref$showWysiwygEdito = _ref.showWysiwygEditor,
      showWysiwygEditor = _ref$showWysiwygEdito === void 0 ? false : _ref$showWysiwygEdito,
      onToggleEditNoteClick = _ref.onToggleEditNoteClick,
      onSaveNoteClick = _ref.onSaveNoteClick;
  var notePlainText = React.useMemo(function () {
    return stripHtml(note);
  }, [note]);
  return /*#__PURE__*/React__default['default'].createElement(Note, {
    showWysiwygEditor: showWysiwygEditor
  }, showWysiwygEditor ? /*#__PURE__*/React__default['default'].createElement(WysiwygEditor, {
    note: note,
    onToggleEditNoteClick: onToggleEditNoteClick,
    onSaveNoteClick: onSaveNoteClick
  }) : /*#__PURE__*/React__default['default'].createElement(React__default['default'].Fragment, null, /*#__PURE__*/React__default['default'].createElement(NoteContent, {
    dangerouslySetInnerHTML: {
      __html: isCollapsed ? notePlainText : note
    },
    collapsed: isCollapsed
  }), showCollapseButton && /*#__PURE__*/React__default['default'].createElement(NoteExpandButton, {
    color: "ghost",
    size: "s",
    onClick: onCollapsedButtonClick
  }, /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Icon, {
    icon: isCollapsed ? 'expand' : 'collapse',
    size: "s",
    color: "black-88"
  }))));
};
NoteEditor.displayName = "NoteEditor";

var ActivityNote$1 = function ActivityNote$1(_ref) {
  var note = _ref.note;

  var _useState = React.useState(true),
      _useState2 = slicedToArray(_useState, 2),
      isNoteCollapsed = _useState2[0],
      setIsNoteCollapsed = _useState2[1];

  var onCollapsedButtonClick = function onCollapsedButtonClick() {
    setIsNoteCollapsed(!isNoteCollapsed);
  };

  return /*#__PURE__*/React__default['default'].createElement(ActivityNote, null, /*#__PURE__*/React__default['default'].createElement(NoteEditor, {
    note: note,
    showCollapseButton: true,
    isCollapsed: isNoteCollapsed,
    onCollapsedButtonClick: onCollapsedButtonClick
  }));
};
ActivityNote$1.displayName = "ActivityNote";

var Activity = function Activity(_ref) {
  var _ref2;

  var children = _ref.children,
      isDone = _ref.isDone,
      ownerName = _ref.ownerName,
      subject = _ref.subject,
      onToggleDone = _ref.onToggleDone,
      iconType = _ref.iconType,
      note = _ref.note,
      displayLoader = _ref.displayLoader;

  var _useState = React.useState(false),
      _useState2 = slicedToArray(_useState, 2),
      isLoading = _useState2[0],
      setIsLoading = _useState2[1];

  var translator = Bi();

  var _useComponentChildren = useComponentChildren(children, ['ActivityActions', 'DueDate']),
      ActivityActions = _useComponentChildren.ActivityActions,
      DueDate = _useComponentChildren.DueDate;

  var onMarkAsDoneButton = function onMarkAsDoneButton() {
    setTimeout(function () {
      if (setIsLoading) {
        setIsLoading(true);
      }
    }, 300);
    onToggleDone();
  };

  var markAsDoneIcon = React.useMemo(function () {
    if (isLoading) {
      return /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Spinner, {
        size: "s"
      });
    }

    if (isDone) {
      return /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Icon, {
        icon: "check-done",
        size: "s",
        color: "white"
      });
    }

    return null;
  }, [isLoading, isDone]);
  var isMarkedDone = (_ref2 = !isLoading && isDone) !== null && _ref2 !== void 0 ? _ref2 : false;
  return /*#__PURE__*/React__default['default'].createElement(ConditionalWrapper, {
    condition: displayLoader,
    wrapper: function wrapper(children) {
      return /*#__PURE__*/React__default['default'].createElement(OverlayWrapper, null, children);
    }
  }, /*#__PURE__*/React__default['default'].createElement(ItemBox, {
    iconType: iconType,
    isDone: isMarkedDone
  }, /*#__PURE__*/React__default['default'].createElement(CardContent, null, /*#__PURE__*/React__default['default'].createElement(Row, null, /*#__PURE__*/React__default['default'].createElement(CardTitle, null, /*#__PURE__*/React__default['default'].createElement(Title, {
    isDone: isMarkedDone
  }, /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Tooltip, {
    placement: "top",
    content: /*#__PURE__*/React__default['default'].createElement("span", null, isMarkedDone ? translator.gettext('Mark as not done') : translator.gettext('Mark as done'))
  }, /*#__PURE__*/React__default['default'].createElement("div", null, /*#__PURE__*/React__default['default'].createElement(MarkAsDoneButton, {
    isDone: isMarkedDone,
    onClick: onMarkAsDoneButton
  }, markAsDoneIcon))), subject))), /*#__PURE__*/React__default['default'].createElement(Row, null, DueDate, /*#__PURE__*/React__default['default'].createElement(Separator, null, "\xB7"), /*#__PURE__*/React__default['default'].createElement(SubText, null, ownerName))), ActivityActions, note && /*#__PURE__*/React__default['default'].createElement(ActivityNote$1, {
    note: note
  })));
};
Activity.displayName = "Activity";

function _templateObject3$4() {
  var data = taggedTemplateLiteral(["\n\twidth: 200px;\n\tmargin: 8px 0;\n"]);

  _templateObject3$4 = function _templateObject3() {
    return data;
  };

  return data;
}

function _templateObject2$5() {
  var data = taggedTemplateLiteral(["\n\t&:hover {\n\t\ttext-decoration: none;\n\t}\n"]);

  _templateObject2$5 = function _templateObject2() {
    return data;
  };

  return data;
}

function _templateObject$5() {
  var data = taggedTemplateLiteral(["\n\tposition: absolute;\n\tright: 12px;\n\ttop: 12px;\n\t.cui4-separator:last-child {\n\t\tdisplay: none;\n\t}\n\t.cui4-option {\n\t\tpadding: 6px 16px;\n\t}\n"]);

  _templateObject$5 = function _templateObject() {
    return data;
  };

  return data;
}
var Wrapper$1 = styled__default['default'].div(_templateObject$5());
var ExportLink = styled__default['default'].a(_templateObject2$5());
var PopoverContent = styled__default['default'].div(_templateObject3$4());
var ActivityActions = function ActivityActions(props) {
  var translator = Bi();
  var markAsActionText = props.isDone ? translator.gettext('Mark as “To do”') : translator.gettext('Mark as done');
  return /*#__PURE__*/React__default['default'].createElement(Wrapper$1, null, /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Popover, {
    placement: "bottom-end",
    spacing: "none",
    content: /*#__PURE__*/React__default['default'].createElement(PopoverContent, null, /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Option, {
      onClick: props.onEditActivity
    }, translator.gettext('Edit')), /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Option, {
      onClick: props.onMarkActivity
    }, markAsActionText), /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Option, null, /*#__PURE__*/React__default['default'].createElement(ExportLink, {
      href: props.exportLink,
      download: true
    }, translator.gettext('Export as ICS'))), props.onDeleteActivity && /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Option, {
      onClick: props.onDeleteActivity
    }, translator.gettext('Delete')))
  }, /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Button, {
    color: "ghost",
    size: "s",
    "data-testid": "CardActionsButton"
  }, /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Icon, {
    icon: "ellipsis",
    size: "s",
    color: "black-32"
  }))));
};
ActivityActions.displayName = "ActivityActions";

var isDueToday = function isDueToday(dateTime, now, hasTime) {
  // either, time specified, after now and still today
  // or doesnt have time (meaning any time of the day) and is today
  return hasTime && dateTime.isAfter(now) && dateTime.isSame(now, 'day') || !hasTime && dateTime.isSame(now, 'day');
};

var isOverdue = function isOverdue(dateTime, now) {
  return dateTime.isBefore(now);
};

var getStyle = function getStyle(now, dateTime, hasTime, isDone) {
  if (isDone) {
    return {
      color: variables_4.black64,
      weight: variables_3.fontWeightNormal
    };
  }

  if (isDueToday(now, dateTime, hasTime)) {
    return {
      color: variables_4.green,
      weight: variables_3.fontWeightBold
    };
  }

  if (isOverdue(now, dateTime)) {
    return {
      color: variables_4.red,
      weight: variables_3.fontWeightBold
    };
  }

  return {
    color: variables_4.black64,
    weight: variables_3.fontWeightNormal
  };
};

var getSameDay = function getSameDay(hasTime, t) {
  if (hasTime) {
    return "[".concat(t.gettext('Today at'), "] LT");
  }

  return "[".concat(t.gettext('Today'), "]");
};

var getNextDay = function getNextDay(hasTime, t) {
  if (hasTime) {
    return "[".concat(t.gettext('Tomorrow at'), "] LT");
  }

  return "[".concat(t.gettext('Tomorrow'), "]");
};

var getLastDay = function getLastDay(hasTime, t) {
  if (hasTime) {
    return "[".concat(t.gettext('Yesterday at'), "] LT");
  }

  return "[".concat(t.gettext('Yesterday'), "]");
};

var getNextWeek = function getNextWeek(hasTime, t) {
  if (hasTime) {
    return "dddd [".concat(t.gettext('at'), "] LT");
  }

  return 'dddd';
};

var getEverythingElse = function getEverythingElse(dateTime, now, hasTime, t) {
  var shouldShowYear = moment__default['default'](dateTime).isBefore(now, 'year');

  if (shouldShowYear) {
    if (hasTime) {
      return "MMMM D, YYYY [".concat(t.gettext('at'), "] LT");
    }

    return 'MMMM D, YYYY';
  }

  if (hasTime) {
    return "MMMM D [".concat(t.gettext('at'), "] LT");
  }

  return 'MMMM D';
};

var getCalendarValues = function getCalendarValues(dateTime, now, hasTime, t) {
  var values = dateTime.calendar(now, {
    sameDay: function sameDay() {
      return getSameDay(hasTime, t);
    },
    nextDay: function nextDay() {
      return getNextDay(hasTime, t);
    },
    nextWeek: function nextWeek() {
      return getNextWeek(hasTime, t);
    },
    lastDay: function lastDay() {
      return getLastDay(hasTime, t);
    },
    lastWeek: function lastWeek() {
      return getEverythingElse(dateTime, now, hasTime, t);
    },
    sameElse: function sameElse() {
      return getEverythingElse(dateTime, now, hasTime, t);
    }
  });
  return values;
};

var formatTime = function formatTime(time) {
  if (!time) {
    return '';
  }

  if (/Z$/.test(time) || time.includes('+')) {
    return "T".concat(time);
  }

  return "T".concat(time, "Z");
};

// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types
var getFormattedActivityDate = function getFormattedActivityDate(_ref) {
  var activityDate = _ref.activityDate,
      activityTime = _ref.activityTime,
      now = _ref.now,
      t = _ref.t,
      isDone = _ref.isDone;
  var dateWithTime = "".concat(activityDate).concat(formatTime(activityTime));
  var dateTime = moment__default['default'](dateWithTime);
  var hasTime = activityTime !== null;
  var formattedDateTime = getCalendarValues(dateTime, now, hasTime, t);

  var _getStyle = getStyle(dateTime, now, hasTime, isDone),
      color = _getStyle.color,
      weight = _getStyle.weight;

  return {
    date: formattedDateTime,
    color: color,
    weight: weight
  };
};

function _templateObject$6() {
  var data = taggedTemplateLiteral(["\n\tcolor: ", ";\n\tfont-weight: ", ";\n\tfont-size: ", ";\n\tline-height: ", ";\n\tletter-spacing: normal;\n"]);

  _templateObject$6 = function _templateObject() {
    return data;
  };

  return data;
}
var Wrapper$2 = styled__default['default'].span(_templateObject$6(), function (props) {
  return props.color;
}, function (props) {
  return props.weight;
}, variables_3.fontSizeS, variables_3.lineHeightS);
var DueDate = function DueDate(props) {
  var dueDate = props.dueDate,
      dueTime = props.dueTime,
      isDone = props.isDone;
  var t = Bi();
  var now = moment__default['default']().utc();

  if (!dueDate) {
    return null;
  }

  var _getFormattedActivity = getFormattedActivityDate({
    activityDate: dueDate,
    activityTime: dueTime,
    now: now,
    t: t,
    isDone: isDone
  }),
      date = _getFormattedActivity.date,
      color = _getFormattedActivity.color,
      weight = _getFormattedActivity.weight;

  return /*#__PURE__*/React__default['default'].createElement(Wrapper$2, {
    color: color,
    weight: weight
  }, date);
};
DueDate.displayName = "DueDate";

var LocaleContext = /*#__PURE__*/React__default['default'].createContext('en-US');
var LocaleProvider = function LocaleProvider(_ref) {
  var locale = _ref.locale,
      children = _ref.children;
  // Locale from webapp is with underscore e.g. "en_US", but this is not valid JS locale
  var parsedLocale = locale.replace('_', '-');
  return /*#__PURE__*/React__default['default'].createElement(LocaleContext.Provider, {
    value: parsedLocale
  }, children);
};
LocaleProvider.displayName = "LocaleProvider";
// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types
function useLocale() {
  var locale = React.useContext(LocaleContext);

  var getFullDateTime = function getFullDateTime(date) {
    var options = {
      dateStyle: 'long',
      timeStyle: 'short'
    };
    return new Intl.DateTimeFormat(locale, options).format(date);
  };

  return {
    getFullDateTime: getFullDateTime
  };
}

function _templateObject7$3() {
  var data = taggedTemplateLiteral(["\n\tdisplay: flex;\n\tjustify-content: center;\n\tmargin: 24px 0 16px 0;\n"]);

  _templateObject7$3 = function _templateObject7() {
    return data;
  };

  return data;
}

function _templateObject6$3() {
  var data = taggedTemplateLiteral(["\n\tdisplay: flex;\n\tflex-direction: column;\n\tposition: relative;\n\t", "\n"]);

  _templateObject6$3 = function _templateObject6() {
    return data;
  };

  return data;
}

function _templateObject5$3() {
  var data = taggedTemplateLiteral(["\n\t&:before {\n\t\tdisplay: block;\n\t\tcontent: '';\n\t\tposition: absolute;\n\t\tleft: -20px;\n\t\twidth: 1px;\n\t\ttop: 90px;\n\t\t", "\n\t\t", "\n\t}\n\t", "\n"]);

  _templateObject5$3 = function _templateObject5() {
    return data;
  };

  return data;
}

function _templateObject4$3() {
  var data = taggedTemplateLiteral(["\n\t&:after {\n\t\t", "\n\t\tposition: absolute;\n\t\tleft: -23px;\n\t\tbottom: 32px;\n\t}\n"]);

  _templateObject4$3 = function _templateObject4() {
    return data;
  };

  return data;
}

function _templateObject3$5() {
  var data = taggedTemplateLiteral(["\n\tbackground-color: ", ";\n\tbottom: 39px;\n"]);

  _templateObject3$5 = function _templateObject3() {
    return data;
  };

  return data;
}

function _templateObject2$6() {
  var data = taggedTemplateLiteral(["\n\tbackground-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAcCAYAAABGdB6IAAAAAXNSR0IArs4c6QAAACBJREFUGBljYBgcgPHu3bv/kZ3ChMwBsYeOALrLB4oPANHuA66qKmV/AAAAAElFTkSuQmCC');\n\tbottom: -69px;\n\tbackground-size: 1px 12px;\n"]);

  _templateObject2$6 = function _templateObject2() {
    return data;
  };

  return data;
}

function _templateObject$7() {
  var data = taggedTemplateLiteral(["\n\tdisplay: block;\n\tcontent: '';\n\twidth: 7px;\n\theight: 7px;\n\tborder-radius: 50%;\n\tbackground-color: ", ";\n"]);

  _templateObject$7 = function _templateObject() {
    return data;
  };

  return data;
}
var circleIcon = styled.css(_templateObject$7(), variables_4.black24);
var dashedLine = styled.css(_templateObject2$6());
var solidLine = styled.css(_templateObject3$5(), variables_4.black24);
var solidLineStartingPoint = styled.css(_templateObject4$3(), circleIcon);

var flowSidebar = function flowSidebar(barType) {
  return styled.css(_templateObject5$3(), barType === 'dashed' && dashedLine, barType === 'solid' && solidLine, barType === 'solid' && solidLineStartingPoint);
};

var FlowWrapper = styled__default['default'].div(_templateObject6$3(), function (props) {
  return props.barType !== 'none' && flowSidebar(props.barType);
});
var TitleWrapper = styled__default['default'].div(_templateObject7$3());

function _templateObject6$4() {
  var data = taggedTemplateLiteral(["\n\tfont-size: ", ";\n\tline-height: 1.23;\n\tletter-spacing: normal;\n\tcolor: ", ";\n"]);

  _templateObject6$4 = function _templateObject6() {
    return data;
  };

  return data;
}

function _templateObject5$4() {
  var data = taggedTemplateLiteral(["\n\tdisplay: inline-block;\n\tpadding-left: 4px;\n\tpadding-right: 4px;\n\tcolor: ", ";\n"]);

  _templateObject5$4 = function _templateObject5() {
    return data;
  };

  return data;
}

function _templateObject4$4() {
  var data = taggedTemplateLiteral(["\n\tfont-size: ", ";\n\t&:hover {\n\t\ttext-decoration: underline;\n\t}\n\tsvg {\n\t\tfill: ", ";\n\t}\n"]);

  _templateObject4$4 = function _templateObject4() {
    return data;
  };

  return data;
}

function _templateObject3$6() {
  var data = taggedTemplateLiteral(["\n\tfont-size: ", ";\n\tfont-weight: ", ";\n\tline-height: ", ";\n"]);

  _templateObject3$6 = function _templateObject3() {
    return data;
  };

  return data;
}

function _templateObject2$7() {
  var data = taggedTemplateLiteral(["\n\tbackground: ", ";\n\twidth: 10px;\n\theight: ", ";\n\tposition: absolute;\n\ttop: 8px;\n\tleft: -23px;\n\tdisplay: flex;\n\tflex-direction: row;\n\talign-items: center;\n\n\t", "\n"]);

  _templateObject2$7 = function _templateObject2() {
    return data;
  };

  return data;
}

function _templateObject$8() {
  var data = taggedTemplateLiteral(["\n\t&:before {\n\t\t", "\n\t}\n"]);

  _templateObject$8 = function _templateObject() {
    return data;
  };

  return data;
}
var displayIcon = styled.css(_templateObject$8(), circleIcon);
var CreationEventIcon = styled__default['default'](conventionUiReact.Text)(_templateObject2$7(), variables_4.white, function (props) {
  return props.isLastItem ? '0px' : '23px';
}, function (props) {
  return !props.isLastItem && displayIcon;
});
var Title$1 = styled__default['default'].span(_templateObject3$6(), variables_3.fontSizeS, variables_3.fontWeightNormal, variables_3.lineHeightM);
var Link = styled__default['default'].a(_templateObject4$4(), variables_3.fontSizeM, variables_4.blue);
var Separator$1 = styled__default['default'].span(_templateObject5$4(), variables_4.black64);
var SubText$1 = styled__default['default'].span(_templateObject6$4(), variables_3.fontSizeS, variables_4.black64);

var CreationEvent = function CreationEvent(_ref) {
  var children = _ref.children,
      ownerName = _ref.ownerName,
      sourceLink = _ref.sourceLink,
      timeCreated = _ref.timeCreated,
      isLastItem = _ref.isLastItem;
  var translator = Bi();

  var _useLocale = useLocale(),
      getFullDateTime = _useLocale.getFullDateTime;

  var _useComponentChildren = useComponentChildren(children, ['SourceLabel']),
      SourceLabel = _useComponentChildren.SourceLabel;

  var getLeadCreatedSource = function getLeadCreatedSource() {
    if (!SourceLabel) {
      return null;
    }

    if (sourceLink) {
      return /*#__PURE__*/React__default['default'].createElement(React__default['default'].Fragment, null, /*#__PURE__*/React__default['default'].createElement(Link, {
        href: sourceLink
      }, SourceLabel), "\xA0\u2192\xA0");
    }

    return /*#__PURE__*/React__default['default'].createElement(React__default['default'].Fragment, null, SourceLabel, "\xA0\u2192\xA0");
  };

  return /*#__PURE__*/React__default['default'].createElement(ItemBox, {
    displayIcon: false,
    displayBorder: false
  }, /*#__PURE__*/React__default['default'].createElement(CreationEventIcon, {
    isLastItem: isLastItem
  }), /*#__PURE__*/React__default['default'].createElement(Title$1, null, getLeadCreatedSource(), translator.gettext('Lead created')), /*#__PURE__*/React__default['default'].createElement("div", null, /*#__PURE__*/React__default['default'].createElement(SubText$1, null, timeCreated && getFullDateTime(timeCreated)), /*#__PURE__*/React__default['default'].createElement(Separator$1, null, "\xB7"), /*#__PURE__*/React__default['default'].createElement(SubText$1, null, ownerName)));
};
CreationEvent.displayName = "CreationEvent";

function _templateObject2$8() {
  var data = taggedTemplateLiteral(["\n\tposition: absolute;\n\tleft: 0;\n\tdisplay: flex;\n\talign-items: center;\n\tsvg {\n\t\twidth: 16px;\n\t\theight: 16px;\n\t}\n"]);

  _templateObject2$8 = function _templateObject2() {
    return data;
  };

  return data;
}

function _templateObject$9() {
  var data = taggedTemplateLiteral(["\n\tdisplay: inline-flex;\n\talign-items: center;\n\tposition: relative;\n\tpadding-left: 20px;\n"]);

  _templateObject$9 = function _templateObject() {
    return data;
  };

  return data;
}
var SourceWrapper = styled__default['default'].div(_templateObject$9());
var IconWrapper = styled__default['default'].div(_templateObject2$8());

var SourceLabel = function SourceLabel(_ref) {
  var icon = _ref.icon,
      name = _ref.name;
  return /*#__PURE__*/React__default['default'].createElement(SourceWrapper, null, icon && /*#__PURE__*/React__default['default'].createElement(IconWrapper, null, icon), name);
};
SourceLabel.displayName = "SourceLabel";

var ComponentLoaderContext = /*#__PURE__*/React__default['default'].createContext(null);
var ComponentLoaderProvider = function ComponentLoaderProvider(_ref) {
  var componentLoader = _ref.componentLoader,
      children = _ref.children;
  return /*#__PURE__*/React__default['default'].createElement(ComponentLoaderContext.Provider, {
    value: componentLoader
  }, children);
};
ComponentLoaderProvider.displayName = "ComponentLoaderProvider";
// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types
function useComponentLoader() {
  var componentLoader = React.useContext(ComponentLoaderContext);
  return componentLoader;
}

function _templateObject6$5() {
  var data = taggedTemplateLiteral(["\n\t\t\t&:before {\n\t\t\t\t", "\n\t\t\t\tposition: absolute;\n\t\t\t\tleft: -23px;\n\t\t\t\tbottom: 18px;\n\t\t\t}\n\t\t"]);

  _templateObject6$5 = function _templateObject6() {
    return data;
  };

  return data;
}

function _templateObject5$5() {
  var data = taggedTemplateLiteral(["\n\t", "\n"]);

  _templateObject5$5 = function _templateObject5() {
    return data;
  };

  return data;
}

function _templateObject4$5() {
  var data = taggedTemplateLiteral(["\n\tcolor: ", ";\n\tfont-size: ", ";\n\tfloat: right;\n\tpadding-left: 12px;\n"]);

  _templateObject4$5 = function _templateObject4() {
    return data;
  };

  return data;
}

function _templateObject3$7() {
  var data = taggedTemplateLiteral(["\n\twhite-space: nowrap;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n\tmargin: 0px 40px 0 8px;\n\tcolor: ", ";\n"]);

  _templateObject3$7 = function _templateObject3() {
    return data;
  };

  return data;
}

function _templateObject2$9() {
  var data = taggedTemplateLiteral(["\n\ttext-align: left;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n\twhite-space: nowrap;\n\tdisplay: flex;\n\talign-items: center;\n\n\t> span {\n\t\tfont-weight: ", ";\n\t\tmargin-right: 3px;\n\t}\n"]);

  _templateObject2$9 = function _templateObject2() {
    return data;
  };

  return data;
}

function _templateObject$a() {
  var data = taggedTemplateLiteral(["\n\tmargin-right: 13px;\n\tfloat: left;\n"]);

  _templateObject$a = function _templateObject() {
    return data;
  };

  return data;
}
var EmailIcon = styled__default['default'](conventionUiReact.Icon)(_templateObject$a());
var DetailsWrapper = styled__default['default'].div(_templateObject2$9(), variables_3.fontWeightBold);
var Content = styled__default['default'].div(_templateObject3$7(), variables_4.black64Opaque);
var Timestamp = styled__default['default'].div(_templateObject4$5(), variables_4.black64Opaque, variables_3.fontSizeS);
var DraftEmailIcon = styled__default['default'].div(_templateObject5$5(), function (props) {
  return props.isFirstItem && styled.css(_templateObject6$5(), circleIcon);
});

var humanizeFieldSyntax = PdWysiwyg__default['default'].MergeFieldsHelpers.humanizeFieldSyntax;
var DraftEmail = function DraftEmail(_ref) {
  var messageTitle = _ref.messageTitle,
      snippet = _ref.snippet,
      date = _ref.date,
      isFirstItem = _ref.isFirstItem,
      threadId = _ref.threadId,
      displayLoader = _ref.displayLoader;
  var componentLoader = useComponentLoader();

  var _useLocale = useLocale(),
      getFullDateTime = _useLocale.getFullDateTime;

  var onClick = /*#__PURE__*/function () {
    var _ref2 = asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {
      var modal, params;
      return regeneratorRuntime.wrap(function _callee$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              if (!componentLoader) {
                _context.next = 6;
                break;
              }

              _context.next = 3;
              return componentLoader.load('froot:modals');

            case 3:
              modal = _context.sent;
              params = {
                threadId: threadId,
                metricsData: {
                  'detail_view_email.interacted': 'open-draft-in-modal'
                }
              };
              modal.open('webapp:modal', {
                modal: 'mail/thread',
                params: params
              });

            case 6:
            case "end":
              return _context.stop();
          }
        }
      }, _callee);
    }));

    return function onClick() {
      return _ref2.apply(this, arguments);
    };
  }();

  return /*#__PURE__*/React__default['default'].createElement(ConditionalWrapper, {
    condition: displayLoader,
    wrapper: function wrapper(children) {
      return /*#__PURE__*/React__default['default'].createElement(OverlayWrapper, null, children);
    }
  }, /*#__PURE__*/React__default['default'].createElement(ItemBox, {
    displayIcon: false,
    displayHover: true
  }, /*#__PURE__*/React__default['default'].createElement(DraftEmailIcon, {
    isFirstItem: isFirstItem
  }), /*#__PURE__*/React__default['default'].createElement("div", {
    onClick: onClick
  }, /*#__PURE__*/React__default['default'].createElement(Timestamp, null, date && getFullDateTime(date)), /*#__PURE__*/React__default['default'].createElement(DetailsWrapper, null, /*#__PURE__*/React__default['default'].createElement(EmailIcon, {
    icon: "email",
    size: "s",
    color: "black-64"
  }), /*#__PURE__*/React__default['default'].createElement("span", null, humanizeFieldSyntax(messageTitle)), "(draft)", /*#__PURE__*/React__default['default'].createElement(Content, null, snippet)))));
};
DraftEmail.displayName = "DraftEmail";

function _templateObject2$a() {
  var data = taggedTemplateLiteral(["\n\tfont: ", ";\n\tfont-weight: ", ";\n"]);

  _templateObject2$a = function _templateObject2() {
    return data;
  };

  return data;
}

function _templateObject$b() {
  var data = taggedTemplateLiteral(["\n\ttext-align: center;\n\tfont: ", ";\n\tfont-weight: ", ";\n"]);

  _templateObject$b = function _templateObject() {
    return data;
  };

  return data;
}
var Header = styled__default['default'].div(_templateObject$b(), variables_3.fontBodyS, variables_3.fontWeightSemi);
var EventRow = styled__default['default'].div(_templateObject2$a(), variables_3.fontBodyS, variables_3.fontWeightNormal);
var TrackingTimestamps = function TrackingTimestamps(_ref) {
  var children = _ref.children,
      timestamps = _ref.timestamps;

  var _useLocale = useLocale(),
      getFullDateTime = _useLocale.getFullDateTime;

  return /*#__PURE__*/React__default['default'].createElement(React__default['default'].Fragment, null, /*#__PURE__*/React__default['default'].createElement(Header, null, children), timestamps.map(function (timestamp) {
    return /*#__PURE__*/React__default['default'].createElement(EventRow, {
      key: timestamp
    }, getFullDateTime(new Date(timestamp)));
  }));
};

function _templateObject8$2() {
  var data = taggedTemplateLiteral(["\n\tmargin-right: 8px;\n"]);

  _templateObject8$2 = function _templateObject8() {
    return data;
  };

  return data;
}

function _templateObject7$4() {
  var data = taggedTemplateLiteral(["\n\twidth: 300px;\n\tmargin: 8px 0;\n"]);

  _templateObject7$4 = function _templateObject7() {
    return data;
  };

  return data;
}

function _templateObject6$6() {
  var data = taggedTemplateLiteral(["\n\tdisplay: flex;\n\talign-items: center;\n\n\t& span {\n\t\tdisplay: inline-block;\n\t\tmargin-left: ", ";\n\t\ttext-overflow: ellipsis;\n\t\twhite-space: nowrap;\n\t\toverflow: hidden;\n\t}\n\n\t&:hover {\n\t\ttext-decoration: none;\n\t}\n"]);

  _templateObject6$6 = function _templateObject6() {
    return data;
  };

  return data;
}

function _templateObject5$6() {
  var data = taggedTemplateLiteral(["\n\twidth: 20px;\n"]);

  _templateObject5$6 = function _templateObject5() {
    return data;
  };

  return data;
}

function _templateObject4$6() {
  var data = taggedTemplateLiteral(["\n\tfont-weight: ", ";\n"]);

  _templateObject4$6 = function _templateObject4() {
    return data;
  };

  return data;
}

function _templateObject3$8() {
  var data = taggedTemplateLiteral(["\n\tmargin-left: 8px;\n\twidth: 24px;\n\topacity: ", ";\n"]);

  _templateObject3$8 = function _templateObject3() {
    return data;
  };

  return data;
}

function _templateObject2$b() {
  var data = taggedTemplateLiteral(["\n\tmargin-left: 8px;\n\n\t& svg.cui4-icon {\n\t\tfill: ", ";\n\t}\n"]);

  _templateObject2$b = function _templateObject2() {
    return data;
  };

  return data;
}

function _templateObject$c() {
  var data = taggedTemplateLiteral(["\n\tdisplay: flex;\n\talign-items: center;\n"]);

  _templateObject$c = function _templateObject() {
    return data;
  };

  return data;
}
var Wrapper$3 = styled__default['default'].div(_templateObject$c());
var ActionButton = styled__default['default'](conventionUiReact.Button)(_templateObject2$b(), variables_4.black88);
var TrackingIcon = styled__default['default'](conventionUiReact.Icon)(_templateObject3$8(), function (_ref) {
  var wasOpened = _ref.wasOpened;
  return wasOpened ? 1 : 0.32;
});
var TooltipLabel = styled__default['default'].div(_templateObject4$6(), variables_3.fontWeightSemi);
var AttachmentsIcon = styled__default['default'](conventionUiReact.Icon)(_templateObject5$6());
var PopoverOption = styled__default['default'](conventionUiReact.Option)(_templateObject6$6(), function (_ref2) {
  var isEmptyIcon = _ref2.isEmptyIcon;
  return isEmptyIcon ? '24px' : '0';
});
var PopoverContent$1 = styled__default['default'].div(_templateObject7$4());
var PopoverOptionIcon = styled__default['default'](conventionUiReact.Icon)(_templateObject8$2());

var strictUriEncode = str => encodeURIComponent(str).replace(/[!'()*]/g, x => `%${x.charCodeAt(0).toString(16).toUpperCase()}`);

var token = '%[a-f0-9]{2}';
var singleMatcher = new RegExp(token, 'gi');
var multiMatcher = new RegExp('(' + token + ')+', 'gi');

function decodeComponents(components, split) {
	try {
		// Try to decode the entire string first
		return decodeURIComponent(components.join(''));
	} catch (err) {
		// Do nothing
	}

	if (components.length === 1) {
		return components;
	}

	split = split || 1;

	// Split the array in 2 parts
	var left = components.slice(0, split);
	var right = components.slice(split);

	return Array.prototype.concat.call([], decodeComponents(left), decodeComponents(right));
}

function decode(input) {
	try {
		return decodeURIComponent(input);
	} catch (err) {
		var tokens = input.match(singleMatcher);

		for (var i = 1; i < tokens.length; i++) {
			input = decodeComponents(tokens, i).join('');

			tokens = input.match(singleMatcher);
		}

		return input;
	}
}

function customDecodeURIComponent(input) {
	// Keep track of all the replacements and prefill the map with the `BOM`
	var replaceMap = {
		'%FE%FF': '\uFFFD\uFFFD',
		'%FF%FE': '\uFFFD\uFFFD'
	};

	var match = multiMatcher.exec(input);
	while (match) {
		try {
			// Decode as big chunks as possible
			replaceMap[match[0]] = decodeURIComponent(match[0]);
		} catch (err) {
			var result = decode(match[0]);

			if (result !== match[0]) {
				replaceMap[match[0]] = result;
			}
		}

		match = multiMatcher.exec(input);
	}

	// Add `%C2` at the end of the map to make sure it does not replace the combinator before everything else
	replaceMap['%C2'] = '\uFFFD';

	var entries = Object.keys(replaceMap);

	for (var i = 0; i < entries.length; i++) {
		// Replace all decoded components
		var key = entries[i];
		input = input.replace(new RegExp(key, 'g'), replaceMap[key]);
	}

	return input;
}

var decodeUriComponent = function (encodedURI) {
	if (typeof encodedURI !== 'string') {
		throw new TypeError('Expected `encodedURI` to be of type `string`, got `' + typeof encodedURI + '`');
	}

	try {
		encodedURI = encodedURI.replace(/\+/g, ' ');

		// Try the built in decoder first
		return decodeURIComponent(encodedURI);
	} catch (err) {
		// Fallback to a more advanced decoder
		return customDecodeURIComponent(encodedURI);
	}
};

var splitOnFirst = (string, separator) => {
	if (!(typeof string === 'string' && typeof separator === 'string')) {
		throw new TypeError('Expected the arguments to be of type `string`');
	}

	if (separator === '') {
		return [string];
	}

	const separatorIndex = string.indexOf(separator);

	if (separatorIndex === -1) {
		return [string];
	}

	return [
		string.slice(0, separatorIndex),
		string.slice(separatorIndex + separator.length)
	];
};

var queryString = createCommonjsModule(function (module, exports) {




const isNullOrUndefined = value => value === null || value === undefined;

function encoderForArrayFormat(options) {
	switch (options.arrayFormat) {
		case 'index':
			return key => (result, value) => {
				const index = result.length;

				if (
					value === undefined ||
					(options.skipNull && value === null) ||
					(options.skipEmptyString && value === '')
				) {
					return result;
				}

				if (value === null) {
					return [...result, [encode(key, options), '[', index, ']'].join('')];
				}

				return [
					...result,
					[encode(key, options), '[', encode(index, options), ']=', encode(value, options)].join('')
				];
			};

		case 'bracket':
			return key => (result, value) => {
				if (
					value === undefined ||
					(options.skipNull && value === null) ||
					(options.skipEmptyString && value === '')
				) {
					return result;
				}

				if (value === null) {
					return [...result, [encode(key, options), '[]'].join('')];
				}

				return [...result, [encode(key, options), '[]=', encode(value, options)].join('')];
			};

		case 'comma':
		case 'separator':
			return key => (result, value) => {
				if (value === null || value === undefined || value.length === 0) {
					return result;
				}

				if (result.length === 0) {
					return [[encode(key, options), '=', encode(value, options)].join('')];
				}

				return [[result, encode(value, options)].join(options.arrayFormatSeparator)];
			};

		default:
			return key => (result, value) => {
				if (
					value === undefined ||
					(options.skipNull && value === null) ||
					(options.skipEmptyString && value === '')
				) {
					return result;
				}

				if (value === null) {
					return [...result, encode(key, options)];
				}

				return [...result, [encode(key, options), '=', encode(value, options)].join('')];
			};
	}
}

function parserForArrayFormat(options) {
	let result;

	switch (options.arrayFormat) {
		case 'index':
			return (key, value, accumulator) => {
				result = /\[(\d*)\]$/.exec(key);

				key = key.replace(/\[\d*\]$/, '');

				if (!result) {
					accumulator[key] = value;
					return;
				}

				if (accumulator[key] === undefined) {
					accumulator[key] = {};
				}

				accumulator[key][result[1]] = value;
			};

		case 'bracket':
			return (key, value, accumulator) => {
				result = /(\[\])$/.exec(key);
				key = key.replace(/\[\]$/, '');

				if (!result) {
					accumulator[key] = value;
					return;
				}

				if (accumulator[key] === undefined) {
					accumulator[key] = [value];
					return;
				}

				accumulator[key] = [].concat(accumulator[key], value);
			};

		case 'comma':
		case 'separator':
			return (key, value, accumulator) => {
				const isArray = typeof value === 'string' && value.includes(options.arrayFormatSeparator);
				const isEncodedArray = (typeof value === 'string' && !isArray && decode(value, options).includes(options.arrayFormatSeparator));
				value = isEncodedArray ? decode(value, options) : value;
				const newValue = isArray || isEncodedArray ? value.split(options.arrayFormatSeparator).map(item => decode(item, options)) : value === null ? value : decode(value, options);
				accumulator[key] = newValue;
			};

		default:
			return (key, value, accumulator) => {
				if (accumulator[key] === undefined) {
					accumulator[key] = value;
					return;
				}

				accumulator[key] = [].concat(accumulator[key], value);
			};
	}
}

function validateArrayFormatSeparator(value) {
	if (typeof value !== 'string' || value.length !== 1) {
		throw new TypeError('arrayFormatSeparator must be single character string');
	}
}

function encode(value, options) {
	if (options.encode) {
		return options.strict ? strictUriEncode(value) : encodeURIComponent(value);
	}

	return value;
}

function decode(value, options) {
	if (options.decode) {
		return decodeUriComponent(value);
	}

	return value;
}

function keysSorter(input) {
	if (Array.isArray(input)) {
		return input.sort();
	}

	if (typeof input === 'object') {
		return keysSorter(Object.keys(input))
			.sort((a, b) => Number(a) - Number(b))
			.map(key => input[key]);
	}

	return input;
}

function removeHash(input) {
	const hashStart = input.indexOf('#');
	if (hashStart !== -1) {
		input = input.slice(0, hashStart);
	}

	return input;
}

function getHash(url) {
	let hash = '';
	const hashStart = url.indexOf('#');
	if (hashStart !== -1) {
		hash = url.slice(hashStart);
	}

	return hash;
}

function extract(input) {
	input = removeHash(input);
	const queryStart = input.indexOf('?');
	if (queryStart === -1) {
		return '';
	}

	return input.slice(queryStart + 1);
}

function parseValue(value, options) {
	if (options.parseNumbers && !Number.isNaN(Number(value)) && (typeof value === 'string' && value.trim() !== '')) {
		value = Number(value);
	} else if (options.parseBooleans && value !== null && (value.toLowerCase() === 'true' || value.toLowerCase() === 'false')) {
		value = value.toLowerCase() === 'true';
	}

	return value;
}

function parse(query, options) {
	options = Object.assign({
		decode: true,
		sort: true,
		arrayFormat: 'none',
		arrayFormatSeparator: ',',
		parseNumbers: false,
		parseBooleans: false
	}, options);

	validateArrayFormatSeparator(options.arrayFormatSeparator);

	const formatter = parserForArrayFormat(options);

	// Create an object with no prototype
	const ret = Object.create(null);

	if (typeof query !== 'string') {
		return ret;
	}

	query = query.trim().replace(/^[?#&]/, '');

	if (!query) {
		return ret;
	}

	for (const param of query.split('&')) {
		let [key, value] = splitOnFirst(options.decode ? param.replace(/\+/g, ' ') : param, '=');

		// Missing `=` should be `null`:
		// http://w3.org/TR/2012/WD-url-20120524/#collect-url-parameters
		value = value === undefined ? null : ['comma', 'separator'].includes(options.arrayFormat) ? value : decode(value, options);
		formatter(decode(key, options), value, ret);
	}

	for (const key of Object.keys(ret)) {
		const value = ret[key];
		if (typeof value === 'object' && value !== null) {
			for (const k of Object.keys(value)) {
				value[k] = parseValue(value[k], options);
			}
		} else {
			ret[key] = parseValue(value, options);
		}
	}

	if (options.sort === false) {
		return ret;
	}

	return (options.sort === true ? Object.keys(ret).sort() : Object.keys(ret).sort(options.sort)).reduce((result, key) => {
		const value = ret[key];
		if (Boolean(value) && typeof value === 'object' && !Array.isArray(value)) {
			// Sort object keys, not values
			result[key] = keysSorter(value);
		} else {
			result[key] = value;
		}

		return result;
	}, Object.create(null));
}

exports.extract = extract;
exports.parse = parse;

exports.stringify = (object, options) => {
	if (!object) {
		return '';
	}

	options = Object.assign({
		encode: true,
		strict: true,
		arrayFormat: 'none',
		arrayFormatSeparator: ','
	}, options);

	validateArrayFormatSeparator(options.arrayFormatSeparator);

	const shouldFilter = key => (
		(options.skipNull && isNullOrUndefined(object[key])) ||
		(options.skipEmptyString && object[key] === '')
	);

	const formatter = encoderForArrayFormat(options);

	const objectCopy = {};

	for (const key of Object.keys(object)) {
		if (!shouldFilter(key)) {
			objectCopy[key] = object[key];
		}
	}

	const keys = Object.keys(objectCopy);

	if (options.sort !== false) {
		keys.sort(options.sort);
	}

	return keys.map(key => {
		const value = object[key];

		if (value === undefined) {
			return '';
		}

		if (value === null) {
			return encode(key, options);
		}

		if (Array.isArray(value)) {
			return value
				.reduce(formatter(key), [])
				.join('&');
		}

		return encode(key, options) + '=' + encode(value, options);
	}).filter(x => x.length > 0).join('&');
};

exports.parseUrl = (url, options) => {
	options = Object.assign({
		decode: true
	}, options);

	const [url_, hash] = splitOnFirst(url, '#');

	return Object.assign(
		{
			url: url_.split('?')[0] || '',
			query: parse(extract(url), options)
		},
		options && options.parseFragmentIdentifier && hash ? {fragmentIdentifier: decode(hash, options)} : {}
	);
};

exports.stringifyUrl = (object, options) => {
	options = Object.assign({
		encode: true,
		strict: true
	}, options);

	const url = removeHash(object.url).split('?')[0] || '';
	const queryFromUrl = exports.extract(object.url);
	const parsedQueryFromUrl = exports.parse(queryFromUrl, {sort: false});

	const query = Object.assign(parsedQueryFromUrl, object.query);
	let queryString = exports.stringify(query, options);
	if (queryString) {
		queryString = `?${queryString}`;
	}

	let hash = getHash(object.url);
	if (object.fragmentIdentifier) {
		hash = `#${encode(object.fragmentIdentifier, options)}`;
	}

	return `${url}${queryString}${hash}`;
};
});
var queryString_1 = queryString.extract;
var queryString_2 = queryString.parse;
var queryString_3 = queryString.stringify;
var queryString_4 = queryString.parseUrl;
var queryString_5 = queryString.stringifyUrl;

function ownKeys$1(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread$1(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys$1(Object(source), true).forEach(function (key) { defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys$1(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

var getCookie = function getCookie(name) {
  var value = "; ".concat(document.cookie);
  var parts = value.split("; ".concat(name, "="));

  if (parts.length !== 2) {
    return '';
  }

  var lastPart = parts.pop();

  if (!lastPart) {
    return '';
  }

  return lastPart.split(';').shift();
}; // eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types

var getUrl = function getUrl(url, optionalParams) {
  var params = _objectSpread$1(_objectSpread$1({}, optionalParams), {}, {
    session_token: getCookie('pipe-session-token'),
    strict_mode: true
  });

  var stringifiedParams = queryString.stringify(params);
  return "".concat(url, "?").concat(stringifiedParams);
};

var Attachments = function Attachments(_ref) {
  var attachments = _ref.attachments;

  var getPopoverContent = function getPopoverContent() {
    return attachments.map(function (attachment) {
      // url for direct downloading the attachment
      var url = attachment.url || '';
      var downloadUrl = getUrl(url, {
        direct_download: 1
      });
      return /*#__PURE__*/React__default['default'].createElement(PopoverContent$1, {
        key: attachment.name
      }, /*#__PURE__*/React__default['default'].createElement(PopoverOption, {
        href: downloadUrl
      }, attachment.name));
    });
  };

  if (!attachments.length) {
    return null;
  }

  return /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Popover, {
    placement: "bottom-end",
    spacing: "none",
    content: getPopoverContent
  }, /*#__PURE__*/React__default['default'].createElement(ActionButton, {
    color: "ghost",
    size: "s"
  }, /*#__PURE__*/React__default['default'].createElement(AttachmentsIcon, {
    icon: "attach",
    color: "black-88"
  })));
};
Attachments.displayName = "Attachments";

function _defineProperty$1(obj, key, value) {
  if (key in obj) {
    Object.defineProperty(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
  } else {
    obj[key] = value;
  }

  return obj;
}

function _objectSpread$2(target) {
  for (var i = 1; i < arguments.length; i++) {
    var source = arguments[i] != null ? arguments[i] : {};
    var ownKeys = Object.keys(source);

    if (typeof Object.getOwnPropertySymbols === 'function') {
      ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {
        return Object.getOwnPropertyDescriptor(source, sym).enumerable;
      }));
    }

    ownKeys.forEach(function (key) {
      _defineProperty$1(target, key, source[key]);
    });
  }

  return target;
}

function _objectWithoutPropertiesLoose(source, excluded) {
  if (source == null) return {};
  var target = {};
  var sourceKeys = Object.keys(source);
  var key, i;

  for (i = 0; i < sourceKeys.length; i++) {
    key = sourceKeys[i];
    if (excluded.indexOf(key) >= 0) continue;
    target[key] = source[key];
  }

  return target;
}

function _objectWithoutProperties(source, excluded) {
  if (source == null) return {};

  var target = _objectWithoutPropertiesLoose(source, excluded);

  var key, i;

  if (Object.getOwnPropertySymbols) {
    var sourceSymbolKeys = Object.getOwnPropertySymbols(source);

    for (i = 0; i < sourceSymbolKeys.length; i++) {
      key = sourceSymbolKeys[i];
      if (excluded.indexOf(key) >= 0) continue;
      if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue;
      target[key] = source[key];
    }
  }

  return target;
}

function getCookieValue(name) {
  var value = "; ".concat(document.cookie);
  var parts = value.split("; ".concat(name, "="));

  if (!parts || parts.length !== 2) {
    return '';
  }

  return parts.pop().split(';').shift();
}

var errorMessages = {
  default: 'Request unsuccessful',
  invalidJSON: 'Did not receive JSON response',
  notAvailable: 'Fetch is not available',
  unauthorized: 'Unauthorized request'
};

function parseResponse(response, isErrorResponse) {
  return new Promise(function (resolve, reject) {
    response.json().then(function (parsedResponse) {
      if (isErrorResponse || !parsedResponse.success) {
        return reject(Object.assign({
          message: errorMessages.default
        }, parsedResponse));
      }

      return resolve(parsedResponse);
    }).catch(function (err) {
      var message = err.message.includes('invalid json response body') ? errorMessages.invalidJSON : errorMessages.default;
      return reject(new Error(message));
    });
  });
}

function fetch$1(url) {
  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

  if (!global$1.fetch) {
    throw new Error(errorMessages.notAvailable);
  }

  var _options$retryOptions = options.retryOptions,
      retryOptions = _options$retryOptions === void 0 ? {
    retries: 1,
    retryDelay: 250
  } : _options$retryOptions,
      _options$queryParams = options.queryParams,
      queryParams = _options$queryParams === void 0 ? {} : _options$queryParams,
      authCallback = options.authCallback,
      restOptions = _objectWithoutProperties(options, ["retryOptions", "queryParams", "authCallback"]);

  var queryWithDefaults = _objectSpread$2({
    session_token: getCookieValue('pipe-session-token'),
    strict_mode: true
  }, queryParams);

  var queryString = Object.keys(queryWithDefaults).map(function (key) {
    var value = queryWithDefaults[key];
    return "".concat(key, "=").concat(encodeURIComponent(value));
  }).join('&');
  url += "".concat(url.match(/\?/) ? '&' : '?').concat(queryString);

  var fetchOptions = _objectSpread$2({
    credentials: 'include'
  }, restOptions, {
    headers: _objectSpread$2({
      Accept: 'application/json',
      'Content-Type': 'application/json',
      'Cache-control': 'no-cache',
      Pragma: 'no-cache'
    }, restOptions.headers)
  });

  return new Promise(function (resolve, reject) {
    var retryFetch = function retryFetch() {
      var retriesLeft = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : retryOptions.retries - 1;
      return global$1.fetch(url, fetchOptions).then(function (response) {
        if (response.status === 401) {
          if (typeof authCallback === 'function') {
            authCallback(response);
          } else {
            window.location.assign('/auth/login');
          }

          return reject(new Error(errorMessages.unauthorized));
        }

        if (response.status < 200 || response.status >= 300) {
          return parseResponse(response, true);
        }

        return parseResponse(response);
      }).then(function (parsedResponse) {
        return resolve(parsedResponse);
      }).catch(function (err) {
        if (retriesLeft > 0) {
          setTimeout(function () {
            retryFetch(--retriesLeft);
          }, retryOptions.retryDelay);
        } else {
          if (err instanceof Error && retryOptions.retries > 1) {
            return reject(new Error("Request unsuccessful after ".concat(retryOptions.retries, " retries with error: ").concat(err.message)));
          }

          reject(err);
        }
      });
    };

    retryFetch();
  });
}

var API_PREFIX = '/api/v1/mailbox'; // eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types

function apiDeleteEmail(_x, _x2) {
  return _apiDeleteEmail.apply(this, arguments);
} // eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types

function _apiDeleteEmail() {
  _apiDeleteEmail = asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(messageId, logger) {
    var options;
    return regeneratorRuntime.wrap(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            _context.prev = 0;
            options = {
              method: 'DELETE',
              body: JSON.stringify({
                active_flag: false
              })
            };
            _context.next = 4;
            return fetch$1("".concat(API_PREFIX, "/mailMessages/").concat(messageId), options);

          case 4:
            return _context.abrupt("return", _context.sent);

          case 7:
            _context.prev = 7;
            _context.t0 = _context["catch"](0);
            logger.error('Failed to delete message', _context.t0);
            return _context.abrupt("return", _context.t0);

          case 11:
          case "end":
            return _context.stop();
        }
      }
    }, _callee, null, [[0, 7]]);
  }));
  return _apiDeleteEmail.apply(this, arguments);
}

function apiUnlinkEmail(_x3, _x4) {
  return _apiUnlinkEmail.apply(this, arguments);
} // eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types

function _apiUnlinkEmail() {
  _apiUnlinkEmail = asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(threadId, logger) {
    var options;
    return regeneratorRuntime.wrap(function _callee2$(_context2) {
      while (1) {
        switch (_context2.prev = _context2.next) {
          case 0:
            _context2.prev = 0;
            options = {
              method: 'PUT',
              body: JSON.stringify({
                lead_id: null
              })
            };
            _context2.next = 4;
            return fetch$1("".concat(API_PREFIX, "/mailThreads/").concat(threadId), options);

          case 4:
            return _context2.abrupt("return", _context2.sent);

          case 7:
            _context2.prev = 7;
            _context2.t0 = _context2["catch"](0);
            logger.error('Failed to unlink message', _context2.t0);
            return _context2.abrupt("return", _context2.t0);

          case 11:
          case "end":
            return _context2.stop();
        }
      }
    }, _callee2, null, [[0, 7]]);
  }));
  return _apiUnlinkEmail.apply(this, arguments);
}

function apiGetMessage(_x5, _x6) {
  return _apiGetMessage.apply(this, arguments);
}

function _apiGetMessage() {
  _apiGetMessage = asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3(messageId, logger) {
    return regeneratorRuntime.wrap(function _callee3$(_context3) {
      while (1) {
        switch (_context3.prev = _context3.next) {
          case 0:
            _context3.prev = 0;
            _context3.next = 3;
            return fetch$1("".concat(API_PREFIX, "/mailMessages/").concat(messageId));

          case 3:
            return _context3.abrupt("return", _context3.sent);

          case 6:
            _context3.prev = 6;
            _context3.t0 = _context3["catch"](0);
            logger.error('Failed to get an email message', _context3.t0);
            return _context3.abrupt("return", _context3.t0);

          case 10:
          case "end":
            return _context3.stop();
        }
      }
    }, _callee3, null, [[0, 6]]);
  }));
  return _apiGetMessage.apply(this, arguments);
}

// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types
function apiGetMailConnections() {
  return _apiGetMailConnections.apply(this, arguments);
}

function _apiGetMailConnections() {
  _apiGetMailConnections = asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee4() {
    return regeneratorRuntime.wrap(function _callee4$(_context4) {
      while (1) {
        switch (_context4.prev = _context4.next) {
          case 0:
            _context4.next = 2;
            return fetch$1("".concat(API_PREFIX, "/mailConnections"));

          case 2:
            return _context4.abrupt("return", _context4.sent);

          case 3:
          case "end":
            return _context4.stop();
        }
      }
    }, _callee4);
  }));
  return _apiGetMailConnections.apply(this, arguments);
}

var ConfirmationDialog = function ConfirmationDialog(_ref) {
  var title = _ref.title,
      content = _ref.content,
      confirmButtonText = _ref.confirmButtonText,
      onConfirmHandler = _ref.onConfirmHandler,
      onCloseHandler = _ref.onCloseHandler;
  var translator = Bi();
  return /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Dialog, {
    visible: true,
    title: title,
    actions: /*#__PURE__*/React__default['default'].createElement(React__default['default'].Fragment, null, /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Button, {
      onClick: onCloseHandler
    }, translator.gettext('Cancel')), /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Button, {
      color: "red",
      onClick: onConfirmHandler
    }, confirmButtonText)),
    onClose: onCloseHandler,
    onBackdropClick: onCloseHandler
  }, /*#__PURE__*/React__default['default'].createElement("div", null, content));
};
ConfirmationDialog.displayName = "ConfirmationDialog";

var DeleteConfirmationDialog = function DeleteConfirmationDialog(_ref) {
  var _mailConnections$data, _activeMailConnection;

  var onClose = _ref.onClose,
      onConfirmHandler = _ref.onConfirmHandler;
  var translator = Bi();
  var logger = useLogger();

  var _useAsync = useAsync(function () {
    return apiGetMailConnections();
  }, {
    logger: logger
  }),
      mailConnections = _useAsync.response;

  if (!mailConnections) {
    return null;
  }

  var activeMailConnection = ((_mailConnections$data = mailConnections.data) !== null && _mailConnections$data !== void 0 ? _mailConnections$data : []).filter(function (connection) {
    return connection.disconnect_flag === 0;
  });
  var isDeleteFromProvider = !!((_activeMailConnection = activeMailConnection[0]) !== null && _activeMailConnection !== void 0 && _activeMailConnection.delete_in_origin);
  var deleteTypeTitle = isDeleteFromProvider ? translator.gettext('Are you sure you want to delete this email?') : translator.gettext('Are you sure you want to delete this email from Pipedrive?');
  var deleteTypeContent = isDeleteFromProvider ? translator.gettext('You can’t restore it later. The email will also be deleted from your email client.') : translator.gettext('Deleting this email will remove it from Pipedrive. You can still find it in your email client.');
  return /*#__PURE__*/React__default['default'].createElement(ConfirmationDialog, {
    title: deleteTypeTitle,
    content: deleteTypeContent,
    confirmButtonText: translator.gettext('Delete'),
    onCloseHandler: onClose,
    onConfirmHandler: onConfirmHandler
  });
};
DeleteConfirmationDialog.displayName = "DeleteConfirmationDialog";

var UnlinkConfirmationDialog = function UnlinkConfirmationDialog(_ref) {
  var onClose = _ref.onClose,
      onConfirmHandler = _ref.onConfirmHandler;
  var translator = Bi();
  return /*#__PURE__*/React__default['default'].createElement(ConfirmationDialog, {
    title: translator.gettext('Are you sure you want to unlink this conversation from the lead?'),
    content: translator.gettext('Doing this will unlink all emails included in the conversation.'),
    confirmButtonText: translator.gettext('Unlink'),
    onCloseHandler: onClose,
    onConfirmHandler: onConfirmHandler
  });
};
UnlinkConfirmationDialog.displayName = "UnlinkConfirmationDialog";

var Options = function Options(_ref) {
  var componentLoader = _ref.componentLoader,
      messageId = _ref.messageId,
      threadId = _ref.threadId,
      hasMultipleRecipients = _ref.hasMultipleRecipients;
  var translator = Bi();
  var logger = useLogger();

  var _useState = React.useState(''),
      _useState2 = slicedToArray(_useState, 2),
      snackbarContent = _useState2[0],
      setSnackbarContent = _useState2[1];

  var _useState3 = React.useState(false),
      _useState4 = slicedToArray(_useState3, 2),
      isDialogVisible = _useState4[0],
      setIsDialogVisible = _useState4[1];

  var _useState5 = React.useState(null),
      _useState6 = slicedToArray(_useState5, 2),
      dialogType = _useState6[0],
      setDialogType = _useState6[1];

  var _useState7 = React.useState(false),
      _useState8 = slicedToArray(_useState7, 2),
      isSnackbarVisible = _useState8[0],
      setIsSnackbarVisible = _useState8[1];

  function showSnackbar(message) {
    setSnackbarContent(message);
    setIsSnackbarVisible(true);
  }

  function openThreadModal(_x, _x2) {
    return _openThreadModal.apply(this, arguments);
  }

  function _openThreadModal() {
    _openThreadModal = asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(type, messageData) {
      var modal, params;
      return regeneratorRuntime.wrap(function _callee$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              _context.next = 2;
              return componentLoader.load('froot:modals');

            case 2:
              modal = _context.sent;
              params = {
                threadId: threadId,
                relatedModelType: 'lead',
                metricsData: {
                  'lead-details-email-actions-clicked': type
                }
              };

              if (type === 'reply' || type === 'forward') {
                params = Object.assign(params, {
                  isAddMessageModel: 'true',
                  messageData: messageData,
                  composerOptions: {
                    sendmode: type
                  }
                });
              }

              modal.open('webapp:modal', {
                modal: 'mail/thread',
                params: params
              });

            case 6:
            case "end":
              return _context.stop();
          }
        }
      }, _callee);
    }));
    return _openThreadModal.apply(this, arguments);
  }

  function onEmailReplayForwardClick(_x3) {
    return _onEmailReplayForwardClick.apply(this, arguments);
  }

  function _onEmailReplayForwardClick() {
    _onEmailReplayForwardClick = asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee2(type) {
      var result;
      return regeneratorRuntime.wrap(function _callee2$(_context2) {
        while (1) {
          switch (_context2.prev = _context2.next) {
            case 0:
              _context2.next = 2;
              return apiGetMessage(messageId, logger);

            case 2:
              result = _context2.sent;

              if (!result.success) {
                _context2.next = 5;
                break;
              }

              return _context2.abrupt("return", openThreadModal(type, result.data));

            case 5:
              showSnackbar(translator.gettext('Failed to load message'));

            case 6:
            case "end":
              return _context2.stop();
          }
        }
      }, _callee2);
    }));
    return _onEmailReplayForwardClick.apply(this, arguments);
  }

  function onEmailDeleteClick() {
    return _onEmailDeleteClick.apply(this, arguments);
  }

  function _onEmailDeleteClick() {
    _onEmailDeleteClick = asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee3() {
      var _yield$apiDeleteEmail, success;

      return regeneratorRuntime.wrap(function _callee3$(_context3) {
        while (1) {
          switch (_context3.prev = _context3.next) {
            case 0:
              _context3.next = 2;
              return apiDeleteEmail(messageId, logger);

            case 2:
              _yield$apiDeleteEmail = _context3.sent;
              success = _yield$apiDeleteEmail.success;

              if (success) {
                showSnackbar(translator.gettext('Message has been deleted'));
              } else {
                showSnackbar(translator.gettext('Failed to delete message'));
              }

            case 5:
            case "end":
              return _context3.stop();
          }
        }
      }, _callee3);
    }));
    return _onEmailDeleteClick.apply(this, arguments);
  }

  function onEmailUnlinkClick() {
    return _onEmailUnlinkClick.apply(this, arguments);
  }

  function _onEmailUnlinkClick() {
    _onEmailUnlinkClick = asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee4() {
      var _yield$apiUnlinkEmail, success;

      return regeneratorRuntime.wrap(function _callee4$(_context4) {
        while (1) {
          switch (_context4.prev = _context4.next) {
            case 0:
              _context4.next = 2;
              return apiUnlinkEmail(threadId, logger);

            case 2:
              _yield$apiUnlinkEmail = _context4.sent;
              success = _yield$apiUnlinkEmail.success;

              if (success) {
                showSnackbar(translator.gettext('Message has been unlinked'));
              } else {
                showSnackbar(translator.gettext('Failed to unlink message'));
              }

            case 5:
            case "end":
              return _context4.stop();
          }
        }
      }, _callee4);
    }));
    return _onEmailUnlinkClick.apply(this, arguments);
  }

  function onEmailDeleteUnlinkClick(type) {
    setDialogType(type);
    setIsDialogVisible(true);
  }

  function onDeleteUnlinkConfirmed() {
    setIsDialogVisible(false);

    if (dialogType === 'delete') {
      onEmailDeleteClick();
    } else {
      onEmailUnlinkClick();
    }
  }

  var getPopoverContent = function getPopoverContent() {
    var replyIconType = hasMultipleRecipients ? 'replyall' : 'reply';
    return /*#__PURE__*/React__default['default'].createElement(PopoverContent$1, null, /*#__PURE__*/React__default['default'].createElement(PopoverOption, {
      onClick: function onClick() {
        return onEmailReplayForwardClick('reply');
      }
    }, /*#__PURE__*/React__default['default'].createElement(PopoverOptionIcon, {
      icon: replyIconType,
      size: "s",
      color: "black-88"
    }), translator.gettext('Reply to this email')), /*#__PURE__*/React__default['default'].createElement(PopoverOption, {
      onClick: function onClick() {
        return onEmailReplayForwardClick('forward');
      }
    }, /*#__PURE__*/React__default['default'].createElement(PopoverOptionIcon, {
      icon: "forward",
      size: "s",
      color: "black-88"
    }), translator.gettext('Forward this email')), /*#__PURE__*/React__default['default'].createElement(PopoverOption, {
      isEmptyIcon: true,
      onClick: function onClick() {
        return onEmailDeleteUnlinkClick('delete');
      }
    }, translator.gettext('Delete this email')), /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Separator, null), /*#__PURE__*/React__default['default'].createElement(PopoverOption, {
      isEmptyIcon: true,
      onClick: function onClick() {
        return openThreadModal('viewFullConv');
      }
    }, translator.gettext('View full conversation')), /*#__PURE__*/React__default['default'].createElement(PopoverOption, {
      isEmptyIcon: true,
      onClick: function onClick() {
        return onEmailDeleteUnlinkClick('unlink');
      }
    }, translator.gettext('Unlink this conversation from the lead')));
  };

  return /*#__PURE__*/React__default['default'].createElement(React__default['default'].Fragment, null, /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Popover, {
    placement: "bottom-end",
    spacing: "none",
    content: getPopoverContent
  }, /*#__PURE__*/React__default['default'].createElement(ActionButton, {
    color: "ghost",
    size: "s"
  }, /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Icon, {
    icon: "ellipsis",
    size: "s",
    color: "black-88"
  }))), isDialogVisible && (dialogType === 'delete' ? /*#__PURE__*/React__default['default'].createElement(DeleteConfirmationDialog, {
    onClose: function onClose() {
      return setIsDialogVisible(false);
    },
    onConfirmHandler: onDeleteUnlinkConfirmed
  }) : /*#__PURE__*/React__default['default'].createElement(UnlinkConfirmationDialog, {
    onClose: function onClose() {
      return setIsDialogVisible(false);
    },
    onConfirmHandler: onDeleteUnlinkConfirmed
  })), isSnackbarVisible && /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Snackbar, {
    message: snackbarContent,
    onDismiss: function onDismiss() {
      return setIsSnackbarVisible(false);
    }
  }));
};

var EmailActions = function EmailActions(_ref) {
  var attachments = _ref.attachments,
      componentLoader = _ref.componentLoader,
      hasMultipleRecipients = _ref.hasMultipleRecipients,
      isCollapsed = _ref.isCollapsed,
      isOpenTrackingEnabled = _ref.isOpenTrackingEnabled,
      messageId = _ref.messageId,
      _ref$openEventTimesta = _ref.openEventTimestamps,
      openEventTimestamps = _ref$openEventTimesta === void 0 ? [] : _ref$openEventTimesta,
      threadId = _ref.threadId,
      onCollapsedButtonClick = _ref.onCollapsedButtonClick,
      isOwnerOfTheMessage = _ref.isOwnerOfTheMessage;
  var translator = Bi();
  var wasOpened = openEventTimestamps.length > 0;

  var getTooltipContent = function getTooltipContent() {
    if (wasOpened) {
      var eventsCount = openEventTimestamps.length;
      return /*#__PURE__*/React__default['default'].createElement(TrackingTimestamps, {
        timestamps: openEventTimestamps
      }, translator.ngettext('Opened %d time', 'Opened %d times', eventsCount, eventsCount));
    }

    return /*#__PURE__*/React__default['default'].createElement("div", null, translator.gettext('Not opened yet'));
  };

  return /*#__PURE__*/React__default['default'].createElement(Wrapper$3, null, isOpenTrackingEnabled && /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Tooltip, {
    content: getTooltipContent
  }, /*#__PURE__*/React__default['default'].createElement(TrackingIcon, {
    wasOpened: wasOpened,
    icon: "open-tracking",
    size: "s",
    color: "blue"
  })), /*#__PURE__*/React__default['default'].createElement(ActionButton, {
    color: "ghost",
    size: "s",
    onClick: onCollapsedButtonClick
  }, /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Icon, {
    icon: isCollapsed ? 'expand' : 'collapse',
    size: "s",
    color: "black-88"
  })), /*#__PURE__*/React__default['default'].createElement(Attachments, {
    attachments: attachments
  }), isOwnerOfTheMessage && /*#__PURE__*/React__default['default'].createElement(Options, {
    componentLoader: componentLoader,
    messageId: messageId,
    threadId: threadId,
    hasMultipleRecipients: hasMultipleRecipients
  }));
};
EmailActions.displayName = "EmailActions";

function _templateObject5$7() {
  var data = taggedTemplateLiteral(["\n\tcolor: ", ";\n\ttext-overflow: ellipsis;\n\twhite-space: nowrap;\n\toverflow: hidden;\n"]);

  _templateObject5$7 = function _templateObject5() {
    return data;
  };

  return data;
}

function _templateObject4$7() {
  var data = taggedTemplateLiteral(["\n\tcolor: ", ";\n\ttext-overflow: ellipsis;\n\twhite-space: nowrap;\n\toverflow: hidden;\n"]);

  _templateObject4$7 = function _templateObject4() {
    return data;
  };

  return data;
}

function _templateObject3$9() {
  var data = taggedTemplateLiteral(["\n\tfloat: left;\n\tmargin: 8px 8px 0 0;\n"]);

  _templateObject3$9 = function _templateObject3() {
    return data;
  };

  return data;
}

function _templateObject2$c() {
  var data = taggedTemplateLiteral(["\n\tpadding: 8px;\n\tmax-width: 258px;\n\twidth: calc(33.3333% - 5px);\n\theight: 56px;\n\tbackground: ", ";\n\tborder: 1px solid ", ";\n\tborder-radius: 4px;\n\ttext-decoration: none;\n\tbox-sizing: border-box;\n\tcursor: pointer;\n\n\t&:not(:first-of-type) {\n\t\tmargin-left: 8px;\n\t}\n\n\t&:hover {\n\t\ttext-decoration: none;\n\t\tbox-shadow: ", ";\n\t}\n"]);

  _templateObject2$c = function _templateObject2() {
    return data;
  };

  return data;
}

function _templateObject$d() {
  var data = taggedTemplateLiteral(["\n\tdisplay: flex;\n\tmargin-top: 16px;\n"]);

  _templateObject$d = function _templateObject() {
    return data;
  };

  return data;
}
var AttachmentsWrapper = styled__default['default'].div(_templateObject$d());
var AttachmentButton = styled__default['default'].a(_templateObject2$c(), variables_4.black4, variables_4.black12, variables_2.elevation01);
var Icon = styled__default['default'](conventionUiReact.Icon)(_templateObject3$9());
var FileName = styled__default['default'].div(_templateObject4$7(), variables_4.black);
var FileSize = styled__default['default'].div(_templateObject5$7(), variables_4.black64);

/**
 * Get human readable file size like: "24 kB", "2.5MB"
 * taken from: https://github.com/pipedrive/webapp/blob/c3c49bda13ab2d2b9face1d2dffe58ce0b6df143/pipedrive/app/utils/helpers.js#L90
 * @param  {Number} size 	file size in bytes
 * @return {String} human readable file size like: "24 kB", "2.5MB"
 */
// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types
function getReadableFileSize(size) {
  if (Number.isNaN(size)) {
    return '';
  } // http://stackoverflow.com/questions/10420352/converting-file-size-in-bytes-to-human-readable


  var i = size === 0 ? size : Math.floor(Math.log(size) / Math.log(1024));
  var suffix = ['B', 'kB', 'MB', 'GB', 'TB'][i];
  var readableSize = (size / Math.pow(1024, i)).toFixed(2);
  return "".concat(readableSize, " ").concat(suffix);
}

var SingleAttachment = function SingleAttachment(_ref) {
  var name = _ref.name,
      size = _ref.size,
      url = _ref.url,
      type = _ref.type;

  var _useState = React.useState(false),
      _useState2 = slicedToArray(_useState, 2),
      imageOverlayVisible = _useState2[0],
      setImageOverlayVisible = _useState2[1]; // url for direct downloading the attachment


  var parsedUrl = url || '';
  var downloadUrl = getUrl(parsedUrl, {
    direct_download: 1
  });
  var isImage = type === 'img';

  var closeOverlay = function closeOverlay() {
    return setImageOverlayVisible(false);
  };

  var showImageOverlay = function showImageOverlay(event) {
    if (isImage) {
      event.preventDefault();
      setImageOverlayVisible(true);
    }
  };

  return /*#__PURE__*/React__default['default'].createElement(React__default['default'].Fragment, null, /*#__PURE__*/React__default['default'].createElement(AttachmentButton, {
    key: parsedUrl,
    href: downloadUrl,
    onClick: showImageOverlay
  }, /*#__PURE__*/React__default['default'].createElement(Icon, {
    icon: "attach",
    color: "blue"
  }), /*#__PURE__*/React__default['default'].createElement(React__default['default'].Fragment, null, /*#__PURE__*/React__default['default'].createElement(FileName, null, name), /*#__PURE__*/React__default['default'].createElement(FileSize, null, size ? getReadableFileSize(size) : null))), isImage && /*#__PURE__*/React__default['default'].createElement(conventionUiReact.ImageOverlay, {
    visible: imageOverlayVisible,
    onClose: closeOverlay,
    src: downloadUrl,
    alt: name !== null && name !== void 0 ? name : '',
    title: name !== null && name !== void 0 ? name : ''
  }));
};

var Attachments$1 = function Attachments(_ref2) {
  var isCollapsed = _ref2.isCollapsed,
      attachments = _ref2.attachments;

  if (isCollapsed || !attachments.length) {
    return null;
  }

  return /*#__PURE__*/React__default['default'].createElement(AttachmentsWrapper, null, attachments.map(function (attachment) {
    return /*#__PURE__*/React__default['default'].createElement(SingleAttachment, _extends_1({
      key: attachment.url
    }, attachment));
  }));
};
Attachments$1.displayName = "Attachments";

function _templateObject$e() {
  var data = taggedTemplateLiteral(["\n\tmargin-top: 6px;\n"]);

  _templateObject$e = function _templateObject() {
    return data;
  };

  return data;
}
var Wrapper$4 = styled__default['default'].div(_templateObject$e());
var BlockQuote = function BlockQuote(_ref) {
  var content = _ref.content;

  var _useState = React.useState(false),
      _useState2 = slicedToArray(_useState, 2),
      showBlockQuote = _useState2[0],
      setShowBlockQuote = _useState2[1];

  var toggleBlockQuote = function toggleBlockQuote() {
    return setShowBlockQuote(!showBlockQuote);
  };

  return /*#__PURE__*/React__default['default'].createElement(React__default['default'].Fragment, null, /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Button, {
    size: "s",
    onClick: toggleBlockQuote
  }, /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Icon, {
    icon: "ellipsis",
    style: {
      margin: 0
    }
  })), showBlockQuote && /*#__PURE__*/React__default['default'].createElement(Wrapper$4, {
    dangerouslySetInnerHTML: {
      __html: content
    }
  }));
};

function _templateObject3$a() {
  var data = taggedTemplateLiteral(["\n\ttext-align: center;\n"]);

  _templateObject3$a = function _templateObject3() {
    return data;
  };

  return data;
}

function _templateObject2$d() {
  var data = taggedTemplateLiteral(["\n\ttext-overflow: ellipsis;\n\twhite-space: nowrap;\n\toverflow: hidden;\n"]);

  _templateObject2$d = function _templateObject2() {
    return data;
  };

  return data;
}

function _templateObject$f() {
  var data = taggedTemplateLiteral(["\n\tmargin-top: ", ";\n"]);

  _templateObject$f = function _templateObject() {
    return data;
  };

  return data;
}
var MessageBodyWrapper = styled__default['default'].div(_templateObject$f(), function (_ref) {
  var isCollapsed = _ref.isCollapsed;
  return isCollapsed ? '8px' : '24px';
});
var CollapsedMessageBody = styled__default['default'].div(_templateObject2$d());
var CenteredSpinnerWrapper = styled__default['default'].div(_templateObject3$a());

// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types
var getTrackingPortalId = function getTrackingPortalId(emailId, index) {
  return "tp-".concat(emailId, "-").concat(index);
};
var handleBodyTrackingEvents = function handleBodyTrackingEvents(bodyStr, emailId) {
  var bodyDocument = document.implementation.createHTMLDocument('bodyDocument');
  var bodyContainer = bodyDocument.createElement('div');
  bodyContainer.innerHTML = bodyStr;
  var anchors = bodyContainer.querySelectorAll('[data-pipedrive-original-href]');
  anchors.forEach(function (el, key) {
    var originalHref = el.dataset.pipedriveOriginalHref; // Replace internal tracking URLs

    el.href = originalHref !== null && originalHref !== void 0 ? originalHref : ''; // Add dynamic portal to each matched link

    var portal = document.createElement('span');
    portal.setAttribute('id', getTrackingPortalId(emailId, key));
    el.appendChild(portal);
  });
  return [bodyContainer.innerHTML, anchors.length];
};

function _templateObject3$b() {
  var data = taggedTemplateLiteral(["\n\tmargin: 2px;\n\tdisplay: inline-block;\n\twidth: 8px;\n\theight: 8px;\n\tborder-radius: 7.5px;\n\tbox-sizing: border-box;\n\tvertical-align: top;\n\n\t", "\n"]);

  _templateObject3$b = function _templateObject3() {
    return data;
  };

  return data;
}

function _templateObject2$e() {
  var data = taggedTemplateLiteral(["\n\tborder: 2px solid ", ";\n\topacity: 0.64;\n"]);

  _templateObject2$e = function _templateObject2() {
    return data;
  };

  return data;
}

function _templateObject$g() {
  var data = taggedTemplateLiteral(["\n\tbackground-color: ", ";\n"]);

  _templateObject$g = function _templateObject() {
    return data;
  };

  return data;
}
var trackedStyles = styled.css(_templateObject$g(), variables_4.blue);
var unTrackedStyles = styled.css(_templateObject2$e(), variables_4.blue);
var TrackingBubble = styled__default['default'].span(_templateObject3$b(), function (_ref) {
  var _ref$hasTrackings = _ref.hasTrackings,
      hasTrackings = _ref$hasTrackings === void 0 ? false : _ref$hasTrackings;
  return hasTrackings ? trackedStyles : unTrackedStyles;
});
var TrackingTooltip = function TrackingTooltip(_ref2) {
  var trackingEvent = _ref2.trackingEvent;
  var t = Bi();

  if (trackingEvent) {
    return /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Tooltip, {
      content: /*#__PURE__*/React__default['default'].createElement(TrackingTimestamps, {
        timestamps: trackingEvent.timestamps
      }, t.ngettext('Clicked %d time', 'Clicked %d times', trackingEvent.timestamps.length, trackingEvent.timestamps.length))
    }, /*#__PURE__*/React__default['default'].createElement("span", null, /*#__PURE__*/React__default['default'].createElement(TrackingBubble, {
      hasTrackings: true
    })));
  }

  return /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Tooltip, {
    content: t.gettext('Not clicked yet')
  }, /*#__PURE__*/React__default['default'].createElement("span", null, /*#__PURE__*/React__default['default'].createElement(TrackingBubble, null)));
};
TrackingTooltip.displayName = "TrackingTooltip";

var TrackingPortals = function TrackingPortals(_ref) {
  var emailId = _ref.emailId,
      trackingEvents = _ref.trackingEvents,
      linksLength = _ref.linksLength;
  var indexes = React.useMemo(function () {
    return Array.from(Array(linksLength).keys());
  }, [linksLength]);
  return /*#__PURE__*/React__default['default'].createElement(React__default['default'].Fragment, null, indexes.map(function (idx) {
    var trackingEvent = trackingEvents.get(idx);
    var element = document.getElementById(getTrackingPortalId(emailId, idx));

    if (!element) {
      return null;
    }

    return /*#__PURE__*/ReactDOM__default['default'].createPortal( /*#__PURE__*/React__default['default'].createElement(TrackingTooltip, {
      trackingEvent: trackingEvent || null
    }), element);
  }));
};

// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types
var addOpenLinksInNewTab = function addOpenLinksInNewTab(bodyStr) {
  var bodyDocument = document.implementation.createHTMLDocument('bodyDocument');
  var bodyContainer = bodyDocument.createElement('div');
  bodyContainer.innerHTML = bodyStr;
  bodyContainer.querySelectorAll('a').forEach(function (link) {
    if (link.href.match(/^https?:\/\//)) {
      link.target = '_blank';
      link.rel = 'noreferrer noopener';
    }
  });
  return bodyContainer.innerHTML;
};

/**
 * Copied from https://github.com/pipedrive/webapp/blob/4ec9ca32a96436c53fd9bcc730d39092f98cb2fa/pipedrive/app/components/mail-components/message/body/body.js#L236
 *
 * With createLinks method handle url's in body, which appear as strings
 */

var createLinksInBody = function createLinksInBody(bodyStr, params) {
  return createLinks(bodyStr, {
    noEscape: true,
    openEmailsInNewTab: params.openEmailsInNewTab,
    openLinksInNewTab: true,
    fullUrlsOnly: true
  });
};

var getBlockQuoteElement = function getBlockQuoteElement(body) {
  var bodyDocument = document.implementation.createHTMLDocument('bodyDocument');
  var bodyContainer = bodyDocument.createElement('div');
  bodyContainer.innerHTML = body;
  var blockQuoteElement = bodyContainer.querySelector('div[data-type=blockQuoteWrapper]');
  return {
    blockQuoteElement: blockQuoteElement,
    bodyContainer: bodyContainer
  };
};

var getBlockQuoteInnerHTML = function getBlockQuoteInnerHTML(body) {
  var _getBlockQuoteElement = getBlockQuoteElement(body),
      blockQuoteElement = _getBlockQuoteElement.blockQuoteElement;

  if (blockQuoteElement === null) {
    return null;
  }

  return blockQuoteElement.innerHTML;
};
var getBodyHTMLWithoutBlockQuote = function getBodyHTMLWithoutBlockQuote(body) {
  var _getBlockQuoteElement2 = getBlockQuoteElement(body),
      blockQuoteElement = _getBlockQuoteElement2.blockQuoteElement,
      bodyContainer = _getBlockQuoteElement2.bodyContainer;

  if (blockQuoteElement !== null) {
    blockQuoteElement.remove();
  }

  return bodyContainer.innerHTML;
};

/**
 * Copied from https://github.com/pipedrive/webapp/blob/4ec9ca32a96436c53fd9bcc730d39092f98cb2fa/pipedrive/app/components/mail-components/message/body/body.js#L214
 *
 * Handles the Elastic and non-Elastic inline attachments' html tags in a html-string - turns the src attributes
 * to data-pipecid attributes, cleans the contents of the src attributes in case of Elastic attachments.
 *
 * The story:
 * We pull inline attachments asynchronously. So, the body is first pulled with the src attributes filled with the
 * attachments' cids. This would give errors as the browser expects the src to be an url or something. That for we
 * turn the src attributes into data-pipecid attributes. Later, once the attachments get pulled, the view has to
 * find the img-tags in DOM by the data-pipecid attributes and add the correct urls into the src attributes.
 *
 * Examples:
 * Elastic <img src="cid:###file_id=12345678###">
 * Non-Elastic <img src="cid:12345678">
 *
 */
var handleBodyInlineAttachSrcs = function handleBodyInlineAttachSrcs(bodyStr) {
  // Elastic
  var regexp = /src="cid:###file_id=(\w+)###"/gi;
  var match = regexp.exec(bodyStr);

  while (match) {
    bodyStr = bodyStr.replace(match[0], "data-pipecid=\"".concat(match[1], "\""));
    match = regexp.exec(bodyStr);
  } // non-Elastic


  bodyStr = bodyStr.replace(/ src="cid:/g, ' data-pipecid="');
  return bodyStr;
};

function ownKeys$2(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread$3(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys$2(Object(source), true).forEach(function (key) { defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys$2(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }
var mapInlineAttachment = function mapInlineAttachment(item) {
  return _objectSpread$3(_objectSpread$3({}, item), {}, {
    cid: item.cid.replace(/<|>|cid:/gi, ''),
    url: getUrl(item.url)
  });
};

// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types
var placeInlineAttachments = function placeInlineAttachments(bodyStr, inlineAttachments) {
  var bodyDocument = document.implementation.createHTMLDocument('bodyDocument');
  var bodyContainer = bodyDocument.createElement('div');
  bodyContainer.innerHTML = bodyStr;
  inlineAttachments.forEach(function (attachment) {
    bodyContainer.querySelectorAll("[data-pipecid=\"".concat(attachment.cid, "\"]")).forEach(function (el) {
      el.removeAttribute('data-pipecid');

      if (attachment.url) {
        el.src = attachment.url;
      }
    });
  });
  return bodyContainer.innerHTML;
};

/**
 * Copied from https://github.com/pipedrive/webapp/blob/4ec9ca32a96436c53fd9bcc730d39092f98cb2fa/pipedrive/app/utils/mail/helpers.js#L32
 */
// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types
var removeOpenTrackingPixels = function removeOpenTrackingPixels(bodyStr, params) {
  var bodyDocument = document.implementation.createHTMLDocument('bodyDocument');
  var bodyContainer = bodyDocument.createElement('div');
  bodyContainer.innerHTML = bodyStr;

  var isNylasTrackingUrl = function isNylasTrackingUrl(url) {
    return ['api.nylas.com/open', 'nyl.as/open'].some(function (trackingUrl) {
      return url.includes(trackingUrl);
    });
  };

  var isPipemailerTrackingUrl = function isPipemailerTrackingUrl(url) {
    return url.includes("".concat(params.emailTrackingDomain, "/o"));
  };

  bodyContainer.querySelectorAll('img').forEach(function (img) {
    var imgUrl = img.src || '';

    if (isNylasTrackingUrl(imgUrl) || isPipemailerTrackingUrl(imgUrl)) {
      img.remove();
    }
  });
  return bodyContainer.innerHTML;
};

var MessageBody = function MessageBody(_ref) {
  var bodyUrl = _ref.bodyUrl,
      emailId = _ref.emailId,
      inlineAttachments = _ref.inlineAttachments,
      isCollapsed = _ref.isCollapsed,
      isLinkTrackingEnabled = _ref.isLinkTrackingEnabled,
      snippet = _ref.snippet,
      trackingEvents = _ref.trackingEvents;
  var logger = useLogger();
  var translator = Bi();

  var _useState = React.useState(''),
      _useState2 = slicedToArray(_useState, 2),
      body = _useState2[0],
      setBody = _useState2[1];

  var _useState3 = React.useState(false),
      _useState4 = slicedToArray(_useState3, 2),
      hasError = _useState4[0],
      setHasError = _useState4[1];

  var _useState5 = React.useState(false),
      _useState6 = slicedToArray(_useState5, 2),
      isLoading = _useState6[0],
      setIsLoading = _useState6[1];

  var _useState7 = React.useState(0),
      _useState8 = slicedToArray(_useState7, 2),
      linksLength = _useState8[0],
      setLinksLength = _useState8[1];

  var _useState9 = React.useState(null),
      _useState10 = slicedToArray(_useState9, 2),
      divElement = _useState10[0],
      setDivElement = _useState10[1];

  var setRef = React.useCallback(function (node) {
    setDivElement(node);
  }, []);
  React.useEffect(function () {
    if (!isCollapsed && !body && bodyUrl) {
      setIsLoading(true);
      setHasError(false);
      fetch(bodyUrl).then(function (res) {
        return res.text();
      }).then(setBody)["catch"](function (err) {
        logger.error('Could not fetch an email message body', err);
        setHasError(true);
      })["finally"](function () {
        return setIsLoading(false);
      });
    }
  }, [isCollapsed]);

  var _useMemo = React.useMemo(function () {
    var processedBody = body; // @TODO: correct params for processing of the body according to the user settings

    processedBody = handleBodyInlineAttachSrcs(processedBody);
    processedBody = createLinksInBody(processedBody, {
      openEmailsInNewTab: true
    });
    processedBody = removeOpenTrackingPixels(processedBody, {
      emailTrackingDomain: 'pipedrive.email'
    });
    processedBody = addOpenLinksInNewTab(processedBody);
    processedBody = placeInlineAttachments(processedBody, inlineAttachments.map(mapInlineAttachment));

    if (trackingEvents) {
      var _handleBodyTrackingEv = handleBodyTrackingEvents(processedBody, emailId),
          _handleBodyTrackingEv2 = slicedToArray(_handleBodyTrackingEv, 2),
          bodyWithPortals = _handleBodyTrackingEv2[0],
          length = _handleBodyTrackingEv2[1];

      processedBody = bodyWithPortals;
      setLinksLength(length);
    }

    var blockQuote = getBlockQuoteInnerHTML(processedBody);
    var bodyWithoutBlockQuote = getBodyHTMLWithoutBlockQuote(processedBody);
    return {
      blockQuote: blockQuote,
      bodyWithoutBlockQuote: bodyWithoutBlockQuote
    };
  }, [body]),
      blockQuote = _useMemo.blockQuote,
      bodyWithoutBlockQuote = _useMemo.bodyWithoutBlockQuote;

  var renderTrackingPortals = isLinkTrackingEnabled && divElement && Boolean(linksLength);
  return /*#__PURE__*/React__default['default'].createElement(MessageBodyWrapper, {
    isCollapsed: isCollapsed
  }, isCollapsed ? /*#__PURE__*/React__default['default'].createElement(CollapsedMessageBody, null, snippet) : /*#__PURE__*/React__default['default'].createElement("div", null, hasError ? /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Message, {
    visible: true,
    color: "red",
    size: "s",
    alignCenter: true
  }, translator.gettext('Failed to load the message body')) : /*#__PURE__*/React__default['default'].createElement(React__default['default'].Fragment, null, isLoading ? /*#__PURE__*/React__default['default'].createElement(CenteredSpinnerWrapper, null, /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Spinner, {
    size: "l"
  })) : /*#__PURE__*/React__default['default'].createElement(React__default['default'].Fragment, null, /*#__PURE__*/React__default['default'].createElement("div", {
    dangerouslySetInnerHTML: {
      __html: bodyWithoutBlockQuote
    },
    ref: setRef
  }), blockQuote && /*#__PURE__*/React__default['default'].createElement(BlockQuote, {
    content: blockQuote
  }), renderTrackingPortals && /*#__PURE__*/React__default['default'].createElement(TrackingPortals, {
    emailId: emailId,
    trackingEvents: trackingEvents,
    linksLength: linksLength
  })))));
};
MessageBody.displayName = "MessageBody";

function _templateObject8$3() {
  var data = taggedTemplateLiteral(["\n\tmargin-left: 4px;\n"]);

  _templateObject8$3 = function _templateObject8() {
    return data;
  };

  return data;
}

function _templateObject7$5() {
  var data = taggedTemplateLiteral(["\n\tmargin-left: ", ";\n\tcolor: ", ";\n\n\t", "\n"]);

  _templateObject7$5 = function _templateObject7() {
    return data;
  };

  return data;
}

function _templateObject6$7() {
  var data = taggedTemplateLiteral(["\n\t&:hover {\n\t\tcolor: ", ";\n\t\tcursor: pointer;\n\t}\n"]);

  _templateObject6$7 = function _templateObject6() {
    return data;
  };

  return data;
}

function _templateObject5$8() {
  var data = taggedTemplateLiteral(["\n\tmargin-top: 4px;\n\ttext-overflow: inherit;\n\toverflow: inherit;\n"]);

  _templateObject5$8 = function _templateObject5() {
    return data;
  };

  return data;
}

function _templateObject4$8() {
  var data = taggedTemplateLiteral(["\n\tcolor: ", ";\n"]);

  _templateObject4$8 = function _templateObject4() {
    return data;
  };

  return data;
}

function _templateObject3$c() {
  var data = taggedTemplateLiteral(["\n\tmargin-left: 4px;\n"]);

  _templateObject3$c = function _templateObject3() {
    return data;
  };

  return data;
}

function _templateObject2$f() {
  var data = taggedTemplateLiteral(["\n\tmargin: 0 8px;\n"]);

  _templateObject2$f = function _templateObject2() {
    return data;
  };

  return data;
}

function _templateObject$h() {
  var data = taggedTemplateLiteral(["\n\tmargin-top: 4px;\n\tcolor: ", ";\n\tfont-size: ", ";\n\ttext-overflow: ellipsis;\n\twhite-space: nowrap;\n\toverflow: hidden;\n"]);

  _templateObject$h = function _templateObject() {
    return data;
  };

  return data;
}
var Wrapper$5 = styled__default['default'].div(_templateObject$h(), variables_4.black64, variables_3.fontSizeS);
var DotDivider$1 = styled__default['default'].span(_templateObject2$f());
var ArrowDivider = styled__default['default'].span(_templateObject3$c());
var Date$1 = styled__default['default'].span(_templateObject4$8(), variables_4.black64);
var RecipientRow = styled__default['default'].div(_templateObject5$8());
var hoverCSS$1 = styled.css(_templateObject6$7(), variables_4.blue);
var Recipient = styled__default['default'].span(_templateObject7$5(), function (_ref) {
  var isEmail = _ref.isEmail;
  return isEmail ? '4px' : '0';
}, function (_ref2) {
  var isBlack = _ref2.isBlack;
  return isBlack ? variables_4.black : variables_4.black64;
}, function (_ref3) {
  var displayHover = _ref3.displayHover;
  return displayHover && hoverCSS$1;
});
var RecipientLabel = styled__default['default'].span(_templateObject8$3());

// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types
function useQuickInfoCard() {
  var logger = useLogger();
  var componentLoader = useComponentLoader();

  var _useState = React.useState(null),
      _useState2 = slicedToArray(_useState, 2),
      QuickInfoCard = _useState2[0],
      setQuickInfoCard = _useState2[1];

  React__default['default'].useEffect(function () {
    var fetchQuickInfoCard = /*#__PURE__*/function () {
      var _ref = asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee() {
        var _yield$componentLoade, QuickInfoCardComponent;

        return regeneratorRuntime.wrap(function _callee$(_context) {
          while (1) {
            switch (_context.prev = _context.next) {
              case 0:
                if (!componentLoader) {
                  _context.next = 6;
                  break;
                }

                _context.next = 3;
                return componentLoader.load('quick-info-card');

              case 3:
                _yield$componentLoade = _context.sent;
                QuickInfoCardComponent = _yield$componentLoade["default"];
                // eslint-disable-next-line react/display-name
                setQuickInfoCard(function () {
                  return function (props) {
                    return /*#__PURE__*/React__default['default'].createElement(QuickInfoCardComponent, _extends_1({
                      logger: logger
                    }, props));
                  };
                });

              case 6:
              case "end":
                return _context.stop();
            }
          }
        }, _callee);
      }));

      return function fetchQuickInfoCard() {
        return _ref.apply(this, arguments);
      };
    }();

    fetchQuickInfoCard();
  }, [componentLoader]);
  return QuickInfoCard;
}

var QuickInfoCardWrapper = function QuickInfoCardWrapper(_ref) {
  var _recipient$person;

  var children = _ref.children,
      recipient = _ref.recipient;
  var QuickInfoCard = useQuickInfoCard();
  var isValidElement = /*#__PURE__*/React__default['default'].isValidElement(children);

  if (!QuickInfoCard || !isValidElement) {
    return /*#__PURE__*/React__default['default'].createElement(React__default['default'].Fragment, null, children);
  }

  var isLinkedPerson = recipient.person;
  var personParams = {
    type: 'person',
    id: (_recipient$person = recipient.person) === null || _recipient$person === void 0 ? void 0 : _recipient$person.id
  };
  var addNewPersonParams = {
    type: 'addNewPerson',
    data: {
      name: recipient.name,
      email: recipient.email
    }
  };
  var params = isLinkedPerson ? personParams : addNewPersonParams;
  var popoverProps = {
    portalTo: document.body,
    placement: 'bottom'
  };
  return /*#__PURE__*/React__default['default'].createElement(QuickInfoCard, _extends_1({
    source: "flow_email",
    popoverProps: popoverProps
  }, params), children);
};

QuickInfoCardWrapper.displayName = "QuickInfoCardWrapper";

var RecipientsCategory = function RecipientsCategory(_ref) {
  var label = _ref.label,
      recipients = _ref.recipients,
      isCollapsed = _ref.isCollapsed;

  if (!recipients.length) {
    return null;
  }

  if (isCollapsed) {
    return /*#__PURE__*/React__default['default'].createElement(React__default['default'].Fragment, null, /*#__PURE__*/React__default['default'].createElement(RecipientLabel, null, label, ": "), recipients.map(function (recipient, index) {
      var isMoreItems = ++index < recipients.length;
      return /*#__PURE__*/React__default['default'].createElement("span", {
        key: recipient.email
      }, /*#__PURE__*/React__default['default'].createElement(QuickInfoCardWrapper, {
        recipient: recipient
      }, /*#__PURE__*/React__default['default'].createElement("span", null, /*#__PURE__*/React__default['default'].createElement(Recipient, {
        displayHover: true
      }, recipient.name), isMoreItems && /*#__PURE__*/React__default['default'].createElement("span", null, ", "))));
    }));
  }

  return /*#__PURE__*/React__default['default'].createElement(RecipientRow, null, /*#__PURE__*/React__default['default'].createElement("span", null, label, ": "), recipients.map(function (recipient, index) {
    var isMoreItems = ++index < recipients.length;
    return /*#__PURE__*/React__default['default'].createElement("span", {
      key: recipient.email
    }, /*#__PURE__*/React__default['default'].createElement(QuickInfoCardWrapper, {
      recipient: recipient
    }, /*#__PURE__*/React__default['default'].createElement("span", null, /*#__PURE__*/React__default['default'].createElement(Recipient, {
      isBlack: true,
      displayHover: true
    }, recipient.name))), /*#__PURE__*/React__default['default'].createElement(Recipient, {
      isEmail: true
    }, recipient.email), isMoreItems && /*#__PURE__*/React__default['default'].createElement("span", null, ", "));
  }));
};
RecipientsCategory.displayName = "RecipientsCategory";

var Recipients = function Recipients(_ref) {
  var isCollapsed = _ref.isCollapsed,
      recipientCategories = _ref.recipientCategories,
      date = _ref.date;
  var translator = Bi();

  var _useLocale = useLocale(),
      getFullDateTime = _useLocale.getFullDateTime;

  var labels = {
    from: translator.gettext('From'),
    to: translator.gettext('To'),
    cc: translator.gettext('Cc'),
    bcc: translator.gettext('Bcc')
  };
  var recipientFrom = recipientCategories.from[0];
  return /*#__PURE__*/React__default['default'].createElement(Wrapper$5, null, /*#__PURE__*/React__default['default'].createElement(Date$1, null, date && getFullDateTime(date)), isCollapsed ? /*#__PURE__*/React__default['default'].createElement(React__default['default'].Fragment, null, /*#__PURE__*/React__default['default'].createElement(DotDivider$1, null, "\xB7"), recipientFrom && /*#__PURE__*/React__default['default'].createElement(React__default['default'].Fragment, null, /*#__PURE__*/React__default['default'].createElement(QuickInfoCardWrapper, {
    recipient: recipientFrom
  }, /*#__PURE__*/React__default['default'].createElement("span", null, /*#__PURE__*/React__default['default'].createElement(Recipient, {
    displayHover: true
  }, recipientFrom.name))), /*#__PURE__*/React__default['default'].createElement(ArrowDivider, null, "\u279D")), /*#__PURE__*/React__default['default'].createElement(RecipientsCategory, {
    isCollapsed: isCollapsed,
    label: labels.to,
    recipients: recipientCategories.to
  }), /*#__PURE__*/React__default['default'].createElement(RecipientsCategory, {
    isCollapsed: isCollapsed,
    label: labels.cc,
    recipients: recipientCategories.cc
  }), /*#__PURE__*/React__default['default'].createElement(RecipientsCategory, {
    isCollapsed: isCollapsed,
    label: labels.bcc,
    recipients: recipientCategories.bcc
  })) : /*#__PURE__*/React__default['default'].createElement(React__default['default'].Fragment, null, /*#__PURE__*/React__default['default'].createElement(RecipientsCategory, {
    isCollapsed: isCollapsed,
    label: labels.from,
    recipients: recipientCategories.from
  }), /*#__PURE__*/React__default['default'].createElement(RecipientsCategory, {
    isCollapsed: isCollapsed,
    label: labels.to,
    recipients: recipientCategories.to
  }), /*#__PURE__*/React__default['default'].createElement(RecipientsCategory, {
    isCollapsed: isCollapsed,
    label: labels.cc,
    recipients: recipientCategories.cc
  }), /*#__PURE__*/React__default['default'].createElement(RecipientsCategory, {
    isCollapsed: isCollapsed,
    label: labels.bcc,
    recipients: recipientCategories.bcc
  })));
};
Recipients.displayName = "Recipients";

function _templateObject2$g() {
  var data = taggedTemplateLiteral(["\n\tfont-weight: ", ";\n\ttext-overflow: ellipsis;\n\twhite-space: nowrap;\n\toverflow: hidden;\n"]);

  _templateObject2$g = function _templateObject2() {
    return data;
  };

  return data;
}

function _templateObject$i() {
  var data = taggedTemplateLiteral(["\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n"]);

  _templateObject$i = function _templateObject() {
    return data;
  };

  return data;
}
var MessageHeader = styled__default['default'].div(_templateObject$i());
var MessageTitle = styled__default['default'].div(_templateObject2$g(), variables_3.fontWeightBold);

var SentEmail = function SentEmail(_ref) {
  var children = _ref.children,
      messageTitle = _ref.messageTitle;

  var _useComponentChildren = useComponentChildren(children, ['EmailActions', 'Recipients', 'MessageBody', 'Attachments']),
      EmailActions = _useComponentChildren.EmailActions,
      Recipients = _useComponentChildren.Recipients,
      Attachments = _useComponentChildren.Attachments,
      MessageBody = _useComponentChildren.MessageBody;

  return /*#__PURE__*/React__default['default'].createElement(ItemBox, {
    iconType: "email",
    isDone: true
  }, /*#__PURE__*/React__default['default'].createElement(MessageHeader, null, /*#__PURE__*/React__default['default'].createElement(MessageTitle, null, messageTitle), EmailActions), Recipients, MessageBody, Attachments);
};
SentEmail.displayName = "SentEmail";

function _templateObject2$h() {
  var data = taggedTemplateLiteral(["\n\tcolor: ", ";\n\tfont-size: ", ";\n\tfont-weight: ", ";\n\tborder: none;\n\tbackground: none;\n\toutline: none;\n\tcursor: pointer;\n\tpadding-bottom: 15px;\n"]);

  _templateObject2$h = function _templateObject2() {
    return data;
  };

  return data;
}

function _templateObject$j() {
  var data = taggedTemplateLiteral(["\n\ttext-align: center;\n"]);

  _templateObject$j = function _templateObject() {
    return data;
  };

  return data;
}
var Wrapper$6 = styled__default['default'].div(_templateObject$j());
var Button = styled__default['default'].button(_templateObject2$h(), variables_4.blue, variables_3.fontSizeS, variables_3.fontWeightBold);
var FallbackButton = function FallbackButton(_ref) {
  var onClick = _ref.onClick;
  var translator = Bi();
  return /*#__PURE__*/React.createElement(Wrapper$6, null, /*#__PURE__*/React.createElement(Button, {
    "data-testid": "ListInfiniteScrollLoadMoreButton",
    onClick: onClick
  }, translator.gettext('Load more')));
};
FallbackButton.displayName = "FallbackButton";

function _templateObject$k() {
  var data = taggedTemplateLiteral(["\n\tdisplay: flex;\n\tjustify-content: center;\n\talign-items: center;\n\tpadding: 0 15px 15px;\n\n\t.cui4-spinner {\n\t\tmargin-right: 10px;\n\t}\n"]);

  _templateObject$k = function _templateObject() {
    return data;
  };

  return data;
}
var Wrapper$7 = styled__default['default'].div(_templateObject$k());
var MoreItemsLoader = function MoreItemsLoader() {
  var translator = Bi();
  return /*#__PURE__*/React__default['default'].createElement(Wrapper$7, null, /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Spinner, {
    size: "s"
  }), translator.gettext('Loading more items…'));
};
MoreItemsLoader.displayName = "MoreItemsLoader";

var ListInfiniteScroll = function ListInfiniteScroll(_ref) {
  var children = _ref.children,
      loadingThreshold = _ref.loadingThreshold,
      paginationHandler = _ref.paginationHandler,
      scrollContainerRef = _ref.scrollContainerRef;

  var _useState = React.useState(false),
      _useState2 = slicedToArray(_useState, 2),
      isLoading = _useState2[0],
      setIsLoading = _useState2[1];

  var scrollContainer = scrollContainerRef.current;
  var listRef = React.useRef(null);
  var loadMore = React.useCallback(function () {
    setIsLoading(true);
    paginationHandler.loadMore(function () {
      setIsLoading(false);
    });
  }, [paginationHandler]);
  React.useEffect(function () {
    function scrollHandler() {
      if (!listRef.current) {
        return;
      }

      var _listRef$current$getB = listRef.current.getBoundingClientRect(),
          bottom = _listRef$current$getB.bottom;

      var bottomWithThreshold = bottom - window.innerHeight - loadingThreshold;

      if (bottomWithThreshold <= 0) {
        if (!paginationHandler.isLoading() && paginationHandler.hasMore()) {
          loadMore();
        }
      }
    }

    scrollContainer === null || scrollContainer === void 0 ? void 0 : scrollContainer.addEventListener('scroll', scrollHandler);
    return function () {
      return scrollContainer === null || scrollContainer === void 0 ? void 0 : scrollContainer.removeEventListener('scroll', scrollHandler);
    };
  }, [listRef.current, loadMore, paginationHandler, scrollContainer]);
  return /*#__PURE__*/React__default['default'].createElement("div", {
    ref: listRef
  }, children, isLoading ? /*#__PURE__*/React__default['default'].createElement(MoreItemsLoader, null) : // this is a fallback for too large screens (or when scroll event listener fails)
  paginationHandler.hasMore() && /*#__PURE__*/React__default['default'].createElement(FallbackButton, {
    onClick: function onClick() {
      return loadMore();
    }
  }));
};
ListInfiniteScroll.displayName = "ListInfiniteScroll";

function _templateObject2$i() {
  var data = taggedTemplateLiteral(["\n\tmargin: 8px 0;\n"]);

  _templateObject2$i = function _templateObject2() {
    return data;
  };

  return data;
}

function _templateObject$l() {
  var data = taggedTemplateLiteral(["\n\tmargin-left: 8px;\n\n\t& svg.cui4-icon {\n\t\tfill: ", ";\n\t}\n"]);

  _templateObject$l = function _templateObject() {
    return data;
  };

  return data;
}
var ActionButton$1 = styled__default['default'](conventionUiReact.Button)(_templateObject$l(), variables_4.black88);
var PopoverContent$2 = styled__default['default'].div(_templateObject2$i());

var NoteActions = function NoteActions(_ref) {
  var pinnedToLead = _ref.pinnedToLead,
      isCollapsed = _ref.isCollapsed,
      onCollapsedButtonClick = _ref.onCollapsedButtonClick,
      onToggleEditNoteClick = _ref.onToggleEditNoteClick,
      onTogglePinNoteClick = _ref.onTogglePinNoteClick,
      onDeleteNoteClick = _ref.onDeleteNoteClick;
  var translator = Bi();

  var getPopoverContent = function getPopoverContent() {
    return /*#__PURE__*/React__default['default'].createElement(React__default['default'].Fragment, null, /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Option, {
      onClick: onToggleEditNoteClick
    }, translator.gettext('Edit')), pinnedToLead ? /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Option, {
      onClick: onTogglePinNoteClick
    }, translator.gettext('Unpin this note')) : /*#__PURE__*/React__default['default'].createElement(React__default['default'].Fragment, null, /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Option, {
      onClick: onTogglePinNoteClick
    }, translator.gettext('Pin this note')), /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Option, {
      onClick: onDeleteNoteClick
    }, translator.gettext('Delete'))));
  };

  return /*#__PURE__*/React__default['default'].createElement(React__default['default'].Fragment, null, /*#__PURE__*/React__default['default'].createElement(ActionButton$1, {
    color: "ghost",
    size: "s",
    onClick: onCollapsedButtonClick
  }, /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Icon, {
    icon: isCollapsed ? 'expand' : 'collapse',
    size: "s",
    color: "black-88"
  })), /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Dropmenu, {
    popoverProps: {
      placement: 'bottom-end'
    },
    content: getPopoverContent,
    closeOnClick: true
  }, /*#__PURE__*/React__default['default'].createElement(ActionButton$1, {
    color: "ghost",
    size: "s"
  }, /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Icon, {
    icon: "ellipsis",
    size: "s",
    color: "black-88"
  }))));
};

var hasDefinedArguments = function hasDefinedArguments(arg1, arg2) {
  return arg1 && arg2;
};

var NoteDetail = function NoteDetail(_ref) {
  var createdAt = _ref.createdAt,
      owner = _ref.owner;

  var _useLocale = useLocale(),
      getFullDateTime = _useLocale.getFullDateTime;

  return /*#__PURE__*/React__default['default'].createElement(NoteDetails, null, createdAt && getFullDateTime(createdAt), hasDefinedArguments(createdAt, owner) && /*#__PURE__*/React__default['default'].createElement(DotDivider, null, "\xB7"), owner && /*#__PURE__*/React__default['default'].createElement("span", null, owner));
};
NoteDetail.displayName = "NoteDetail";

var NoteContent$1 = function NoteContent(_ref) {
  var children = _ref.children,
      note = _ref.note,
      createdAt = _ref.createdAt,
      owner = _ref.owner,
      onSaveNoteClick = _ref.onSaveNoteClick,
      onDeleteNoteClick = _ref.onDeleteNoteClick,
      onPinNoteClick = _ref.onPinNoteClick,
      isPinned = _ref.isPinned;

  var _useState = React.useState(true),
      _useState2 = slicedToArray(_useState, 2),
      isCollapsed = _useState2[0],
      setIsCollapsed = _useState2[1];

  var _useState3 = React.useState(false),
      _useState4 = slicedToArray(_useState3, 2),
      showWysiwygEditor = _useState4[0],
      setShowWysiwygEditor = _useState4[1];

  var toggleCollapsed = function toggleCollapsed() {
    setIsCollapsed(!isCollapsed);
  };

  var toggleEdit = function toggleEdit() {
    setShowWysiwygEditor(!showWysiwygEditor);
  };

  var saveHandler = /*#__PURE__*/function () {
    var _ref2 = asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(note) {
      return regeneratorRuntime.wrap(function _callee$(_context) {
        while (1) {
          switch (_context.prev = _context.next) {
            case 0:
              _context.next = 2;
              return onSaveNoteClick(note);

            case 2:
              setIsCollapsed(true);
              setShowWysiwygEditor(false);

            case 4:
            case "end":
              return _context.stop();
          }
        }
      }, _callee);
    }));

    return function saveHandler(_x) {
      return _ref2.apply(this, arguments);
    };
  }();

  return /*#__PURE__*/React__default['default'].createElement(React__default['default'].Fragment, null, !showWysiwygEditor && /*#__PURE__*/React__default['default'].createElement(NoteHeader, null, /*#__PURE__*/React__default['default'].createElement(NoteDetail, {
    createdAt: createdAt,
    owner: owner
  }), /*#__PURE__*/React__default['default'].createElement(NoteActions, {
    isCollapsed: isCollapsed,
    onCollapsedButtonClick: toggleCollapsed,
    onDeleteNoteClick: onDeleteNoteClick,
    onToggleEditNoteClick: toggleEdit,
    onTogglePinNoteClick: onPinNoteClick,
    pinnedToLead: isPinned !== null && isPinned !== void 0 ? isPinned : false
  }), children), /*#__PURE__*/React__default['default'].createElement(NoteEditor, {
    isCollapsed: isCollapsed,
    note: note !== null && note !== void 0 ? note : '',
    onSaveNoteClick: saveHandler,
    onToggleEditNoteClick: toggleEdit,
    showWysiwygEditor: showWysiwygEditor
  }));
};

var Note$1 = function Note(props) {
  return /*#__PURE__*/React__default['default'].createElement(ItemBox, {
    iconType: "note",
    isDone: true,
    background: "note"
  }, /*#__PURE__*/React__default['default'].createElement(NoteContent$1, props));
};
Note$1.displayName = "Note";

var PinnedNote = function PinnedNote(props) {
  return /*#__PURE__*/React__default['default'].createElement(NotePinned, null, /*#__PURE__*/React__default['default'].createElement(NoteContent$1, props));
};
PinnedNote.displayName = "PinnedNote";

var FlowItemsSection = function FlowItemsSection(_ref) {
  var _ref$barType = _ref.barType,
      barType = _ref$barType === void 0 ? 'none' : _ref$barType,
      children = _ref.children,
      title = _ref.title;
  return /*#__PURE__*/React__default['default'].createElement(FlowWrapper, {
    barType: barType
  }, /*#__PURE__*/React__default['default'].createElement(TitleWrapper, null, /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Pill, {
    size: "s"
  }, title)), children);
};
FlowItemsSection.displayName = "FlowItemsSection";

function _templateObject2$j() {
  var data = taggedTemplateLiteral(["\n\tfont-size: ", ";\n\tfont-weight: ", ";\n\tline-height: ", ";\n"]);

  _templateObject2$j = function _templateObject2() {
    return data;
  };

  return data;
}

function _templateObject$m() {
  var data = taggedTemplateLiteral(["\n\tcolor: ", ";\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tmargin-bottom: 12px;\n"]);

  _templateObject$m = function _templateObject() {
    return data;
  };

  return data;
}
var Wrapper$8 = styled__default['default'].div(_templateObject$m(), variables_4.black);
var Title$2 = styled__default['default'].p(_templateObject2$j(), variables_3.fontSizeS, variables_3.fontWeightNormal, variables_3.lineHeightM);

var NoActivityMessage = function NoActivityMessage() {
  var translator = Bi();
  return /*#__PURE__*/React__default['default'].createElement(Wrapper$8, null, /*#__PURE__*/React__default['default'].createElement(Title$2, {
    "data-testid": "NoActivityTitle"
  }, translator.gettext('You have no upcoming activities.')));
};
NoActivityMessage.displayName = "NoActivityMessage";

/**
 * This essentially behaves like `useState` from React except it additionally persist the values
 * into local storage. Usage:
 *
 * ```
 * const [storedValue, setStoredValue] = useLocalStorage(
 * 		'storedValueKey',
 * 		'initialStoredValue' ?? null,
 * );
 * ```
 *
 * @see https://usehooks.com/useLocalStorage/
 */

function useLocalStorage(key, initialValue) {
  var prefixedKey = "pd:flow:".concat(key);

  var _useState = React.useState(function () {
    try {
      var item = window.localStorage.getItem(prefixedKey);
      return item ? JSON.parse(item) : initialValue;
    } catch (_unused) {
      return initialValue;
    }
  }),
      _useState2 = slicedToArray(_useState, 2),
      storedValue = _useState2[0],
      setStoredValue = _useState2[1];

  var setValue = function setValue(value) {
    try {
      var valueToStore = value instanceof Function ? value(storedValue) : value;
      setStoredValue(valueToStore);
      window.localStorage.setItem(prefixedKey, JSON.stringify(valueToStore));
    } catch (_unused2) {// nevermind
    }
  };

  var clearValue = function clearValue() {
    window.localStorage.removeItem(prefixedKey);
  };

  return [storedValue, setValue, clearValue];
}

function _templateObject10$1() {
  var data = taggedTemplateLiteral(["\n\tcolor: ", ";\n\tfont-size: ", ";\n\tfont-weight: ", ";\n\tborder: none;\n\tbackground: none;\n\toutline: none;\n\ttext-align: left;\n\tcursor: pointer;\n\tpadding: 0;\n\tmargin-left: 12px;\n\theight: 24px;\n\tdisplay: inline-flex;\n\tjustify-content: center;\n\talign-items: center;\n\ttext-align: center;\n"]);

  _templateObject10$1 = function _templateObject10() {
    return data;
  };

  return data;
}

function _templateObject9$1() {
  var data = taggedTemplateLiteral(["\n\t", "\n"]);

  _templateObject9$1 = function _templateObject9() {
    return data;
  };

  return data;
}

function _templateObject8$4() {
  var data = taggedTemplateLiteral(["\n\tmargin-left: 8px;\n\tdisplay: inline-block;\n\twidth: 100%;\n"]);

  _templateObject8$4 = function _templateObject8() {
    return data;
  };

  return data;
}

function _templateObject7$6() {
  var data = taggedTemplateLiteral(["\n\t", "\n\tmargin-left: 4px;\n\n\t&:first-of-type {\n\t\tmargin-left: 0;\n\t}\n"]);

  _templateObject7$6 = function _templateObject7() {
    return data;
  };

  return data;
}

function _templateObject6$8() {
  var data = taggedTemplateLiteral(["\n\tmargin-top: 4px;\n\ttext-align: right;\n\tmargin-left: 52px;\n\tdisplay: flex;\n\tjustify-content: space-between;\n"]);

  _templateObject6$8 = function _templateObject6() {
    return data;
  };

  return data;
}

function _templateObject5$9() {
  var data = taggedTemplateLiteral(["\n\tmax-width: 240px;\n\twhite-space: nowrap;\n\toverflow: hidden;\n\ttext-overflow: ellipsis;\n\tbox-sizing: border-box;\n\tpadding-right: 16px;\n\n\t.cui4-select__box & {\n\t\tdisplay: none;\n\t}\n"]);

  _templateObject5$9 = function _templateObject5() {
    return data;
  };

  return data;
}

function _templateObject4$9() {
  var data = taggedTemplateLiteral(["\n\tdisplay: inline-block;\n\n\t.cui4-select--open {\n\t\t.cui4-select__box {\n\t\t\tbackground: ", ";\n\t\t}\n\n\t\t.cui4-select__options {\n\t\t\tmax-height: 400px;\n\t\t}\n\t}\n\n\t.cui4-select__box {\n\t\tbackground: ", ";\n\t\tbox-shadow: none;\n\t\tborder: none;\n\t\tpadding: 3px 4px 3px 6px;\n\t\tcursor: pointer;\n\t\t", "\n\n\t\t& > span {\n\t\t\tdisplay: flex;\n\t\t}\n\n\t\t.cui4-select__toggle {\n\t\t\tmargin-left: 2px;\n\t\t}\n\t}\n\n\t.cui4-option {\n\t\tdisplay: flex;\n\t\talign-items: center;\n\n\t\tsvg {\n\t\t\tmargin-right: 10px;\n\t\t}\n\t}\n"]);

  _templateObject4$9 = function _templateObject4() {
    return data;
  };

  return data;
}

function _templateObject3$d() {
  var data = taggedTemplateLiteral(["\n\tdisplay: flex;\n\tjustify-content: flex-start;\n"]);

  _templateObject3$d = function _templateObject3() {
    return data;
  };

  return data;
}

function _templateObject2$k() {
  var data = taggedTemplateLiteral(["\n\tpadding: 12px;\n\tbackground-color: ", ";\n\tdisplay: flex;\n\talign-self: center;\n\tmin-width: 310px;\n\tmax-width: 561px;\n\tbox-sizing: border-box;\n\tflex-direction: column;\n\t", "\n"]);

  _templateObject2$k = function _templateObject2() {
    return data;
  };

  return data;
}

function _templateObject$n() {
  var data = taggedTemplateLiteral(["\n\tborder-radius: 4px;\n"]);

  _templateObject$n = function _templateObject() {
    return data;
  };

  return data;
}
var sharedRadius = styled.css(_templateObject$n());
var Container = styled__default['default'].div(_templateObject2$k(), variables_4.black4, sharedRadius);
var SelectWrapper = styled__default['default'].div(_templateObject3$d());
var SelectHolder = styled__default['default'].div(_templateObject4$9(), variables_4.black12, variables_4.black4, sharedRadius);
var OptionText = styled__default['default'].p(_templateObject5$9());
var Buttons = styled__default['default'].div(_templateObject6$8());
var ButtonWithBorder = styled__default['default'](conventionUiReact.Button)(_templateObject7$6(), sharedRadius);
var InputWrapper = styled__default['default'].div(_templateObject8$4());
var InputHolder = styled__default['default'](conventionUiReact.Input)(_templateObject9$1(), sharedRadius);
var ButtonLink = styled__default['default'].button(_templateObject10$1(), variables_4.blue, variables_3.fontSizeS, variables_3.fontWeightBold);

// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types
function UpcomingQuickActivities(_ref) {
  var _activityTypes$;

  var activityTypes = _ref.activityTypes,
      timeOptions = _ref.timeOptions,
      isCreateQuickActivityPending = _ref.isCreateQuickActivityPending,
      addCustomActivity = _ref.addCustomActivity,
      addQuickActivity = _ref.addQuickActivity;
  var translator = Bi();

  var _useLocalStorage = useLocalStorage('selectedActivityType', (_activityTypes$ = activityTypes === null || activityTypes === void 0 ? void 0 : activityTypes[0]) !== null && _activityTypes$ !== void 0 ? _activityTypes$ : null),
      _useLocalStorage2 = slicedToArray(_useLocalStorage, 2),
      selectedActivityType = _useLocalStorage2[0],
      selectActivityType = _useLocalStorage2[1];

  var _useState = React.useState(null),
      _useState2 = slicedToArray(_useState, 2),
      selectedTimePeriod = _useState2[0],
      setSelectedTimePeriod = _useState2[1];

  var _useState3 = React.useState(null),
      _useState4 = slicedToArray(_useState3, 2),
      newQuickActivityName = _useState4[0],
      setNewQuickActivityName = _useState4[1];

  if (selectedActivityType == null) {
    return null;
  }

  var handleActivityNameChange = function handleActivityNameChange(e) {
    setNewQuickActivityName(e.currentTarget.value);
  };

  var resetActivityName = function resetActivityName() {
    setNewQuickActivityName(null);
  };

  var handleOnClick = function handleOnClick(timePeriod) {
    setSelectedTimePeriod(timePeriod);
    addQuickActivity({
      scheduledTime: timePeriod,
      name: newQuickActivityName,
      resetActivityName: resetActivityName,
      activityTypeId: selectedActivityType === null || selectedActivityType === void 0 ? void 0 : selectedActivityType.id
    });
  };

  var handleSelectActivity = function handleSelectActivity(activityId) {
    var activity = activityTypes === null || activityTypes === void 0 ? void 0 : activityTypes.find(function (activity) {
      return (activity === null || activity === void 0 ? void 0 : activity.id) === activityId;
    });

    if (activity) {
      selectActivityType(activity);
    }
  };

  return /*#__PURE__*/React__default['default'].createElement(Container, null, /*#__PURE__*/React__default['default'].createElement(SelectWrapper, null, /*#__PURE__*/React__default['default'].createElement(SelectHolder, null, /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Select, {
    size: "s",
    onChange: handleSelectActivity,
    value: selectedActivityType === null || selectedActivityType === void 0 ? void 0 : selectedActivityType.id
  }, activityTypes === null || activityTypes === void 0 ? void 0 : activityTypes.map(function (type) {
    return /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Select.Option, {
      value: type === null || type === void 0 ? void 0 : type.id,
      key: type === null || type === void 0 ? void 0 : type.id
    }, /*#__PURE__*/React__default['default'].createElement(conventionUiReact.Icon, {
      icon: "ac-".concat(type === null || type === void 0 ? void 0 : type.iconKey),
      size: "s"
    }), /*#__PURE__*/React__default['default'].createElement(OptionText, null, type === null || type === void 0 ? void 0 : type.name));
  }))), /*#__PURE__*/React__default['default'].createElement(InputWrapper, null, /*#__PURE__*/React__default['default'].createElement(InputHolder, {
    "data-testid": "QuickActivitiesInput",
    placeholder: selectedActivityType === null || selectedActivityType === void 0 ? void 0 : selectedActivityType.name,
    size: "s",
    value: newQuickActivityName !== null && newQuickActivityName !== void 0 ? newQuickActivityName : '',
    onChange: handleActivityNameChange
  }))), /*#__PURE__*/React__default['default'].createElement(Buttons, {
    "data-testid": "QuickActivitiesButtons"
  }, timeOptions.map(function (_ref2) {
    var value = _ref2.value,
        text = _ref2.text;
    return /*#__PURE__*/React__default['default'].createElement(ButtonWithBorder, {
      key: value,
      size: "s",
      onClick: function onClick() {
        return handleOnClick(value);
      },
      disabled: isCreateQuickActivityPending,
      loading: selectedTimePeriod === value && isCreateQuickActivityPending
    }, text);
  }), /*#__PURE__*/React__default['default'].createElement(ButtonLink, {
    onClick: addCustomActivity
  }, translator.gettext('+ Other'))));
}
UpcomingQuickActivities.displayName = "UpcomingQuickActivities";

var fe$1 = createCommonjsModule(function (module, exports) {
/*! For license information please see fe.js.LICENSE.txt */
!function(t,e){module.exports=e();}(self,(function(){return (()=>{var t={8276:(t,e,r)=>{const n=r(1045),i=r(143);t.exports=async function(t,e,r){if("object"!=typeof window)throw Error("Cannot create a translator instance unless we are in the browser");if("object"==typeof t){const n=t;t=n.serviceName,e=n.language,r=n.logger;}let o="";try{if((t=>"en"===t||"en-US"===t||"function"!=typeof fetch)(e))return new n;"function"==typeof r&&(r=r(t)),o=((t,e,{assetsDomain:r="pipedriveassets.com",cacheTag:n="latest",services:{[t]:{cacheSum:i="latest"}={}}={}}={})=>`https://cdn.${r}/translator-hub/${t}/${e}?v=${n}&langv=${i}`)(t,e,window.pdTranslatorConfig);const s=await(async t=>{let e;try{e=await fetch(t);}catch(r){e=await fetch(t);}if(!e.ok)throw new i(await e.text(),e);return e.json()})(o);return new n(s)}catch(i){return "object"==typeof r&&r.logError&&r.logError(i,"Failed building translations client","error",{serviceName:t,hubUrl:o,requestedLanguage:e,errMessage:i&&"object"==typeof i?i.message:`*translator-client unknown error* "${typeof i}"`}),new n}};},143:t=>{t.exports=class extends Error{constructor(t="FetchError",{status:e,statusText:r}={}){super(`${t}. Status: ${e} (${r})`),this.name="FetchError",this.status=e,this.statusText=r;}};},1045:(t,e,r)=>{r(5306),r(3948);const n=r(2353);function i(t={}){this.options=t,this.jed=new n(this.options);}i.prototype.setOptions=function(t){"object"==typeof t&&(this.options=t,this.jed=new n(this.options));},i.prototype.getOptions=function(){return this.options},i.prototype.getLanguage=function(){const t=(((this.options||{}).locale_data||{}).messages||{})[""]||{};return t.lang&&"string"==typeof t.lang?t.lang:null},i.prototype.getPdLanguage=function(){const t=this.getLanguage();return t?t.replace("_","-"):t},i.prototype.getJed=function(){return this.jed},i.prototype.translate=function(t,e,...r){const n=r[e];return void 0===n?this.jed[t].apply(this.jed,r):this.sprintf(this.jed[t].apply(this.jed,r),n)},i.prototype.gettext=function(...t){return this.translate("gettext",1,...t)},i.prototype.dgettext=function(...t){return this.translate("dgettext",2,...t)},i.prototype.dcgettext=function(...t){return this.translate("dcgettext",3,...t)},i.prototype.ngettext=function(...t){return this.translate("ngettext",3,...t)},i.prototype.dngettext=function(...t){return this.translate("dngettext",4,...t)},i.prototype.dcngettext=function(...t){return this.translate("dcngettext",5,...t)},i.prototype.pgettext=function(...t){return this.translate("pgettext",2,...t)},i.prototype.dpgettext=function(...t){return this.translate("dpgettext",3,...t)},i.prototype.npgettext=function(...t){return this.translate("npgettext",4,...t)},i.prototype.dnpgettext=function(...t){return this.translate("dnpgettext",5,...t)},i.prototype.dcnpgettext=function(...t){return this.translate("dcnpgettext",5,...t)},i.prototype.sprintf=function(...t){try{return this.jed.sprintf.apply(this.jed,t)}catch(e){return "function"==typeof this.options.onError&&this.options.onError(e,t),t[0]}},t.exports=i;},6077:(t,e,r)=>{var n=r(111);t.exports=function(t){if(!n(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype");return t};},1223:(t,e,r)=>{var n=r(5112),i=r(30),o=r(3070),s=n("unscopables"),a=Array.prototype;null==a[s]&&o.f(a,s,{configurable:!0,value:i(null)}),t.exports=function(t){a[s][t]=!0;};},1530:(t,e,r)=>{var n=r(8710).charAt;t.exports=function(t,e,r){return e+(r?n(t,e).length:1)};},9670:(t,e,r)=>{var n=r(111);t.exports=function(t){if(!n(t))throw TypeError(String(t)+" is not an object");return t};},1318:(t,e,r)=>{var n=r(5656),i=r(7466),o=r(1400),s=function(t){return function(e,r,s){var a,c=n(e),u=i(c.length),l=o(s,u);if(t&&r!=r){for(;u>l;)if((a=c[l++])!=a)return !0}else for(;u>l;l++)if((t||l in c)&&c[l]===r)return t||l||0;return !t&&-1}};t.exports={includes:s(!0),indexOf:s(!1)};},4326:t=>{var e={}.toString;t.exports=function(t){return e.call(t).slice(8,-1)};},9920:(t,e,r)=>{var n=r(6656),i=r(3887),o=r(1236),s=r(3070);t.exports=function(t,e){for(var r=i(e),a=s.f,c=o.f,u=0;u<r.length;u++){var l=r[u];n(t,l)||a(t,l,c(e,l));}};},8544:(t,e,r)=>{var n=r(7293);t.exports=!n((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}));},4994:(t,e,r)=>{var n=r(3383).IteratorPrototype,i=r(30),o=r(9114),s=r(8003),a=r(7497),c=function(){return this};t.exports=function(t,e,r){var u=e+" Iterator";return t.prototype=i(n,{next:o(1,r)}),s(t,u,!1,!0),a[u]=c,t};},8880:(t,e,r)=>{var n=r(9781),i=r(3070),o=r(9114);t.exports=n?function(t,e,r){return i.f(t,e,o(1,r))}:function(t,e,r){return t[e]=r,t};},9114:t=>{t.exports=function(t,e){return {enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}};},654:(t,e,r)=>{var n=r(2109),i=r(4994),o=r(9518),s=r(7674),a=r(8003),c=r(8880),u=r(1320),l=r(5112),p=r(1913),f=r(7497),h=r(3383),g=h.IteratorPrototype,y=h.BUGGY_SAFARI_ITERATORS,d=l("iterator"),x="keys",v="values",m="entries",b=function(){return this};t.exports=function(t,e,r,l,h,w,_){i(r,e,l);var E,S,P,O=function(t){if(t===h&&A)return A;if(!y&&t in T)return T[t];switch(t){case x:case v:case m:return function(){return new r(this,t)}}return function(){return new r(this)}},k=e+" Iterator",j=!1,T=t.prototype,F=T[d]||T["@@iterator"]||h&&T[h],A=!y&&F||O(h),I="Array"==e&&T.entries||F;if(I&&(E=o(I.call(new t)),g!==Object.prototype&&E.next&&(p||o(E)===g||(s?s(E,g):"function"!=typeof E[d]&&c(E,d,b)),a(E,k,!0,!0),p&&(f[k]=b))),h==v&&F&&F.name!==v&&(j=!0,A=function(){return F.call(this)}),p&&!_||T[d]===A||c(T,d,A),f[e]=A,h)if(S={values:O(v),keys:w?A:O(x),entries:O(m)},_)for(P in S)(y||j||!(P in T))&&u(T,P,S[P]);else n({target:e,proto:!0,forced:y||j},S);return S};},9781:(t,e,r)=>{var n=r(7293);t.exports=!n((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}));},317:(t,e,r)=>{var n=r(7854),i=r(111),o=n.document,s=i(o)&&i(o.createElement);t.exports=function(t){return s?o.createElement(t):{}};},8324:t=>{t.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0};},8113:(t,e,r)=>{var n=r(5005);t.exports=n("navigator","userAgent")||"";},7392:(t,e,r)=>{var n,i,o=r(7854),s=r(8113),a=o.process,c=a&&a.versions,u=c&&c.v8;u?i=(n=u.split("."))[0]<4?1:n[0]+n[1]:s&&(!(n=s.match(/Edge\/(\d+)/))||n[1]>=74)&&(n=s.match(/Chrome\/(\d+)/))&&(i=n[1]),t.exports=i&&+i;},748:t=>{t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"];},2109:(t,e,r)=>{var n=r(7854),i=r(1236).f,o=r(8880),s=r(1320),a=r(3505),c=r(9920),u=r(4705);t.exports=function(t,e){var r,l,p,f,h,g=t.target,y=t.global,d=t.stat;if(r=y?n:d?n[g]||a(g,{}):(n[g]||{}).prototype)for(l in e){if(f=e[l],p=t.noTargetGet?(h=i(r,l))&&h.value:r[l],!u(y?l:g+(d?".":"#")+l,t.forced)&&void 0!==p){if(typeof f==typeof p)continue;c(f,p);}(t.sham||p&&p.sham)&&o(f,"sham",!0),s(r,l,f,t);}};},7293:t=>{t.exports=function(t){try{return !!t()}catch(t){return !0}};},7007:(t,e,r)=>{r(4916);var n=r(1320),i=r(2261),o=r(7293),s=r(5112),a=r(8880),c=s("species"),u=RegExp.prototype;t.exports=function(t,e,r,l){var p=s(t),f=!o((function(){var e={};return e[p]=function(){return 7},7!=""[t](e)})),h=f&&!o((function(){var e=!1,r=/a/;return "split"===t&&((r={}).constructor={},r.constructor[c]=function(){return r},r.flags="",r[p]=/./[p]),r.exec=function(){return e=!0,null},r[p](""),!e}));if(!f||!h||r){var g=/./[p],y=e(p,""[t],(function(t,e,r,n,o){var s=e.exec;return s===i||s===u.exec?f&&!o?{done:!0,value:g.call(e,r,n)}:{done:!0,value:t.call(r,e,n)}:{done:!1}}));n(String.prototype,t,y[0]),n(u,p,y[1]);}l&&a(u[p],"sham",!0);};},5005:(t,e,r)=>{var n=r(857),i=r(7854),o=function(t){return "function"==typeof t?t:void 0};t.exports=function(t,e){return arguments.length<2?o(n[t])||o(i[t]):n[t]&&n[t][e]||i[t]&&i[t][e]};},647:(t,e,r)=>{var n=r(7908),i=Math.floor,o="".replace,s=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,a=/\$([$&'`]|\d{1,2})/g;t.exports=function(t,e,r,c,u,l){var p=r+t.length,f=c.length,h=a;return void 0!==u&&(u=n(u),h=s),o.call(l,h,(function(n,o){var s;switch(o.charAt(0)){case"$":return "$";case"&":return t;case"`":return e.slice(0,r);case"'":return e.slice(p);case"<":s=u[o.slice(1,-1)];break;default:var a=+o;if(0===a)return n;if(a>f){var l=i(a/10);return 0===l?n:l<=f?void 0===c[l-1]?o.charAt(1):c[l-1]+o.charAt(1):n}s=c[a-1];}return void 0===s?"":s}))};},7854:(t,e,r)=>{var n=function(t){return t&&t.Math==Math&&t};t.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof r.g&&r.g)||function(){return this}()||Function("return this")();},6656:(t,e,r)=>{var n=r(7908),i={}.hasOwnProperty;t.exports=Object.hasOwn||function(t,e){return i.call(n(t),e)};},3501:t=>{t.exports={};},490:(t,e,r)=>{var n=r(5005);t.exports=n("document","documentElement");},4664:(t,e,r)=>{var n=r(9781),i=r(7293),o=r(317);t.exports=!n&&!i((function(){return 7!=Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a}));},8361:(t,e,r)=>{var n=r(7293),i=r(4326),o="".split;t.exports=n((function(){return !Object("z").propertyIsEnumerable(0)}))?function(t){return "String"==i(t)?o.call(t,""):Object(t)}:Object;},2788:(t,e,r)=>{var n=r(5465),i=Function.toString;"function"!=typeof n.inspectSource&&(n.inspectSource=function(t){return i.call(t)}),t.exports=n.inspectSource;},9909:(t,e,r)=>{var n,i,o,s=r(8536),a=r(7854),c=r(111),u=r(8880),l=r(6656),p=r(5465),f=r(6200),h=r(3501),g="Object already initialized",y=a.WeakMap;if(s||p.state){var d=p.state||(p.state=new y),x=d.get,v=d.has,m=d.set;n=function(t,e){if(v.call(d,t))throw new TypeError(g);return e.facade=t,m.call(d,t,e),e},i=function(t){return x.call(d,t)||{}},o=function(t){return v.call(d,t)};}else {var b=f("state");h[b]=!0,n=function(t,e){if(l(t,b))throw new TypeError(g);return e.facade=t,u(t,b,e),e},i=function(t){return l(t,b)?t[b]:{}},o=function(t){return l(t,b)};}t.exports={set:n,get:i,has:o,enforce:function(t){return o(t)?i(t):n(t,{})},getterFor:function(t){return function(e){var r;if(!c(e)||(r=i(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return r}}};},4705:(t,e,r)=>{var n=r(7293),i=/#|\.prototype\./,o=function(t,e){var r=a[s(t)];return r==u||r!=c&&("function"==typeof e?n(e):!!e)},s=o.normalize=function(t){return String(t).replace(i,".").toLowerCase()},a=o.data={},c=o.NATIVE="N",u=o.POLYFILL="P";t.exports=o;},111:t=>{t.exports=function(t){return "object"==typeof t?null!==t:"function"==typeof t};},1913:t=>{t.exports=!1;},3383:(t,e,r)=>{var n,i,o,s=r(7293),a=r(9518),c=r(8880),u=r(6656),l=r(5112),p=r(1913),f=l("iterator"),h=!1;[].keys&&("next"in(o=[].keys())?(i=a(a(o)))!==Object.prototype&&(n=i):h=!0);var g=null==n||s((function(){var t={};return n[f].call(t)!==t}));g&&(n={}),p&&!g||u(n,f)||c(n,f,(function(){return this})),t.exports={IteratorPrototype:n,BUGGY_SAFARI_ITERATORS:h};},7497:t=>{t.exports={};},133:(t,e,r)=>{var n=r(7392),i=r(7293);t.exports=!!Object.getOwnPropertySymbols&&!i((function(){var t=Symbol();return !String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&n&&n<41}));},8536:(t,e,r)=>{var n=r(7854),i=r(2788),o=n.WeakMap;t.exports="function"==typeof o&&/native code/.test(i(o));},30:(t,e,r)=>{var n,i=r(9670),o=r(6048),s=r(748),a=r(3501),c=r(490),u=r(317),l=r(6200)("IE_PROTO"),p=function(){},f=function(t){return "<script>"+t+"<\/script>"},h=function(){try{n=document.domain&&new ActiveXObject("htmlfile");}catch(t){}var t,e;h=n?function(t){t.write(f("")),t.close();var e=t.parentWindow.Object;return t=null,e}(n):((e=u("iframe")).style.display="none",c.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(f("document.F=Object")),t.close(),t.F);for(var r=s.length;r--;)delete h.prototype[s[r]];return h()};a[l]=!0,t.exports=Object.create||function(t,e){var r;return null!==t?(p.prototype=i(t),r=new p,p.prototype=null,r[l]=t):r=h(),void 0===e?r:o(r,e)};},6048:(t,e,r)=>{var n=r(9781),i=r(3070),o=r(9670),s=r(1956);t.exports=n?Object.defineProperties:function(t,e){o(t);for(var r,n=s(e),a=n.length,c=0;a>c;)i.f(t,r=n[c++],e[r]);return t};},3070:(t,e,r)=>{var n=r(9781),i=r(4664),o=r(9670),s=r(7593),a=Object.defineProperty;e.f=n?a:function(t,e,r){if(o(t),e=s(e,!0),o(r),i)try{return a(t,e,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return "value"in r&&(t[e]=r.value),t};},1236:(t,e,r)=>{var n=r(9781),i=r(5296),o=r(9114),s=r(5656),a=r(7593),c=r(6656),u=r(4664),l=Object.getOwnPropertyDescriptor;e.f=n?l:function(t,e){if(t=s(t),e=a(e,!0),u)try{return l(t,e)}catch(t){}if(c(t,e))return o(!i.f.call(t,e),t[e])};},8006:(t,e,r)=>{var n=r(6324),i=r(748).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return n(t,i)};},5181:(t,e)=>{e.f=Object.getOwnPropertySymbols;},9518:(t,e,r)=>{var n=r(6656),i=r(7908),o=r(6200),s=r(8544),a=o("IE_PROTO"),c=Object.prototype;t.exports=s?Object.getPrototypeOf:function(t){return t=i(t),n(t,a)?t[a]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?c:null};},6324:(t,e,r)=>{var n=r(6656),i=r(5656),o=r(1318).indexOf,s=r(3501);t.exports=function(t,e){var r,a=i(t),c=0,u=[];for(r in a)!n(s,r)&&n(a,r)&&u.push(r);for(;e.length>c;)n(a,r=e[c++])&&(~o(u,r)||u.push(r));return u};},1956:(t,e,r)=>{var n=r(6324),i=r(748);t.exports=Object.keys||function(t){return n(t,i)};},5296:(t,e)=>{var r={}.propertyIsEnumerable,n=Object.getOwnPropertyDescriptor,i=n&&!r.call({1:2},1);e.f=i?function(t){var e=n(this,t);return !!e&&e.enumerable}:r;},7674:(t,e,r)=>{var n=r(9670),i=r(6077);t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,r={};try{(t=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(r,[]),e=r instanceof Array;}catch(t){}return function(r,o){return n(r),i(o),e?t.call(r,o):r.__proto__=o,r}}():void 0);},3887:(t,e,r)=>{var n=r(5005),i=r(8006),o=r(5181),s=r(9670);t.exports=n("Reflect","ownKeys")||function(t){var e=i.f(s(t)),r=o.f;return r?e.concat(r(t)):e};},857:(t,e,r)=>{var n=r(7854);t.exports=n;},1320:(t,e,r)=>{var n=r(7854),i=r(8880),o=r(6656),s=r(3505),a=r(2788),c=r(9909),u=c.get,l=c.enforce,p=String(String).split("String");(t.exports=function(t,e,r,a){var c,u=!!a&&!!a.unsafe,f=!!a&&!!a.enumerable,h=!!a&&!!a.noTargetGet;"function"==typeof r&&("string"!=typeof e||o(r,"name")||i(r,"name",e),(c=l(r)).source||(c.source=p.join("string"==typeof e?e:""))),t!==n?(u?!h&&t[e]&&(f=!0):delete t[e],f?t[e]=r:i(t,e,r)):f?t[e]=r:s(e,r);})(Function.prototype,"toString",(function(){return "function"==typeof this&&u(this).source||a(this)}));},7651:(t,e,r)=>{var n=r(4326),i=r(2261);t.exports=function(t,e){var r=t.exec;if("function"==typeof r){var o=r.call(t,e);if("object"!=typeof o)throw TypeError("RegExp exec method returned something other than an Object or null");return o}if("RegExp"!==n(t))throw TypeError("RegExp#exec called on incompatible receiver");return i.call(t,e)};},2261:(t,e,r)=>{var n,i,o=r(7066),s=r(2999),a=r(2309),c=r(30),u=r(9909).get,l=r(9441),p=r(8173),f=RegExp.prototype.exec,h=a("native-string-replace",String.prototype.replace),g=f,y=(n=/a/,i=/b*/g,f.call(n,"a"),f.call(i,"a"),0!==n.lastIndex||0!==i.lastIndex),d=s.UNSUPPORTED_Y||s.BROKEN_CARET,x=void 0!==/()??/.exec("")[1];(y||x||d||l||p)&&(g=function(t){var e,r,n,i,s,a,l,p=this,v=u(p),m=v.raw;if(m)return m.lastIndex=p.lastIndex,e=g.call(m,t),p.lastIndex=m.lastIndex,e;var b=v.groups,w=d&&p.sticky,_=o.call(p),E=p.source,S=0,P=t;if(w&&(-1===(_=_.replace("y","")).indexOf("g")&&(_+="g"),P=String(t).slice(p.lastIndex),p.lastIndex>0&&(!p.multiline||p.multiline&&"\n"!==t[p.lastIndex-1])&&(E="(?: "+E+")",P=" "+P,S++),r=new RegExp("^(?:"+E+")",_)),x&&(r=new RegExp("^"+E+"$(?!\\s)",_)),y&&(n=p.lastIndex),i=f.call(w?r:p,P),w?i?(i.input=i.input.slice(S),i[0]=i[0].slice(S),i.index=p.lastIndex,p.lastIndex+=i[0].length):p.lastIndex=0:y&&i&&(p.lastIndex=p.global?i.index+i[0].length:n),x&&i&&i.length>1&&h.call(i[0],r,(function(){for(s=1;s<arguments.length-2;s++)void 0===arguments[s]&&(i[s]=void 0);})),i&&b)for(i.groups=a=c(null),s=0;s<b.length;s++)a[(l=b[s])[0]]=i[l[1]];return i}),t.exports=g;},7066:(t,e,r)=>{var n=r(9670);t.exports=function(){var t=n(this),e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e};},2999:(t,e,r)=>{var n=r(7293),i=function(t,e){return RegExp(t,e)};e.UNSUPPORTED_Y=n((function(){var t=i("a","y");return t.lastIndex=2,null!=t.exec("abcd")})),e.BROKEN_CARET=n((function(){var t=i("^r","gy");return t.lastIndex=2,null!=t.exec("str")}));},9441:(t,e,r)=>{var n=r(7293);t.exports=n((function(){var t=RegExp(".","string".charAt(0));return !(t.dotAll&&t.exec("\n")&&"s"===t.flags)}));},8173:(t,e,r)=>{var n=r(7293);t.exports=n((function(){var t=RegExp("(?<a>b)","string".charAt(5));return "b"!==t.exec("b").groups.a||"bc"!=="b".replace(t,"$<a>c")}));},4488:t=>{t.exports=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t};},3505:(t,e,r)=>{var n=r(7854),i=r(8880);t.exports=function(t,e){try{i(n,t,e);}catch(r){n[t]=e;}return e};},8003:(t,e,r)=>{var n=r(3070).f,i=r(6656),o=r(5112)("toStringTag");t.exports=function(t,e,r){t&&!i(t=r?t:t.prototype,o)&&n(t,o,{configurable:!0,value:e});};},6200:(t,e,r)=>{var n=r(2309),i=r(9711),o=n("keys");t.exports=function(t){return o[t]||(o[t]=i(t))};},5465:(t,e,r)=>{var n=r(7854),i=r(3505),o="__core-js_shared__",s=n[o]||i(o,{});t.exports=s;},2309:(t,e,r)=>{var n=r(1913),i=r(5465);(t.exports=function(t,e){return i[t]||(i[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.15.1",mode:n?"pure":"global",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"});},8710:(t,e,r)=>{var n=r(9958),i=r(4488),o=function(t){return function(e,r){var o,s,a=String(i(e)),c=n(r),u=a.length;return c<0||c>=u?t?"":void 0:(o=a.charCodeAt(c))<55296||o>56319||c+1===u||(s=a.charCodeAt(c+1))<56320||s>57343?t?a.charAt(c):o:t?a.slice(c,c+2):s-56320+(o-55296<<10)+65536}};t.exports={codeAt:o(!1),charAt:o(!0)};},1400:(t,e,r)=>{var n=r(9958),i=Math.max,o=Math.min;t.exports=function(t,e){var r=n(t);return r<0?i(r+e,0):o(r,e)};},5656:(t,e,r)=>{var n=r(8361),i=r(4488);t.exports=function(t){return n(i(t))};},9958:t=>{var e=Math.ceil,r=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?r:e)(t)};},7466:(t,e,r)=>{var n=r(9958),i=Math.min;t.exports=function(t){return t>0?i(n(t),9007199254740991):0};},7908:(t,e,r)=>{var n=r(4488);t.exports=function(t){return Object(n(t))};},7593:(t,e,r)=>{var n=r(111);t.exports=function(t,e){if(!n(t))return t;var r,i;if(e&&"function"==typeof(r=t.toString)&&!n(i=r.call(t)))return i;if("function"==typeof(r=t.valueOf)&&!n(i=r.call(t)))return i;if(!e&&"function"==typeof(r=t.toString)&&!n(i=r.call(t)))return i;throw TypeError("Can't convert object to primitive value")};},9711:t=>{var e=0,r=Math.random();t.exports=function(t){return "Symbol("+String(void 0===t?"":t)+")_"+(++e+r).toString(36)};},3307:(t,e,r)=>{var n=r(133);t.exports=n&&!Symbol.sham&&"symbol"==typeof Symbol.iterator;},5112:(t,e,r)=>{var n=r(7854),i=r(2309),o=r(6656),s=r(9711),a=r(133),c=r(3307),u=i("wks"),l=n.Symbol,p=c?l:l&&l.withoutSetter||s;t.exports=function(t){return o(u,t)&&(a||"string"==typeof u[t])||(a&&o(l,t)?u[t]=l[t]:u[t]=p("Symbol."+t)),u[t]};},6992:(t,e,r)=>{var n=r(5656),i=r(1223),o=r(7497),s=r(9909),a=r(654),c="Array Iterator",u=s.set,l=s.getterFor(c);t.exports=a(Array,"Array",(function(t,e){u(this,{type:c,target:n(t),index:0,kind:e});}),(function(){var t=l(this),e=t.target,r=t.kind,n=t.index++;return !e||n>=e.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==r?{value:n,done:!1}:"values"==r?{value:e[n],done:!1}:{value:[n,e[n]],done:!1}}),"values"),o.Arguments=o.Array,i("keys"),i("values"),i("entries");},4916:(t,e,r)=>{var n=r(2109),i=r(2261);n({target:"RegExp",proto:!0,forced:/./.exec!==i},{exec:i});},5306:(t,e,r)=>{var n=r(7007),i=r(7293),o=r(9670),s=r(7466),a=r(9958),c=r(4488),u=r(1530),l=r(647),p=r(7651),f=r(5112)("replace"),h=Math.max,g=Math.min,y="$0"==="a".replace(/./,"$0"),d=!!/./[f]&&""===/./[f]("a","$0");n("replace",(function(t,e,r){var n=d?"$":"$0";return [function(t,r){var n=c(this),i=null==t?void 0:t[f];return void 0!==i?i.call(t,n,r):e.call(String(n),t,r)},function(t,i){if("string"==typeof i&&-1===i.indexOf(n)&&-1===i.indexOf("$<")){var c=r(e,this,t,i);if(c.done)return c.value}var f=o(this),y=String(t),d="function"==typeof i;d||(i=String(i));var x=f.global;if(x){var v=f.unicode;f.lastIndex=0;}for(var m=[];;){var b=p(f,y);if(null===b)break;if(m.push(b),!x)break;""===String(b[0])&&(f.lastIndex=u(y,s(f.lastIndex),v));}for(var w,_="",E=0,S=0;S<m.length;S++){b=m[S];for(var P=String(b[0]),O=h(g(a(b.index),y.length),0),k=[],j=1;j<b.length;j++)k.push(void 0===(w=b[j])?w:String(w));var T=b.groups;if(d){var F=[P].concat(k,O,y);void 0!==T&&F.push(T);var A=String(i.apply(void 0,F));}else A=l(P,y,O,k,T,i);O>=E&&(_+=y.slice(E,O)+A,E=O+P.length);}return _+y.slice(E)}]}),!!i((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")}))||!y||d);},3948:(t,e,r)=>{var n=r(7854),i=r(8324),o=r(6992),s=r(8880),a=r(5112),c=a("iterator"),u=a("toStringTag"),l=o.values;for(var p in i){var f=n[p],h=f&&f.prototype;if(h){if(h[c]!==l)try{s(h,c,l);}catch(t){h[c]=l;}if(h[u]||s(h,u,p),i[p])for(var g in o)if(h[g]!==o[g])try{s(h,g,o[g]);}catch(t){h[g]=o[g];}}}},2353:function(t,e){!function(r,n){var i=Array.prototype,o=Object.prototype,s=i.slice,a=o.hasOwnProperty,c=i.forEach,u={},l={forEach:function(t,e,r){var n,i,o;if(null!==t)if(c&&t.forEach===c)t.forEach(e,r);else if(t.length===+t.length){for(n=0,i=t.length;n<i;n++)if(n in t&&e.call(r,t[n],n,t)===u)return}else for(o in t)if(a.call(t,o)&&e.call(r,t[o],o,t)===u)return},extend:function(t){return this.forEach(s.call(arguments,1),(function(e){for(var r in e)t[r]=e[r];})),t}},p=function(t){if(this.defaults={locale_data:{messages:{"":{domain:"messages",lang:"en",plural_forms:"nplurals=2; plural=(n != 1);"}}},domain:"messages",debug:!1},this.options=l.extend({},this.defaults,t),this.textdomain(this.options.domain),t.domain&&!this.options.locale_data[this.options.domain])throw new Error("Text domain set to non-existent domain: `"+t.domain+"`")};function f(t){return p.PF.compile(t||"nplurals=2; plural=(n != 1);")}function h(t,e){this._key=t,this._i18n=e;}p.context_delimiter=String.fromCharCode(4),l.extend(h.prototype,{onDomain:function(t){return this._domain=t,this},withContext:function(t){return this._context=t,this},ifPlural:function(t,e){return this._val=t,this._pkey=e,this},fetch:function(t){return "[object Array]"!={}.toString.call(t)&&(t=[].slice.call(arguments,0)),(t&&t.length?p.sprintf:function(t){return t})(this._i18n.dcnpgettext(this._domain,this._context,this._key,this._pkey,this._val),t)}}),l.extend(p.prototype,{translate:function(t){return new h(t,this)},textdomain:function(t){if(!t)return this._textdomain;this._textdomain=t;},gettext:function(t){return this.dcnpgettext.call(this,n,n,t)},dgettext:function(t,e){return this.dcnpgettext.call(this,t,n,e)},dcgettext:function(t,e){return this.dcnpgettext.call(this,t,n,e)},ngettext:function(t,e,r){return this.dcnpgettext.call(this,n,n,t,e,r)},dngettext:function(t,e,r,i){return this.dcnpgettext.call(this,t,n,e,r,i)},dcngettext:function(t,e,r,i){return this.dcnpgettext.call(this,t,n,e,r,i)},pgettext:function(t,e){return this.dcnpgettext.call(this,n,t,e)},dpgettext:function(t,e,r){return this.dcnpgettext.call(this,t,e,r)},dcpgettext:function(t,e,r){return this.dcnpgettext.call(this,t,e,r)},npgettext:function(t,e,r,i){return this.dcnpgettext.call(this,n,t,e,r,i)},dnpgettext:function(t,e,r,n,i){return this.dcnpgettext.call(this,t,e,r,n,i)},dcnpgettext:function(t,e,r,n,i){var o;if(n=n||r,t=t||this._textdomain,!this.options)return (o=new p).dcnpgettext.call(o,void 0,void 0,r,n,i);if(!this.options.locale_data)throw new Error("No locale data provided.");if(!this.options.locale_data[t])throw new Error("Domain `"+t+"` was not found.");if(!this.options.locale_data[t][""])throw new Error("No locale meta information provided.");if(!r)throw new Error("No translation key found.");var s,a,c,u=e?e+p.context_delimiter+r:r,l=this.options.locale_data,h=l[t],g=(l.messages||this.defaults.locale_data.messages)[""],y=h[""].plural_forms||h[""]["Plural-Forms"]||h[""]["plural-forms"]||g.plural_forms||g["Plural-Forms"]||g["plural-forms"];if(void 0===i)c=1;else {if("number"!=typeof i&&(i=parseInt(i,10),isNaN(i)))throw new Error("The number that was passed in is not a number.");c=f(y)(i)+1;}if(!h)throw new Error("No domain named `"+t+"` could be found.");return !(s=h[u])||c>=s.length?(this.options.missing_key_callback&&this.options.missing_key_callback(u,t),a=[null,r,n],!0===this.options.debug&&console.log(a[f(y)(i)+1]),a[f()(i)+1]):(a=s[c])||(a=[null,r,n])[f()(i)+1]}});var g,y=function(){function t(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}function e(t,e){for(var r=[];e>0;r[--e]=t);return r.join("")}var r=function(){return r.cache.hasOwnProperty(arguments[0])||(r.cache[arguments[0]]=r.parse(arguments[0])),r.format.call(null,r.cache[arguments[0]],arguments)};return r.format=function(r,n){var i,o,s,a,c,u,l,p=1,f=r.length,h="",g=[];for(o=0;o<f;o++)if("string"===(h=t(r[o])))g.push(r[o]);else if("array"===h){if((a=r[o])[2])for(i=n[p],s=0;s<a[2].length;s++){if(!i.hasOwnProperty(a[2][s]))throw y('[sprintf] property "%s" does not exist',a[2][s]);i=i[a[2][s]];}else i=a[1]?n[a[1]]:n[p++];if(/[^s]/.test(a[8])&&"number"!=t(i))throw y("[sprintf] expecting number but found %s",t(i));switch(null==i&&(i=""),a[8]){case"b":i=i.toString(2);break;case"c":i=String.fromCharCode(i);break;case"d":i=parseInt(i,10);break;case"e":i=a[7]?i.toExponential(a[7]):i.toExponential();break;case"f":i=a[7]?parseFloat(i).toFixed(a[7]):parseFloat(i);break;case"o":i=i.toString(8);break;case"s":i=(i=String(i))&&a[7]?i.substring(0,a[7]):i;break;case"u":i=Math.abs(i);break;case"x":i=i.toString(16);break;case"X":i=i.toString(16).toUpperCase();}i=/[def]/.test(a[8])&&a[3]&&i>=0?"+"+i:i,u=a[4]?"0"==a[4]?"0":a[4].charAt(1):" ",l=a[6]-String(i).length,c=a[6]?e(u,l):"",g.push(a[5]?i+c:c+i);}return g.join("")},r.cache={},r.parse=function(t){for(var e=t,r=[],n=[],i=0;e;){if(null!==(r=/^[^\x25]+/.exec(e)))n.push(r[0]);else if(null!==(r=/^\x25{2}/.exec(e)))n.push("%");else {if(null===(r=/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(e)))throw "[sprintf] huh?";if(r[2]){i|=1;var o=[],s=r[2],a=[];if(null===(a=/^([a-z_][a-z_\d]*)/i.exec(s)))throw "[sprintf] huh?";for(o.push(a[1]);""!==(s=s.substring(a[0].length));)if(null!==(a=/^\.([a-z_][a-z_\d]*)/i.exec(s)))o.push(a[1]);else {if(null===(a=/^\[(\d+)\]/.exec(s)))throw "[sprintf] huh?";o.push(a[1]);}r[2]=o;}else i|=2;if(3===i)throw "[sprintf] mixing positional and named placeholders is not (yet) supported";n.push(r);}e=e.substring(r[0].length);}return n},r}(),d=function(t,e){return e.unshift(t),y.apply(null,e)};p.parse_plural=function(t,e){return t=t.replace(/n/g,e),p.parse_expression(t)},p.sprintf=function(t,e){return "[object Array]"=={}.toString.call(e)?d(t,[].slice.call(e)):y.apply(this,[].slice.call(arguments))},p.prototype.sprintf=function(){return p.sprintf.apply(this,arguments)},(p.PF={}).parse=function(t){var e=p.PF.extractPluralExpr(t);return p.PF.parser.parse.call(p.PF.parser,e)},p.PF.compile=function(t){var e=p.PF.parse(t);return function(t){return !0===(r=p.PF.interpreter(e)(t))?1:r||0;var r;}},p.PF.interpreter=function(t){return function(e){switch(t.type){case"GROUP":return p.PF.interpreter(t.expr)(e);case"TERNARY":return p.PF.interpreter(t.expr)(e)?p.PF.interpreter(t.truthy)(e):p.PF.interpreter(t.falsey)(e);case"OR":return p.PF.interpreter(t.left)(e)||p.PF.interpreter(t.right)(e);case"AND":return p.PF.interpreter(t.left)(e)&&p.PF.interpreter(t.right)(e);case"LT":return p.PF.interpreter(t.left)(e)<p.PF.interpreter(t.right)(e);case"GT":return p.PF.interpreter(t.left)(e)>p.PF.interpreter(t.right)(e);case"LTE":return p.PF.interpreter(t.left)(e)<=p.PF.interpreter(t.right)(e);case"GTE":return p.PF.interpreter(t.left)(e)>=p.PF.interpreter(t.right)(e);case"EQ":return p.PF.interpreter(t.left)(e)==p.PF.interpreter(t.right)(e);case"NEQ":return p.PF.interpreter(t.left)(e)!=p.PF.interpreter(t.right)(e);case"MOD":return p.PF.interpreter(t.left)(e)%p.PF.interpreter(t.right)(e);case"VAR":return e;case"NUM":return t.val;default:throw new Error("Invalid Token found.")}}},p.PF.extractPluralExpr=function(t){t=t.replace(/^\s\s*/,"").replace(/\s\s*$/,""),/;\s*$/.test(t)||(t=t.concat(";"));var e,r=/nplurals\=(\d+);/,n=t.match(r);if(!(n.length>1))throw new Error("nplurals not found in plural_forms string: "+t);if(n[1],!((e=(t=t.replace(r,"")).match(/plural\=(.*);/))&&e.length>1))throw new Error("`plural` expression not found: "+t);return e[1]},p.PF.parser=((g={trace:function(){},yy:{},symbols_:{error:2,expressions:3,e:4,EOF:5,"?":6,":":7,"||":8,"&&":9,"<":10,"<=":11,">":12,">=":13,"!=":14,"==":15,"%":16,"(":17,")":18,n:19,NUMBER:20,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",6:"?",7:":",8:"||",9:"&&",10:"<",11:"<=",12:">",13:">=",14:"!=",15:"==",16:"%",17:"(",18:")",19:"n",20:"NUMBER"},productions_:[0,[3,2],[4,5],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,3],[4,1],[4,1]],performAction:function(t,e,r,n,i,o,s){var a=o.length-1;switch(i){case 1:return {type:"GROUP",expr:o[a-1]};case 2:this.$={type:"TERNARY",expr:o[a-4],truthy:o[a-2],falsey:o[a]};break;case 3:this.$={type:"OR",left:o[a-2],right:o[a]};break;case 4:this.$={type:"AND",left:o[a-2],right:o[a]};break;case 5:this.$={type:"LT",left:o[a-2],right:o[a]};break;case 6:this.$={type:"LTE",left:o[a-2],right:o[a]};break;case 7:this.$={type:"GT",left:o[a-2],right:o[a]};break;case 8:this.$={type:"GTE",left:o[a-2],right:o[a]};break;case 9:this.$={type:"NEQ",left:o[a-2],right:o[a]};break;case 10:this.$={type:"EQ",left:o[a-2],right:o[a]};break;case 11:this.$={type:"MOD",left:o[a-2],right:o[a]};break;case 12:this.$={type:"GROUP",expr:o[a-1]};break;case 13:this.$={type:"VAR"};break;case 14:this.$={type:"NUM",val:Number(t)};}},table:[{3:1,4:2,17:[1,3],19:[1,4],20:[1,5]},{1:[3]},{5:[1,6],6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{4:17,17:[1,3],19:[1,4],20:[1,5]},{5:[2,13],6:[2,13],7:[2,13],8:[2,13],9:[2,13],10:[2,13],11:[2,13],12:[2,13],13:[2,13],14:[2,13],15:[2,13],16:[2,13],18:[2,13]},{5:[2,14],6:[2,14],7:[2,14],8:[2,14],9:[2,14],10:[2,14],11:[2,14],12:[2,14],13:[2,14],14:[2,14],15:[2,14],16:[2,14],18:[2,14]},{1:[2,1]},{4:18,17:[1,3],19:[1,4],20:[1,5]},{4:19,17:[1,3],19:[1,4],20:[1,5]},{4:20,17:[1,3],19:[1,4],20:[1,5]},{4:21,17:[1,3],19:[1,4],20:[1,5]},{4:22,17:[1,3],19:[1,4],20:[1,5]},{4:23,17:[1,3],19:[1,4],20:[1,5]},{4:24,17:[1,3],19:[1,4],20:[1,5]},{4:25,17:[1,3],19:[1,4],20:[1,5]},{4:26,17:[1,3],19:[1,4],20:[1,5]},{4:27,17:[1,3],19:[1,4],20:[1,5]},{6:[1,7],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[1,28]},{6:[1,7],7:[1,29],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16]},{5:[2,3],6:[2,3],7:[2,3],8:[2,3],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,3]},{5:[2,4],6:[2,4],7:[2,4],8:[2,4],9:[2,4],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,4]},{5:[2,5],6:[2,5],7:[2,5],8:[2,5],9:[2,5],10:[2,5],11:[2,5],12:[2,5],13:[2,5],14:[2,5],15:[2,5],16:[1,16],18:[2,5]},{5:[2,6],6:[2,6],7:[2,6],8:[2,6],9:[2,6],10:[2,6],11:[2,6],12:[2,6],13:[2,6],14:[2,6],15:[2,6],16:[1,16],18:[2,6]},{5:[2,7],6:[2,7],7:[2,7],8:[2,7],9:[2,7],10:[2,7],11:[2,7],12:[2,7],13:[2,7],14:[2,7],15:[2,7],16:[1,16],18:[2,7]},{5:[2,8],6:[2,8],7:[2,8],8:[2,8],9:[2,8],10:[2,8],11:[2,8],12:[2,8],13:[2,8],14:[2,8],15:[2,8],16:[1,16],18:[2,8]},{5:[2,9],6:[2,9],7:[2,9],8:[2,9],9:[2,9],10:[2,9],11:[2,9],12:[2,9],13:[2,9],14:[2,9],15:[2,9],16:[1,16],18:[2,9]},{5:[2,10],6:[2,10],7:[2,10],8:[2,10],9:[2,10],10:[2,10],11:[2,10],12:[2,10],13:[2,10],14:[2,10],15:[2,10],16:[1,16],18:[2,10]},{5:[2,11],6:[2,11],7:[2,11],8:[2,11],9:[2,11],10:[2,11],11:[2,11],12:[2,11],13:[2,11],14:[2,11],15:[2,11],16:[2,11],18:[2,11]},{5:[2,12],6:[2,12],7:[2,12],8:[2,12],9:[2,12],10:[2,12],11:[2,12],12:[2,12],13:[2,12],14:[2,12],15:[2,12],16:[2,12],18:[2,12]},{4:30,17:[1,3],19:[1,4],20:[1,5]},{5:[2,2],6:[1,7],7:[2,2],8:[1,8],9:[1,9],10:[1,10],11:[1,11],12:[1,12],13:[1,13],14:[1,14],15:[1,15],16:[1,16],18:[2,2]}],defaultActions:{6:[2,1]},parseError:function(t,e){throw new Error(t)},parse:function(t){var e=this,r=[0],n=[null],i=[],o=this.table,s="",a=0,c=0,u=0;this.lexer.setInput(t),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,void 0===this.lexer.yylloc&&(this.lexer.yylloc={});var l=this.lexer.yylloc;function p(){var t;return "number"!=typeof(t=e.lexer.lex()||1)&&(t=e.symbols_[t]||t),t}i.push(l),"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var f,h,g,y,d,x,v,m,b,w={};;){if(g=r[r.length-1],this.defaultActions[g]?y=this.defaultActions[g]:(null==f&&(f=p()),y=o[g]&&o[g][f]),void 0===y||!y.length||!y[0]){if(!u){for(x in b=[],o[g])this.terminals_[x]&&x>2&&b.push("'"+this.terminals_[x]+"'");var _="";_=this.lexer.showPosition?"Parse error on line "+(a+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+b.join(", ")+", got '"+this.terminals_[f]+"'":"Parse error on line "+(a+1)+": Unexpected "+(1==f?"end of input":"'"+(this.terminals_[f]||f)+"'"),this.parseError(_,{text:this.lexer.match,token:this.terminals_[f]||f,line:this.lexer.yylineno,loc:l,expected:b});}if(3==u){if(1==f)throw new Error(_||"Parsing halted.");c=this.lexer.yyleng,s=this.lexer.yytext,a=this.lexer.yylineno,l=this.lexer.yylloc,f=p();}for(;!(2..toString()in o[g]);){if(0==g)throw new Error(_||"Parsing halted.");r.length=r.length-2,n.length=n.length-1,i.length=i.length-1,g=r[r.length-1];}h=f,f=2,y=o[g=r[r.length-1]]&&o[g][2],u=3;}if(y[0]instanceof Array&&y.length>1)throw new Error("Parse Error: multiple actions possible at state: "+g+", token: "+f);switch(y[0]){case 1:r.push(f),n.push(this.lexer.yytext),i.push(this.lexer.yylloc),r.push(y[1]),f=null,h?(f=h,h=null):(c=this.lexer.yyleng,s=this.lexer.yytext,a=this.lexer.yylineno,l=this.lexer.yylloc,u>0&&u--);break;case 2:if(v=this.productions_[y[1]][1],w.$=n[n.length-v],w._$={first_line:i[i.length-(v||1)].first_line,last_line:i[i.length-1].last_line,first_column:i[i.length-(v||1)].first_column,last_column:i[i.length-1].last_column},void 0!==(d=this.performAction.call(w,s,c,a,this.yy,y[1],n,i)))return d;v&&(r=r.slice(0,-1*v*2),n=n.slice(0,-1*v),i=i.slice(0,-1*v)),r.push(this.productions_[y[1]][0]),n.push(w.$),i.push(w._$),m=o[r[r.length-2]][r[r.length-1]],r.push(m);break;case 3:return !0}}return !0}}).lexer={EOF:1,parseError:function(t,e){if(!this.yy.parseError)throw new Error(t);this.yy.parseError(t,e);},setInput:function(t){return this._input=t,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this},input:function(){var t=this._input[0];return this.yytext+=t,this.yyleng++,this.match+=t,this.matched+=t,t.match(/\n/)&&this.yylineno++,this._input=this._input.slice(1),t},unput:function(t){return this._input=t+this._input,this},more:function(){return this._more=!0,this},pastInput:function(){var t=this.matched.substr(0,this.matched.length-this.match.length);return (t.length>20?"...":"")+t.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var t=this.match;return t.length<20&&(t+=this._input.substr(0,20-t.length)),(t.substr(0,20)+(t.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var t=this.pastInput(),e=new Array(t.length+1).join("-");return t+this.upcomingInput()+"\n"+e+"^"},next:function(){if(this.done)return this.EOF;var t,e;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var r=this._currentRules(),n=0;n<r.length;n++)if(t=this._input.match(this.rules[r[n]]))return (e=t[0].match(/\n.*/g))&&(this.yylineno+=e.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:e?e[e.length-1].length-1:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this._more=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],this.performAction.call(this,this.yy,this,r[n],this.conditionStack[this.conditionStack.length-1])||void 0;if(""===this._input)return this.EOF;this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno});},lex:function(){var t=this.next();return void 0!==t?t:this.lex()},begin:function(t){this.conditionStack.push(t);},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(t){this.begin(t);},performAction:function(t,e,r,n){switch(r){case 0:break;case 1:return 20;case 2:return 19;case 3:return 8;case 4:return 9;case 5:return 6;case 6:return 7;case 7:return 11;case 8:return 13;case 9:return 10;case 10:return 12;case 11:return 14;case 12:return 15;case 13:return 16;case 14:return 17;case 15:return 18;case 16:return 5;case 17:return "INVALID"}},rules:[/^\s+/,/^[0-9]+(\.[0-9]+)?\b/,/^n\b/,/^\|\|/,/^&&/,/^\?/,/^:/,/^<=/,/^>=/,/^</,/^>/,/^!=/,/^==/,/^%/,/^\(/,/^\)/,/^$/,/^./],conditions:{INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17],inclusive:!0}}},g),t.exports&&(e=t.exports=p),e.Jed=p;}();}},e={};function r(n){var i=e[n];if(void 0!==i)return i.exports;var o=e[n]={exports:{}};return t[n].call(o.exports,o,o.exports,r),o.exports}return r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r(8276)})()}));
});

var PROJECT_NAME = 'flow-components';
function loadTranslations(_x, _x2) {
  return _loadTranslations.apply(this, arguments);
}

function _loadTranslations() {
  _loadTranslations = asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(language, logger) {
    var translatorClient;
    return regeneratorRuntime.wrap(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            _context.next = 2;
            return fe$1({
              serviceName: PROJECT_NAME,
              language: language || 'en-US',
              logger: logger
            });

          case 2:
            translatorClient = _context.sent;
            return _context.abrupt("return", translatorClient);

          case 4:
          case "end":
            return _context.stop();
        }
      }
    }, _callee);
  }));
  return _loadTranslations.apply(this, arguments);
}

var FlowTranslatorContextProvider = function FlowTranslatorContextProvider(_ref) {
  var children = _ref.children,
      language = _ref.language,
      logger = _ref.logger;

  var _useAsync = useAsync(function () {
    return loadTranslations(language, logger === null || logger === void 0 ? void 0 : logger.pipedriveLogger);
  }, {
    logger: logger
  }),
      translator = _useAsync.response;

  if (!translator) {
    return null;
  }

  return /*#__PURE__*/React__default['default'].createElement(Ui.Provider, {
    value: translator
  }, children);
};
FlowTranslatorContextProvider.displayName = "FlowTranslatorContextProvider";

function _classCallCheck(instance, Constructor) {
  if (!(instance instanceof Constructor)) {
    throw new TypeError("Cannot call a class as a function");
  }
}

var classCallCheck = _classCallCheck;

function _defineProperties(target, props) {
  for (var i = 0; i < props.length; i++) {
    var descriptor = props[i];
    descriptor.enumerable = descriptor.enumerable || false;
    descriptor.configurable = true;
    if ("value" in descriptor) descriptor.writable = true;
    Object.defineProperty(target, descriptor.key, descriptor);
  }
}

function _createClass(Constructor, protoProps, staticProps) {
  if (protoProps) _defineProperties(Constructor.prototype, protoProps);
  if (staticProps) _defineProperties(Constructor, staticProps);
  return Constructor;
}

var createClass = _createClass;

function ownKeys$3(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread$4(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys$3(Object(source), true).forEach(function (key) { defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys$3(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }
var Logger = /*#__PURE__*/function () {
  function Logger(serviceName, commonContext) {
    classCallCheck(this, Logger);

    this.serviceName = serviceName;
    this.commonContext = commonContext;

    defineProperty(this, "logger", void 0);

    this.logger = new PipedriveLogger__default['default'](serviceName);
  } // eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types


  createClass(Logger, [{
    key: "error",
    value: function error(message, _error, context) {
      this.logger.remote('error', message, _objectSpread$4(_objectSpread$4({
        caughtErrorStack: _error === null || _error === void 0 ? void 0 : _error.stack,
        caughtErrorMessage: _error === null || _error === void 0 ? void 0 : _error.message
      }, this.commonContext), context), this.serviceName);
    } // eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types

  }, {
    key: "info",
    value: function info(message) {
      var data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
      this.logger.remote('info', message, _objectSpread$4(_objectSpread$4({}, this.commonContext), data), this.serviceName);
    } // eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types

  }, {
    key: "warning",
    value: function warning(message) {
      var data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};
      this.logger.remote('warning', message, _objectSpread$4(_objectSpread$4({}, this.commonContext), data), this.serviceName);
    } // eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types

  }, {
    key: "pipedriveLogger",
    get: function get() {
      return this.logger;
    }
  }]);

  return Logger;
}();

var FlowContextProvider = function FlowContextProvider(_ref) {
  var children = _ref.children,
      language = _ref.language,
      locale = _ref.locale,
      _ref$loggerCommonCont = _ref.loggerCommonContext,
      loggerCommonContext = _ref$loggerCommonCont === void 0 ? {} : _ref$loggerCommonCont,
      componentLoader = _ref.componentLoader;
  var logger = new Logger('pipedrive-packages_flow-components', loggerCommonContext);
  return /*#__PURE__*/React__default['default'].createElement(FlowTranslatorContextProvider, {
    language: language,
    logger: logger
  }, /*#__PURE__*/React__default['default'].createElement(LoggerProvider, {
    logger: logger
  }, /*#__PURE__*/React__default['default'].createElement(ComponentLoaderProvider, {
    componentLoader: componentLoader
  }, /*#__PURE__*/React__default['default'].createElement(LocaleProvider, {
    locale: locale
  }, children))));
};
FlowContextProvider.displayName = "FlowContextProvider";

exports.Activity = Activity;
exports.ActivityActions = ActivityActions;
exports.Attachments = Attachments$1;
exports.CreationEvent = CreationEvent;
exports.DraftEmail = DraftEmail;
exports.DueDate = DueDate;
exports.EmailActions = EmailActions;
exports.FlowContextProvider = FlowContextProvider;
exports.FlowItemsSection = FlowItemsSection;
exports.FlowTranslatorContext = Ui;
exports.FlowTranslatorContextProvider = FlowTranslatorContextProvider;
exports.ListInfiniteScroll = ListInfiniteScroll;
exports.MessageBody = MessageBody;
exports.NoActivityMessage = NoActivityMessage;
exports.Note = Note$1;
exports.PinnedNote = PinnedNote;
exports.Recipients = Recipients;
exports.SentEmail = SentEmail;
exports.SourceLabel = SourceLabel;
exports.UpcomingQuickActivities = UpcomingQuickActivities;
exports.getFormattedActivityDate = getFormattedActivityDate;
exports.useFlowTranslator = Bi;
//# sourceMappingURL=index.js.map
